<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Python,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/logo.jpg?v=5.1.2">






<meta name="description" content="文章概述 本篇文章记录学习Python3的笔记。">
<meta name="keywords" content="Python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python3笔记">
<meta property="og:url" content="http://liusong.site/2019/01/10/python/[Python3]夯实基础/index.html">
<meta property="og:site_name" content="杯酥清风">
<meta property="og:description" content="文章概述 本篇文章记录学习Python3的笔记。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://raw.githubusercontent.com/cnlius/GP-Resource/master/Python/py_mind_data_type.png">
<meta property="og:updated_time" content="2019-01-15T07:31:50.557Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python3笔记">
<meta name="twitter:description" content="文章概述 本篇文章记录学习Python3的笔记。">
<meta name="twitter:image" content="https://raw.githubusercontent.com/cnlius/GP-Resource/master/Python/py_mind_data_type.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://liusong.site/2019/01/10/python/[Python3]夯实基础/">





  <title>Python3笔记 | 杯酥清风</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/ethancalc"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/121cd7cbdc3e4855075ea8b558508b91ac463ac2/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png"></a>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">杯酥清风</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Personal Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            文章列表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            我的简历
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://liusong.site/2019/01/10/python/[Python3]夯实基础/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ethancalc">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/images/head/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="杯酥清风">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python3笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T00:00:00+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2019/01/10/python/[Python3]夯实基础/#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2019/01/10/python/[Python3]夯实基础/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </span></div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="文章概述"><a href="#文章概述" class="headerlink" title="文章概述"></a>文章概述</h3><blockquote>
<p>本篇文章记录学习Python3的笔记。</p>
</blockquote>
<a id="more"></a>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a href="https://docs.python.org/3/library/" target="_blank" rel="noopener">python3文档</a></li>
</ul>
<h3 id="认识python"><a href="#认识python" class="headerlink" title="认识python"></a>认识python</h3><h4 id="python代码"><a href="#python代码" class="headerlink" title="python代码"></a>python代码</h4><ol>
<li>Python代码不能压缩和混淆；</li>
</ol>
<h3 id="命令行操作"><a href="#命令行操作" class="headerlink" title="命令行操作"></a>命令行操作</h3><h4 id="命令行信息"><a href="#命令行信息" class="headerlink" title="命令行信息"></a>命令行信息</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取命令行参数</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">print(sys.argv)</span><br><span class="line"><span class="comment"># 获取当前Python命令的可执行文件路径</span></span><br><span class="line">print(sys.executable)</span><br></pre></td></tr></table></figure>
<h4 id="退出控制台"><a href="#退出控制台" class="headerlink" title="退出控制台"></a>退出控制台</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//windows</span></span><br><span class="line">$ exit()</span><br></pre></td></tr></table></figure>
<h4 id="语句换行"><a href="#语句换行" class="headerlink" title="语句换行"></a>语句换行</h4><p>使用三引号开头表示多行语句，再次使用三引号结束，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">... hello</span></span><br><span class="line"><span class="string">... world</span></span><br><span class="line"><span class="string">... '</span><span class="string">''</span></span><br><span class="line"><span class="string">'\nhello\nworld\n'</span></span><br></pre></td></tr></table></figure>
<h4 id="python版本信息"><a href="#python版本信息" class="headerlink" title="python版本信息"></a>python版本信息</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python --version</span><br></pre></td></tr></table></figure>
<h4 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//input可以不带参数</span></span><br><span class="line">num=input(<span class="string">"请输入一个数字"</span>);</span><br><span class="line">print(num);</span><br></pre></td></tr></table></figure>
<h4 id="运行python文件"><a href="#运行python文件" class="headerlink" title="运行python文件"></a>运行python文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python hello.py</span><br></pre></td></tr></table></figure>
<h3 id="编程规范"><a href="#编程规范" class="headerlink" title="编程规范"></a>编程规范</h3><h4 id="语句写法注意"><a href="#语句写法注意" class="headerlink" title="语句写法注意"></a>语句写法注意</h4><ol>
<li>单行语句：不需要加“;”作为结束符；</li>
<li>代码块：不需要{}包裹，而是使用四个空格(非tab键)缩进包裹，每个语句块结束都要空出一行；</li>
<li>注释：单行注释使用#，多行注释使用三引号；</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 单行注释</span><br><span class="line">&apos;&apos;&apos;多行注释&apos;&apos;&apos;</span><br></pre></td></tr></table></figure>
<ol>
<li>变量命名：以小写字母开头，可以使用驼峰命名或者下划线分割字母的方式命名；</li>
<li>函数命名：函数名使用小写字母，单词之间用_下划线分割；</li>
<li>语句换行：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 方式一：末尾加\：换行【不推荐是使用】</span><br><span class="line">from xlib.firstlib import a, b,\</span><br><span class="line"> c</span><br><span class="line">print(&apos;end&apos;)</span><br><span class="line"></span><br><span class="line"># 方式二：圆括号包裹换行【推荐使用】</span><br><span class="line">from xlib.firstlib import (a, b,</span><br><span class="line"> c)</span><br><span class="line">print(&apos;end&apos;)</span><br></pre></td></tr></table></figure>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="变量-1"><a href="#变量-1" class="headerlink" title="变量"></a>变量</h4><p>python是动态语言，定义变量直接对变量赋值，而无需指定变量类型；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = 10</span><br><span class="line">x = y</span><br></pre></td></tr></table></figure>
<h5 id="变量命名"><a href="#变量命名" class="headerlink" title="变量命名"></a>变量命名</h5><p>变量命名：以小写字母开头，可以使用驼峰命名或者下划线分割字母的方式命名；</p>
<h5 id="变量的类型"><a href="#变量的类型" class="headerlink" title="变量的类型"></a>变量的类型</h5><ul>
<li>值类型（不可改变）：int、str、tuple</li>
<li>引用另类型（引用类型）：list、set、dict</li>
</ul>
<h5 id="变量内存地址"><a href="#变量内存地址" class="headerlink" title="变量内存地址"></a>变量内存地址</h5><p>使用id(var)获取变量var的内存地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = 10</span><br><span class="line">&gt;&gt;&gt; id(x)</span><br><span class="line">140707502150976</span><br></pre></td></tr></table></figure>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>python中并未严格定义常量的表达式，只是推荐用大写字母来表示常量；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PI = 3.14159265359</span><br></pre></td></tr></table></figure>
<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><h4 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+、-、*、/、//(整除)、%</span><br><span class="line">**(次方)：2**3=8</span><br></pre></td></tr></table></figure>
<h4 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=，+=，*=，/=，%=，**=(幂赋值运算符)，//=</span><br></pre></td></tr></table></figure>
<h4 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h4><p>比较值是否相等，返回布尔值；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">==，!=，&gt;,&lt;,&gt;=,&lt;=</span><br></pre></td></tr></table></figure>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><p>and、or和not来表示计算机的与、或和非运算；</p>
<h4 id="成员运算符"><a href="#成员运算符" class="headerlink" title="成员运算符"></a>成员运算符</h4><ul>
<li>in：1 in [1,2]=true （注意：字典的成员运算只针对key）</li>
<li>not in : 与in相反；</li>
</ul>
<h4 id="身份运算符"><a href="#身份运算符" class="headerlink" title="身份运算符"></a>身份运算符</h4><p>返回布尔值</p>
<ul>
<li>is ：比较的是内存地址是否相等；</li>
<li>is not：与is相反；</li>
</ul>
<h4 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h4><p>位运算符先转换成2进制进行运算结果再转换回来；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;：1&amp;1=1,1&amp;0=0,0&amp;0=0；</span><br><span class="line">|</span><br><span class="line">^(按位异或)</span><br><span class="line">~</span><br><span class="line">&lt;&lt;</span><br><span class="line">&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>位运算符还可以用于集合之间的运算：</p>
<ul>
<li>求集合交集：{1,2}&amp;{1}={1}</li>
<li>求集合合集：{1,2,3,4}|{3,4,7}={1,2,3,4,7}</li>
</ul>
<h4 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h4><p>运算符优先级从最高到最低如下表：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">**</td>
<td style="text-align:center">指数运算 (最高优先级)，如：2**3=8</td>
</tr>
<tr>
<td style="text-align:center">~、+、-</td>
<td style="text-align:center">按位翻转, 一元加号和减号 (最后两个的方法名为 +@ 和 -@)</td>
</tr>
<tr>
<td style="text-align:center">*、/、%、//</td>
<td style="text-align:center">乘，除，取模和取整除</td>
</tr>
<tr>
<td style="text-align:center">+、-</td>
<td style="text-align:center">加法减法</td>
</tr>
<tr>
<td style="text-align:center">&gt;&gt;、&lt;&lt;</td>
<td style="text-align:center">左移、右移位运算符</td>
</tr>
<tr>
<td style="text-align:center">&amp;、</td>
<td style="text-align:center">按位与</td>
</tr>
<tr>
<td style="text-align:center">^、丨</td>
<td style="text-align:center">运算符</td>
</tr>
<tr>
<td style="text-align:center">&lt;=、&lt;、&gt;、&gt;=</td>
<td style="text-align:center">比较运算符</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt;、==、!=</td>
<td style="text-align:center">比较运算符</td>
</tr>
<tr>
<td style="text-align:center">=、%=、/=、//=、-=、+=、*=、**=</td>
<td style="text-align:center">赋值运算符</td>
</tr>
<tr>
<td style="text-align:center">is、is not</td>
<td style="text-align:center">身份运算符</td>
</tr>
<tr>
<td style="text-align:center">in、not in</td>
<td style="text-align:center">成员运算符</td>
</tr>
<tr>
<td style="text-align:center">and、or、not</td>
<td style="text-align:center">逻辑运算符(and的优先级大于or)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="数据类型概览"><a href="#数据类型概览" class="headerlink" title="数据类型概览"></a>数据类型概览</h4><ol>
<li>基础数据类型有：</li>
</ol>
<ul>
<li>整数(int)：十六进制0x44表示整数更方便，Python的整数没有大小限制；</li>
<li>浮点数(float)：e代替10，如1.23e9，Python的浮点数没有大小限制，但是超出一定范围就用inf表示无限大；</li>
<li>字符串(str)；</li>
<li>布尔值(bool)：True（非0的数值或非空的类型） False（0或空值或None） ，可以使用or、and、not(或与非)运算表达式表示；</li>
<li>None(NoneType)：空值；</li>
<li>bytes: 字节，用带b前缀的单引号或双引号字符串表示，如：b’abc’；</li>
<li>complex(复数)：python复数单位用j表示，如36j（a+bi（a,b均为实数）的数称为复数，其中a称为实部，b称为虚部，i称为虚数单位）；</li>
</ul>
<p><span style="color:blue">2. 全部数据类型概览图</span></p>
<p><img src="https://raw.githubusercontent.com/cnlius/GP-Resource/master/Python/py_mind_data_type.png" alt="image"></p>
<p>思维导图中的数据类型有以下特点：</p>
<ol>
<li>不可变的类型有：数字、字符串、元组；</li>
<li>有序的的类型有：字符串、列表、元组，有序的数据类型可以用索引(索引是从0开始)访问、可以对序列进行截取的切片操作；</li>
<li>无序的数据类型：集合、字典，没有索引，不可以通过切片操作来截取；</li>
</ol>
<h4 id="数据类型相关方法"><a href="#数据类型相关方法" class="headerlink" title="数据类型相关方法"></a>数据类型相关方法</h4><h5 id="获取数据的类型"><a href="#获取数据的类型" class="headerlink" title="获取数据的类型"></a>获取数据的类型</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; type(<span class="number">0</span>);</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">int</span>'&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="判断数据类型"><a href="#判断数据类型" class="headerlink" title="判断数据类型"></a>判断数据类型</h5><p>判断数据类型的正确方式：isinstance(var_name, data_type),该方法返回bool值；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(1,int)</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
<h5 id="数据类型相互转换"><a href="#数据类型相互转换" class="headerlink" title="数据类型相互转换"></a>数据类型相互转换</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># str/float-&gt;int</span></span><br><span class="line">int(<span class="string">'1'</span>) <span class="comment"># 1</span></span><br><span class="line">int(<span class="number">0.01</span>) <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将进制数转换为int类型的10进制数：int(str_x,base=进制)</span></span><br><span class="line">int(<span class="string">'1001'</span>,<span class="number">2</span>) <span class="comment"># 9</span></span><br><span class="line">int(<span class="string">'1001'</span>,base=<span class="number">2</span>) <span class="comment"># 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># int/list/tuple-&gt;str</span></span><br><span class="line">str(<span class="number">1</span>) <span class="comment"># '1'</span></span><br><span class="line">str([<span class="number">1</span>,<span class="number">2</span>]) <span class="comment"># '[1,2]'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tuple-&gt;list</span></span><br><span class="line">list((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># [1,2,3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># str-&gt;bytes</span></span><br><span class="line">bytes(<span class="string">'hello'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="string">'str'</span>.encode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bytes-&gt;str</span></span><br><span class="line">b=<span class="string">b'\xe9\x80\x86\xe7\x81haha\xab'</span></span><br><span class="line">b.decode(<span class="string">'utf-8'</span>,errors=<span class="string">'ignore'</span>) <span class="comment"># 忽略非法字符，用strict会抛出异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#...以此类推其它类型转换</span></span><br></pre></td></tr></table></figure>
<h4 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h4><p>数字包括整数、浮点数、负数、进制数…</p>
<h5 id="进制数"><a href="#进制数" class="headerlink" title="进制数"></a>进制数</h5><h6 id="常见进制数"><a href="#常见进制数" class="headerlink" title="常见进制数"></a>常见进制数</h6><ul>
<li>二进制：0b作前缀；</li>
<li>八进制：0o作前缀；</li>
<li>十六进制：0x作前缀；</li>
</ul>
<h6 id="进制转换方法"><a href="#进制转换方法" class="headerlink" title="进制转换方法"></a>进制转换方法</h6><ul>
<li>任意进制数转二进制：bin(任意进制数)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10-&gt;2：bin(10)</span><br><span class="line">8-&gt;2：bin(0o1)</span><br><span class="line">16-&gt;2：bin(0xE)</span><br></pre></td></tr></table></figure>
<ul>
<li>任意进制数转十进制：int(任意进制数)</li>
<li>任意进制数转八进制：oct(任意进制数)</li>
<li>任意进制数转十六进制：hex(任意进制数)</li>
</ul>
<h5 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h5><h6 id="保留小数"><a href="#保留小数" class="headerlink" title="保留小数"></a>保留小数</h6><p>round(number[,n])：number四舍五入保留n位小数；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//示例：</span><br><span class="line">round(3.2132,2)</span><br></pre></td></tr></table></figure>
<h4 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h4><blockquote>
<p>type = bool</p>
<p>非零数值、非空字符串、非空list等，就判断为True，否则为False。</p>
</blockquote>
<ol>
<li>True、False表示布尔值（请注意<span style="color:red">大小写</span>）；</li>
<li>布尔值可以用and(与)、or(或)和not(非)运算来表示；</li>
<li>布尔值可以用条件运算的结果来表示；</li>
</ol>
<h4 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h4><blockquote>
<p>type = None</p>
</blockquote>
<ol>
<li>空值用None表示。</li>
<li>None不能理解为0，因为0是有意义的，而None是一个特殊的空值。</li>
<li>判空操作：</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//非空判断</span></span><br><span class="line"><span class="keyword">if</span> a: </span><br><span class="line">    pass</span><br><span class="line"><span class="comment">//空判断</span></span><br><span class="line"><span class="keyword">if</span> not a:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<h4 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h4><blockquote>
<p>type = str</p>
</blockquote>
<h5 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h5><ul>
<li>Python 3的字符串使用Unicode，直接支持多语言。</li>
</ul>
<h6 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h6><ul>
<li>UTF-8编码是可变长编码，UTF-8编码把一个Unicode字符根据不同的数字大小编码成1-6个字节，对比Unicode，更加节省空间；</li>
<li>1个中文字符经过UTF-8编码后通常会占用3个字节，而1个英文字符只占用1个字节</li>
</ul>
<h6 id="Python文件设置编码"><a href="#Python文件设置编码" class="headerlink" title="Python文件设置编码"></a>Python文件设置编码</h6><p>当Python解释器读取源代码时，为了让它按UTF-8编码读取，我们通常在文件开头写上这两行：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line"># -*- coding: utf-8 -*-</span><br></pre></td></tr></table></figure>
<ul>
<li>第一行注释是为了告诉Linux/OS X系统，这是一个Python可执行程序，Windows系统会忽略这个注释；</li>
<li>第二行注释是为了告诉Python解释器，按照UTF-8编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码</li>
</ul>
<h5 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h5><p>常用\表示转义字符，常用方式：</p>
<ul>
<li>换行符：\n</li>
<li>横向制表符：\t</li>
<li>回车：\r</li>
</ul>
<h5 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h5><p>格式化字符串的方法：</p>
<ol>
<li>在字符串中使用%占位符，字符串后跟%，%后跟需要被替换的字符串；</li>
<li>使用字符串的format方法;</li>
</ol>
<h6 id="占位符-格式化字符串"><a href="#占位符-格式化字符串" class="headerlink" title="占位符%格式化字符串"></a>占位符%格式化字符串</h6><ol>
<li>动态字符串可以使用%占位符的方式格式化字符串，常见占位符如下：</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>占位符</th>
<th>替换内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>%d</td>
<td>整数</td>
</tr>
<tr>
<td>%f</td>
<td>浮点数</td>
</tr>
<tr>
<td>%s</td>
<td>字符串</td>
</tr>
<tr>
<td>%x</td>
<td>十六进制整数</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>格式化整数和浮点数还可以指定是否补0和整数与小数的位数：</li>
</ol>
<p>【示例】</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//替换单个字符串</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">'Hello, %s'</span> % <span class="string">'world'</span></span><br><span class="line"><span class="string">'Hello, world'</span></span><br><span class="line"><span class="comment">//多个替换</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">'Hi, %s, you have $%d.'</span> % (<span class="string">'Michael'</span>, <span class="number">1000000</span>)</span><br><span class="line"><span class="string">'Hi, Michael, you have $1000000.'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//保留2位整数，区分是否补0的情况：</span></span><br><span class="line">&gt;&gt;&gt; print(<span class="string">'%2d-%02d'</span> % (<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line"><span class="number">3</span><span class="number">-01</span></span><br><span class="line"><span class="comment">//保留两位小数：</span></span><br><span class="line">&gt;&gt;&gt; print(<span class="string">'%.2f'</span> % <span class="number">3.1415926</span>)</span><br><span class="line"><span class="number">3.14</span></span><br></pre></td></tr></table></figure>
<h6 id="format方法格式化字符串"><a href="#format方法格式化字符串" class="headerlink" title="format方法格式化字符串"></a>format方法格式化字符串</h6><p>另一种格式化字符串的方法是使用字符串的format()方法，它会用传入的参数依次替换字符串内的占位符{0}、{1}……，不过这种方式写起来比%要麻烦得多：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="string">'Hello, &#123;0&#125;, 成绩提升了 &#123;1:.1f&#125;%'</span>.format(<span class="string">'小明'</span>, <span class="number">17.125</span>)</span><br><span class="line"><span class="string">'Hello, 小明, 成绩提升了 17.1%'</span></span><br></pre></td></tr></table></figure>
<h5 id="字符串操作方法"><a href="#字符串操作方法" class="headerlink" title="字符串操作方法"></a>字符串操作方法</h5><h6 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h6><p>len(str);</p>
<blockquote>
<p><span style="color:blue">len()函数实际上是调用str对象的<strong>len</strong>()方法来获取字符串的长度,二者等价；</span></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; len(&apos;ABC&apos;)</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; &apos;ABC&apos;.__len__()</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<h6 id="乘法复制"><a href="#乘法复制" class="headerlink" title="乘法复制"></a>乘法复制</h6><p>字符串乘法(<span style="color:blue">字符串复制</span>)：重复n次输出乘号前面的字符串;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [示例]</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">"hello"</span>*<span class="number">3</span>;</span><br><span class="line"><span class="string">'hellohellohello'</span></span><br></pre></td></tr></table></figure>
<h6 id="索引取值"><a href="#索引取值" class="headerlink" title="索引取值"></a>索引取值</h6><blockquote>
<p>如果下标越界会报IndexError</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从左到右:</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">'hello'</span>[<span class="number">0</span>];</span><br><span class="line"><span class="string">'h'</span></span><br><span class="line"><span class="comment">//从右到左:</span></span><br><span class="line">&gt;&gt;&gt; <span class="string">'hello'</span>[<span class="number">-2</span>];</span><br><span class="line"><span class="string">'l'</span></span><br></pre></td></tr></table></figure>
<h6 id="索引切片-截取"><a href="#索引切片-截取" class="headerlink" title="索引切片(截取)"></a>索引切片(截取)</h6><p>字符串按索引截取：str[a:b:step],截取str的a到b索引的元素，不包含b,步长为step;</p>
<ul>
<li>str[star,end]切片</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//按索引截取</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"hello"</span>[<span class="number">1</span>:<span class="number">2</span>];</span><br><span class="line"><span class="string">'e'</span></span><br><span class="line">//[<span class="number">6</span>:]：从第n个截取到最后；</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"hello"</span>[<span class="number">0</span>:];</span><br><span class="line"><span class="string">'hello'</span></span><br><span class="line">//[<span class="number">6</span>:<span class="number">0</span>]：一个都不截取；</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"hello"</span>[<span class="number">5</span>:];</span><br><span class="line"><span class="string">''</span></span><br><span class="line">//从索引为<span class="number">0</span>的元素截取到整个字符串倒数第<span class="number">2</span>个元素：</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"hello"</span>[:<span class="number">-2</span>];</span><br><span class="line"><span class="string">'hel'</span></span><br><span class="line">//从倒数第<span class="number">2</span>个元素截取到最后：</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">"hello"</span>[<span class="number">-2</span>:];</span><br><span class="line"><span class="string">'lo'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>str[star,end,step]切片</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;hello world&quot;[0:8:2] # 从索引为0截取到索引为7的位置，步长为2；</span><br></pre></td></tr></table></figure>
<h6 id="字符索引"><a href="#字符索引" class="headerlink" title="字符索引"></a>字符索引</h6><p>获取字符串在另一个字符串中的索引：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="string">'hello'</span>.index(<span class="string">'o'</span>);</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>
<h6 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h6><p>replace方法会替换字符串中所有符合条件的字符串或字符；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="string">'hello'</span>.replace(<span class="string">'lo'</span>,<span class="string">'*'</span>);</span><br><span class="line"><span class="string">'hel*'</span></span><br></pre></td></tr></table></figure>
<h6 id="去除左右空格"><a href="#去除左右空格" class="headerlink" title="去除左右空格"></a>去除左右空格</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="string">'   hello  '</span>.strip();</span><br><span class="line"><span class="string">'hello'</span></span><br></pre></td></tr></table></figure>
<h6 id="字符串转换"><a href="#字符串转换" class="headerlink" title="字符串转换"></a>字符串转换</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取字符的整数编码:</span></span><br><span class="line">ord(str);</span><br><span class="line"><span class="comment">//把整数编码转换为对应的字符:</span></span><br><span class="line">chr(code);</span><br><span class="line"><span class="comment">//字符串转bytes:</span></span><br><span class="line"><span class="string">'ABC'</span>.encode(<span class="string">'ascii'</span>);</span><br><span class="line"><span class="string">'中文'</span>.encode(<span class="string">'utf-8'</span>);</span><br><span class="line"><span class="comment">//bytes转字符串:</span></span><br><span class="line">b<span class="string">'ABC'</span>.decode(<span class="string">'ascii'</span>); <span class="comment">//'ABC'</span></span><br><span class="line">b<span class="string">'\xe4\xb8\xad\xe6\x96\x87'</span>.decode(<span class="string">'utf-8'</span>) <span class="comment">//'中文'</span></span><br><span class="line"><span class="comment">//bytes解码，使用errors='ignore'忽略错误的字节</span></span><br><span class="line">b<span class="string">'\xe4\xb8\xad\xff'</span>.decode(<span class="string">'utf-8'</span>, errors=<span class="string">'ignore'</span>) <span class="comment">//'中'</span></span><br></pre></td></tr></table></figure>
<h4 id="list"><a href="#list" class="headerlink" title="list"></a>list</h4><blockquote>
<p>type = list</p>
</blockquote>
<p>list(列表)是一个可变的有序表，可以添加或删除其中的元素。</p>
<h5 id="列表的定义"><a href="#列表的定义" class="headerlink" title="列表的定义"></a>列表的定义</h5><p>列表类似js中的数组，支持任意数据类型的数据组合，支持一维到多维list;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//一维：任意类型的组合，通过下标索引来访问；</span><br><span class="line">arr1 = [1,2,3,4,&apos;hello&apos;,True];</span><br><span class="line">//多维列表：实质就是嵌套列表，通过arr[1][2]这种形式访问；</span><br><span class="line">[[1,2],[3,4,5],[True,False],&apos;hello&apos;]</span><br></pre></td></tr></table></figure>
<h5 id="列表的操作"><a href="#列表的操作" class="headerlink" title="列表的操作"></a>列表的操作</h5><p>列表的操作与有序数据类型的操作类似，<span style="color:red">请参考字符串的操作</span>；</p>
<h6 id="CRUD操作"><a href="#CRUD操作" class="headerlink" title="CRUD操作"></a>CRUD操作</h6><p>list=[]列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//添加元素</span><br><span class="line">list.append(&apos;Adam&apos;)</span><br><span class="line">//添加元素到指定索引位置</span><br><span class="line">list.insert(1, &apos;Jack&apos;)</span><br><span class="line">//删除末尾元素</span><br><span class="line">list.pop()</span><br><span class="line">//删除指定索引位置的元素</span><br><span class="line">list.pop(1)</span><br><span class="line">//指定位置元素重新赋值</span><br><span class="line">list[1] = &apos;Sarah&apos;</span><br><span class="line">//获取最后一个元素</span><br><span class="line">list[-1]</span><br><span class="line">//获取指定索引的值</span><br><span class="line">list[0]</span><br></pre></td></tr></table></figure>
<h6 id="列表长度"><a href="#列表长度" class="headerlink" title="列表长度"></a>列表长度</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(list)</span><br></pre></td></tr></table></figure>
<h6 id="数学运算-1"><a href="#数学运算-1" class="headerlink" title="数学运算"></a>数学运算</h6><ul>
<li>列表的加法：[1,2]+[3]=[1,2,3]</li>
<li>列表的乘法：[1,2]*2=[1,2,1,2]</li>
</ul>
<h6 id="截取"><a href="#截取" class="headerlink" title="截取"></a>截取</h6><p>支持类似字符串的冒号（:）切片操作，截取指定索引的列表元素（<span style="color:red">请参考字符串的操作</span>）；</p>
<h6 id="函数生成列表"><a href="#函数生成列表" class="headerlink" title="函数生成列表"></a>函数生成列表</h6><p>使用list(range(startIndex,stopIndex,stepLength))表达式生成list：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list(range(<span class="number">1</span>, <span class="number">22</span>))</span><br></pre></td></tr></table></figure>
<h5 id="列表生成式"><a href="#列表生成式" class="headerlink" title="列表生成式"></a>列表生成式</h5><p>列表生成式指在[]内使用一行表达式生成一个列表list的表达式；</p>
<blockquote>
<p>列表生成式作用的目标可以是列表、集合、元组，最终结果是list;</p>
</blockquote>
<p>1.列表生成式作用于list:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 循环列表生成式</span></span><br><span class="line">print([x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># os.listdir可以列出当前文件夹下的文件和目录</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">print([d <span class="keyword">for</span> d <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多层循环列表生成式</span></span><br><span class="line">print([m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">'ABC'</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">'XYZ'</span>])</span><br><span class="line">print([m + n + str(x) <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">'ABC'</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">'XYZ'</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带判断的列表生成式</span></span><br><span class="line">print([x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表生成式遍历dict字典内容</span></span><br><span class="line">d = &#123;<span class="string">'x'</span>: <span class="string">'A'</span>, <span class="string">'y'</span>: <span class="string">'B'</span>, <span class="string">'z'</span>: <span class="string">'C'</span>&#125;</span><br><span class="line">print([k + <span class="string">'='</span> + v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()])</span><br></pre></td></tr></table></figure>
<p>2.列表生成式作用在元组：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">r = [i ** i <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line">print(r)</span><br><span class="line"><span class="comment"># [1,4,9]</span></span><br></pre></td></tr></table></figure>
<h4 id="元组-tuple"><a href="#元组-tuple" class="headerlink" title="元组(tuple)"></a>元组(tuple)</h4><blockquote>
<p>type = tuple</p>
</blockquote>
<p>元组：tuple。tuple和list非常类似,都是Python内置的有序集合，但是tuple不可变，一旦初始化就不能修改,没有添加和删除方法,所以代码更安全，如果可能，<span style="color:red">能用tuple代替list就尽量用tuple</span>;</p>
<blockquote>
<p>注意：tuple如果内含可变元素，可变元素内部可以改变；</p>
</blockquote>
<h5 id="元组定义"><a href="#元组定义" class="headerlink" title="元组定义"></a>元组定义</h5><p>tuple的元素定义在圆括号()里;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个元组：</span></span><br><span class="line">tupleA = (<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>,<span class="number">1</span>,<span class="number">22</span>)</span><br><span class="line"><span class="comment">//定义一个空的tuple:</span></span><br><span class="line">t = ();</span><br><span class="line"><span class="comment">//定义只有1个元素的tuple:</span></span><br><span class="line">t = (<span class="number">1</span>,)</span><br></pre></td></tr></table></figure>
<h5 id="函数生成元组"><a href="#函数生成元组" class="headerlink" title="函数生成元组"></a>函数生成元组</h5><p>使用tuple(range(startIndex,stopIndex,stepLength))方法直接生成一个tuple:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tuple(range(<span class="number">1</span>, <span class="number">22</span>))</span><br></pre></td></tr></table></figure>
<h4 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h4><p>有顺序，每个元素都分配一个序号,序列包括：列表、元组、str，他们之间的操作都类似；</p>
<h5 id="序列操作"><a href="#序列操作" class="headerlink" title="序列操作"></a>序列操作</h5><h6 id="切片-截取"><a href="#切片-截取" class="headerlink" title="切片(截取)"></a>切片(截取)</h6><p>支持切片(截取)操作，参考字符串切片操作；</p>
<h6 id="逻辑包含"><a href="#逻辑包含" class="headerlink" title="逻辑包含"></a>逻辑包含</h6><p>支持逻辑in、not in运算符：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>] <span class="comment"># True</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">not</span> <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>] <span class="comment"># False</span></span><br></pre></td></tr></table></figure>
<h5 id="序列内置函数"><a href="#序列内置函数" class="headerlink" title="序列内置函数"></a>序列内置函数</h5><h6 id="最大值"><a href="#最大值" class="headerlink" title="最大值"></a>最大值</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max(序列)</span><br></pre></td></tr></table></figure>
<h6 id="最小值"><a href="#最小值" class="headerlink" title="最小值"></a>最小值</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min(序列)</span><br></pre></td></tr></table></figure>
<h6 id="长度-1"><a href="#长度-1" class="headerlink" title="长度"></a>长度</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(序列)</span><br></pre></td></tr></table></figure>
<h6 id="join"><a href="#join" class="headerlink" title="join"></a>join</h6><p>join函数使用分隔符将序列类型的变量组合成一个字符串；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">','</span>.join(<span class="string">'hello'</span>)</span><br><span class="line">print(s)</span><br><span class="line"><span class="comment"># h,e,l,l,o</span></span><br><span class="line"><span class="comment"># &lt;class 'str'&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h4><blockquote>
<p>type = set</p>
</blockquote>
<h5 id="集合的定义"><a href="#集合的定义" class="headerlink" title="集合的定义"></a>集合的定义</h5><ul>
<li>使用花括号{}包含元素,元素是<span style="color:red">不可变类型</span>数据，如字符串、数字和元组；</li>
<li>set是一组元素的集合，但不存储value。由于key不能重复，所以，在set中，<span style="color:red">没有重复的key</span>。</li>
</ul>
<h6 id="定义集合变量"><a href="#定义集合变量" class="headerlink" title="定义集合变量"></a>定义集合变量</h6><ul>
<li>方式一：直接赋值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x=&#123;1,2,3,&quot;hello&quot;&#125;</span><br><span class="line">&gt;&gt;&gt; type(x)</span><br><span class="line">&lt;class &apos;set&apos;&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>方式二：通过set([…])定义，需要提供一个list作为输入集合;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x=set(&#123;1&#125;)</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;1&#125;</span><br></pre></td></tr></table></figure>
<h6 id="空集合"><a href="#空集合" class="headerlink" title="空集合"></a>空集合</h6><p>空集合：set()，<span style="color:red">注意</span><span style="color:blue">{}不能表示空集合，type({})=dict(字典)</span></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; type(set())</span><br><span class="line">&lt;class &apos;set&apos;&gt;</span><br></pre></td></tr></table></figure>
<h5 id="集合的操作"><a href="#集合的操作" class="headerlink" title="集合的操作"></a>集合的操作</h5><h6 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h6><p>通过add(key)方法可以添加元素到set中，可以重复添加，但不会有效果；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = &#123;1&#125;</span><br><span class="line">&gt;&gt;&gt; x.add(4)</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;1, 4&#125;</span><br></pre></td></tr></table></figure>
<h6 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h6><p>通过remove(key)方法可以删除元素；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s = &#123;1,2,3&#125;</span><br><span class="line">&gt;&gt;&gt; s.remove(1)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;2, 3&#125;</span><br></pre></td></tr></table></figure>
<h5 id="集合的运算"><a href="#集合的运算" class="headerlink" title="集合的运算"></a>集合的运算</h5><ul>
<li>支持逻辑包含：in、not int；</li>
<li>支持求集合差集：{1,2,3}-{1}={2,3}</li>
<li>支持求集合交集：{1,2}&amp;{1}={1}</li>
<li>支持求集合合集：{1,2,3,4}|{3,4,7}={1,2,3,4,7}</li>
</ul>
<h4 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h4><blockquote>
<p>type = dict</p>
</blockquote>
<p>Python内置了字典：dict的支持，dict全称dictionary，在其他语言中也称为map，使用键-值（key-value）存储，具有极快的查找速度。</p>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul>
<li>查找和插入的速度极快，不会随着key的增加而变慢；</li>
<li>需要占用大量的内存，内存浪费多。</li>
<li>无序的(不支持索引)、不支持切片操作、不重复。</li>
</ul>
<h5 id="字典的定义"><a href="#字典的定义" class="headerlink" title="字典的定义"></a>字典的定义</h5><blockquote>
<p>字典的定义类似java的map,用花括号包裹许多个key:value，用逗号分隔；</p>
</blockquote>
<p>语法格式：{key1:value1,key2:value2,…} </p>
<blockquote>
<p>注意：key是不可变类型，value可以是任意类型；</p>
</blockquote>
<h6 id="空字典"><a href="#空字典" class="headerlink" title="空字典"></a>空字典</h6><p>空的字典：type({})=dict</p>
<h6 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h6><ul>
<li>例1：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;1:&apos;one&apos;,&apos;two&apos;:2&#125;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;1: &apos;one&apos;, &apos;two&apos;: 2&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>例2：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = &#123;1:2,&apos;1&apos;:1,(1,3):1,3:&#123;1,3&#125;,6:&#123;&apos;one&apos;:&apos;hello&apos;&#125;&#125;</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;1: 2, &apos;1&apos;: 1, (1, 3): 1, 3: &#123;1, 3&#125;, 6: &#123;&apos;one&apos;: &apos;hello&apos;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="key的特点"><a href="#key的特点" class="headerlink" title="key的特点"></a>key的特点</h5><ul>
<li>key不能相同，相同则会覆盖对用的value值；</li>
<li>key中数字和字符串被认为不同的key,如1，“key”;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = &#123;1:2,&apos;1&apos;:1&#125;</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;1: 2, &apos;1&apos;: 1&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>key的数据类型：是不可变的类型，包括：int，str，元组；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; x = &#123;1:2,&apos;1&apos;:1,(1,3):1&#125;</span><br><span class="line">&gt;&gt;&gt; x</span><br><span class="line">&#123;1: 2, &apos;1&apos;: 1, (1, 3): 1&#125;</span><br><span class="line">&gt;&gt;&gt; x.get((1,3))</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h5 id="字典的操作"><a href="#字典的操作" class="headerlink" title="字典的操作"></a>字典的操作</h5><h6 id="添加-1"><a href="#添加-1" class="headerlink" title="添加"></a>添加</h6><ul>
<li>直接通过d[key]=value的方式赋值；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d[1]=&apos;one&apos;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;1: &apos;one&apos;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>通过内置函数setdefault(key,defaultValue):如果键不存在于字典中，将会添加键并将值设为defaultValue;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d=&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d.setdefault(1,&apos;one&apos;)</span><br><span class="line">&apos;one&apos;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;1: &apos;one&apos;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="根据key获取值"><a href="#根据key获取值" class="headerlink" title="根据key获取值"></a>根据key获取值</h6><ul>
<li>d[key]: 中括号索引的方式，如果key不存在，dict就会报错；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;1:&apos;one&apos;&#125;</span><br><span class="line">&gt;&gt;&gt; d[1]</span><br><span class="line">&apos;one&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>d.get(key)的方式：如果key不存在，可以返回None；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;1:&apos;one&apos;&#125;</span><br><span class="line">&gt;&gt;&gt; d[1]</span><br><span class="line">&apos;one&apos;</span><br><span class="line">&gt;&gt;&gt; d.get(1) </span><br><span class="line">&apos;one&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d =&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d.get(1)</span><br><span class="line">&gt;&gt;&gt; type(d.get(1))</span><br><span class="line">&lt;class &apos;NoneType&apos;&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>d.get(key,default)的方式：如果key不存在返回default，但不会新增到字典中；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d.get(1,&apos;one&apos;)</span><br><span class="line">&apos;one&apos;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h6 id="删除key"><a href="#删除key" class="headerlink" title="删除key"></a>删除key</h6><p>要删除一个key，用pop(key)方法，对应的value也会从dict中删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d = &#123;1:&apos;one&apos;&#125;</span><br><span class="line">&gt;&gt;&gt; d.pop(1)</span><br><span class="line">&apos;one&apos;</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="遍历字典"><a href="#遍历字典" class="headerlink" title="遍历字典"></a>遍历字典</h5><p>语法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接遍历字典，默认遍历结果是dict的key</span></span><br><span class="line">students = &#123;<span class="string">'name'</span>: <span class="string">'张三'</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> students:</span><br><span class="line">    print(key)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 遍历返回key_value为key和value组成的元组</span></span><br><span class="line"><span class="keyword">for</span> key_value <span class="keyword">in</span> students.items():</span><br><span class="line">    print(key_value)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 遍历key：</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> students.keys():</span><br><span class="line">    print(key)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 遍历value：</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> students.values():</span><br><span class="line">    print(value)</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="number">1</span>: <span class="string">'one'</span>, <span class="number">2</span>: <span class="string">'two'</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key_value <span class="keyword">in</span> d.items():</span><br><span class="line">    print(key_value)</span><br><span class="line"><span class="comment"># 结果：(1, 'one') (2, 'two')</span></span><br></pre></td></tr></table></figure>
<h4 id="数据解构赋值"><a href="#数据解构赋值" class="headerlink" title="数据解构赋值"></a>数据解构赋值</h4><p>序列解包类似js里的解构赋值，但是解构左右两边数量必须对等；</p>
<h4 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h4><p>一边循环一边计算,根据前面的元素推算后面的元素的机制，称为生成器generator,generator也是可迭代对象；</p>
<h5 id="表达式生成器"><a href="#表达式生成器" class="headerlink" title="表达式生成器"></a>表达式生成器</h5><p>构建一个generator只需要将列表生成式的[]换成()即可得到generator对象；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>)]</span><br><span class="line">g = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>))</span><br><span class="line"><span class="comment"># print(g)</span></span><br><span class="line">print(next(g))</span><br><span class="line">print(next(g))</span><br><span class="line">print(next(g))</span><br><span class="line"><span class="comment"># 溢出时报错: StopIteration</span></span><br><span class="line">print(next(g))</span><br></pre></td></tr></table></figure>
<h5 id="函数生成器"><a href="#函数生成器" class="headerlink" title="函数生成器"></a>函数生成器</h5><ul>
<li>如果一个函数定义中包含yield关键字，那么这个函数就不再是一个普通函数，而是一个generator；</li>
<li>yield关键字：在每次调用next()的时候，执行函数遇到yield语句返回，再次执行时从上次返回的yield语句处继续执行。</li>
</ul>
<h6 id="定义示例"><a href="#定义示例" class="headerlink" title="定义示例"></a>定义示例</h6><p>以实现一个斐波那契数列函数为例来实现一个generator：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原实现斐波那契数列的函数实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(max)</span>:</span></span><br><span class="line">    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; max:</span><br><span class="line">        print(b)</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'done'</span></span><br><span class="line">    </span><br><span class="line">fib(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># yield关键字实现generator：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(max)</span>:</span></span><br><span class="line">    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; max:</span><br><span class="line">        <span class="keyword">yield</span> b</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'done'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = fib(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<h6 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h6><p>如果定义函数生成器最终return返回一个值，如果需要获得返回值的话，必须捕获StopIteration错误，返回值包含在StopIteration的value中：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(max)</span>:</span></span><br><span class="line">    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; max:</span><br><span class="line">        <span class="keyword">yield</span> b</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'done'</span></span><br><span class="line">    </span><br><span class="line">f = fib(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = next(f)</span><br><span class="line">        print(<span class="string">'g:'</span>, x)</span><br><span class="line">    <span class="keyword">except</span> StopIteration <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Generator return value:'</span>, e.value)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h5 id="生成器迭代"><a href="#生成器迭代" class="headerlink" title="生成器迭代"></a>生成器迭代</h5><p>使用next(g)可以遍历generator,但是不知道临界，所以一般都使用循环来迭代generator(不需要关心StopIteration的错误):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 循环来遍历生成器</span><br><span class="line">g = (x * x for x in range(3))</span><br><span class="line">for n in g:</span><br><span class="line">    print(n)</span><br></pre></td></tr></table></figure>
<h4 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h4><h5 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a>Iterable</h5><blockquote>
<p>可以直接作用于for循环的对象统称为可迭代对象：Iterable</p>
</blockquote>
<p>可迭代的数据类型有：</p>
<ul>
<li>一类是集合数据类型，如list、tuple、dict、set、str等；</li>
<li>一类是generator，包括生成器和带yield的generator function。</li>
</ul>
<h6 id="Iterable对象判断"><a href="#Iterable对象判断" class="headerlink" title="Iterable对象判断"></a>Iterable对象判断</h6><p>可以使用isinstance(aim,Iterable)内置函数来判断是否是Iterable对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Iterable</span><br><span class="line">&gt;&gt;&gt; isinstance([], Iterable)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(&#123;&#125;, Iterable)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(&apos;abc&apos;, Iterable)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance((x for x in range(10)), Iterable)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(100, Iterable)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h5 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h5><ul>
<li>可以被next()函数调用并不断返回下一个值的对象称为迭代器：Iterator。</li>
<li>Python的for循环本质上就是通过不断调用next()函数实现的；</li>
</ul>
<h6 id="Iterator对象判断"><a href="#Iterator对象判断" class="headerlink" title="Iterator对象判断"></a>Iterator对象判断</h6><p>可以使用isinstance()判断一个对象是否是Iterator对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Iterator</span><br><span class="line">&gt;&gt;&gt; isinstance((x for x in range(10)), Iterator)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance([], Iterator)</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; isinstance(&#123;&#125;, Iterator)</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; isinstance(&apos;abc&apos;, Iterator)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h6 id="Iterable转Iterator"><a href="#Iterable转Iterator" class="headerlink" title="Iterable转Iterator"></a>Iterable转Iterator</h6><blockquote>
<p>生成器都是Iterator对象，但list、dict、str虽然是Iterable，却不是Iterator。</p>
</blockquote>
<p>把list、dict、str等Iterable变成Iterator可以使用iter()函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(iter([]), Iterator)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(iter(&apos;abc&apos;), Iterator)</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
<h5 id="Iterator数据流对象"><a href="#Iterator数据流对象" class="headerlink" title="Iterator数据流对象"></a>Iterator数据流对象</h5><ul>
<li>Python的Iterator对象表示的是一个数据流，Iterator对象可以被next()函数调用并不断返回下一个数据，直到没有数据时抛出StopIteration错误。可以把这个数据流看做是一个有序序列，但我们却不能提前知道序列的长度，只能不断通过next()函数实现按需计算下一个数据，所以Iterator的计算是惰性的，只有在需要返回下一个数据时它才会计算。</li>
<li>Iterator甚至可以表示一个无限大的数据流，例如全体自然数。而使用list是永远不可能存储全体自然数的。</li>
</ul>
<h3 id="条件控制语句"><a href="#条件控制语句" class="headerlink" title="条件控制语句"></a>条件控制语句</h3><h4 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h4><p>if条件判断语句，判断表达式必须，返回结果可以使用pass占位，pass是空语句/占位语句；</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &lt;条件判断<span class="number">1</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">1</span>&gt;</span><br><span class="line"><span class="keyword">elif</span> &lt;条件判断<span class="number">2</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">2</span>&gt;</span><br><span class="line"><span class="keyword">elif</span> &lt;条件判断<span class="number">3</span>&gt;:</span><br><span class="line">    &lt;执行<span class="number">3</span>&gt;</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    &lt;执行<span class="number">4</span>&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if</span></span><br><span class="line"><span class="keyword">if</span> expression:</span><br><span class="line">    <span class="keyword">pass</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># if...else</span></span><br><span class="line"><span class="keyword">if</span> condition:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if...elif..else</span></span><br><span class="line"><span class="keyword">if</span> condition:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">elif</span> expression:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h5 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eg1：</span></span><br><span class="line">MOOD=<span class="keyword">False</span></span><br><span class="line"><span class="keyword">if</span> mood :</span><br><span class="line">    print(<span class="string">'good mood'</span>)</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    print(<span class="string">'bad mood'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># eg2：</span></span><br><span class="line">CONDIITON = <span class="keyword">False</span></span><br><span class="line"><span class="keyword">if</span> CONDIITON:</span><br><span class="line">    print(<span class="string">'True'</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="keyword">not</span> CONDIITON:</span><br><span class="line">    print(<span class="string">'False'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h4><blockquote>
<p>python中的三元表达式的效果类似java中的三目运算符(expression?r2:r2);</p>
</blockquote>
<ol>
<li>表达式格式：结果为真的返回 if 表达式 else 结果为假的返回</li>
<li>示例：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python中的三元表达式</span></span><br><span class="line">x = <span class="number">2</span></span><br><span class="line">y = <span class="number">3</span></span><br><span class="line">r = x <span class="keyword">if</span> x &gt; y <span class="keyword">else</span> y</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><h5 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h5><h6 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h6><p>当while表达式满足会一直循环执行while语句块中的逻辑，当不满足时跳出循环，或者执行else语句块；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># while</span><br><span class="line">while expression:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># while...else...</span><br><span class="line">while expression:</span><br><span class="line">    pass</span><br><span class="line">else:</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<h6 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># eg1</span><br><span class="line">counter = 1</span><br><span class="line">while counter&lt;=10:</span><br><span class="line">    print(counter)</span><br><span class="line">    counter+=1</span><br><span class="line">    </span><br><span class="line"># eg2</span><br><span class="line">counter=0</span><br><span class="line">while counter&lt;=10:</span><br><span class="line">    counter+=1</span><br><span class="line">    print(counter)</span><br><span class="line">else:</span><br><span class="line">    print(&apos;结束&apos;)</span><br></pre></td></tr></table></figure>
<h5 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h5><ul>
<li>for循环的目标是可迭代对象类型(Iterable)的数据，就可以使用for循环进行迭代。</li>
<li>判断一个对象是否是<span style="color:red">可迭代对象</span>，通过collections模块的Iterable类型判断；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Iterable</span><br><span class="line">&gt;&gt;&gt; isinstance(&apos;abc&apos;, Iterable) # str是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance([1,2,3], Iterable) # list是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(123, Iterable) # 整数是否可迭代</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h6 id="for…in…循环"><a href="#for…in…循环" class="headerlink" title="for…in…循环"></a>for…in…循环</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for...in...循环遍历列表</span></span><br><span class="line">arrays=[<span class="string">'apple'</span>,<span class="string">'orange'</span>,<span class="string">'banana'</span>]</span><br><span class="line"><span class="keyword">for</span> fruit <span class="keyword">in</span> arrays:</span><br><span class="line">    print(fruit+<span class="string">','</span>, end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 嵌套for...in...循环遍历列表；</span></span><br><span class="line">arrays=[[<span class="string">'apple'</span>,<span class="string">'orange'</span>,<span class="string">'banana'</span>],(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>)]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> arrays:</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> x:</span><br><span class="line">        print(y)</span><br></pre></td></tr></table></figure>
<h6 id="for…in…else循环"><a href="#for…in…else循环" class="headerlink" title="for…in…else循环"></a>for…in…else循环</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for...in...else循环结束后执行else;</span></span><br><span class="line">arrays=[[<span class="string">'apple'</span>,<span class="string">'orange'</span>,<span class="string">'banana'</span>],(<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>)]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> arrays:</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> x:</span><br><span class="line">        print(y)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'game over'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="for…in-range循环"><a href="#for…in-range循环" class="headerlink" title="for…in range循环"></a>for…in range循环</h6><p>for…in range(startIndex,endIndex,step)循环按索引访问数据，不包含endIndex;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以步长1，遍历列表：</span></span><br><span class="line">arrays = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(arrays),<span class="number">1</span>):</span><br><span class="line">    print(arrays[i], end=<span class="string">' | '</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 以步长1，倒序遍历列表：倒序时步长要为负数；</span></span><br><span class="line">arrays = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(arrays)<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">    print(arrays[i], end=<span class="string">' | '</span>)</span><br></pre></td></tr></table></figure>
<h6 id="for循环获取索引"><a href="#for循环获取索引" class="headerlink" title="for循环获取索引"></a>for循环获取索引</h6><blockquote>
<p>Python内置的enumerate函数可以把一个list变成索引-元素对，这样就可以在for循环中同时迭代索引和元素本身：</p>
</blockquote>
<ul>
<li>eg1: 遍历列表：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for i, value in enumerate([&apos;A&apos;, &apos;B&apos;, &apos;C&apos;]):</span><br><span class="line">...     print(i, value)</span><br><span class="line">...</span><br><span class="line">0 A</span><br><span class="line">1 B</span><br><span class="line">2 C</span><br></pre></td></tr></table></figure>
<ul>
<li>eg2: 遍历由元组组成的列表：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, (x, y) <span class="keyword">in</span> enumerate([(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">9</span>)]):</span><br><span class="line">    print(i, x, y)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line"><span class="comment"># 0 1 1</span></span><br><span class="line"><span class="comment"># 1 2 4</span></span><br><span class="line"><span class="comment"># 2 3 9</span></span><br></pre></td></tr></table></figure>
<h4 id="循环控制语句"><a href="#循环控制语句" class="headerlink" title="循环控制语句"></a>循环控制语句</h4><h5 id="break"><a href="#break" class="headerlink" title="break"></a>break</h5><p>break 仅终止当前循环,终止当前循环后不会执行当前循环的else,如果外层还有循环，则继续执行外层的循环；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arrays=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> arrays:</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(x)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'break终端循环后，不会执行else的逻辑'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h5><p>continue：结束当前循环，继续执行下个循环；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arrays=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> arrays:</span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    print(x)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'结束'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="Python实现java语言switch特性"><a href="#Python实现java语言switch特性" class="headerlink" title="Python实现java语言switch特性"></a>Python实现java语言switch特性</h4><p>Python中没有类似java语言的switch API,可以用elif或者字典来代替;</p>
<h5 id="字典switch"><a href="#字典switch" class="headerlink" title="字典switch"></a>字典switch</h5><p>这里主要是dict字典来实现switch语法；</p>
<ul>
<li>key对应简单的值：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单的switch,利用字典的key实现</span></span><br><span class="line">swicher = &#123;</span><br><span class="line">    <span class="number">1</span>:<span class="string">'one'</span>,</span><br><span class="line">    <span class="number">2</span>:<span class="string">'two'</span>,</span><br><span class="line">    <span class="number">3</span>:<span class="string">'three'</span></span><br><span class="line">&#125;</span><br><span class="line">print(swicher.get(<span class="number">7</span>,<span class="string">'default'</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>key对应函数：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOne</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'one'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getTwo</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'two'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getThree</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'three'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDefault</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'invalid value='</span>+str(args[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">swicher = &#123;</span><br><span class="line">    <span class="number">1</span> : getOne,</span><br><span class="line">    <span class="number">2</span> : getTwo,</span><br><span class="line">    <span class="number">3</span> : getThree</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">day = <span class="number">12</span></span><br><span class="line"><span class="comment">#  函数中传参数，在最后的()中传：</span></span><br><span class="line">day_name = swicher.get(day,getDefault)(day)</span><br><span class="line">print(day_name)</span><br></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h4><blockquote>
<p><a href="https://docs.python.org/3/library/functions.html" target="_blank" rel="noopener">内置函数文档地址</a></p>
</blockquote>
<p>python内置了许多函数，可以直接调用,常用的内置函数有：</p>
<ul>
<li>abs(x): 计算x的绝对值；</li>
<li>max(a,b,…): 获取多个参数的最大值；</li>
</ul>
<h4 id="函数命名"><a href="#函数命名" class="headerlink" title="函数命名"></a>函数命名</h4><p>函数命名：函数名使用小写字母，单词之间使用下划线(_)分割；</p>
<h4 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h4><ul>
<li>定义一个函数要使用def语句，依次写出函数名、括号、括号中的参数和冒号:，然后，在缩进块中编写函数体，函数的返回值用return语句返回。</li>
<li>如果没有return语句，函数执行完毕后也会返回结果，只是结果为None。</li>
<li>return None也可以简写为return。</li>
</ul>
<h5 id="py文件定义函数"><a href="#py文件定义函数" class="headerlink" title="py文件定义函数"></a>py文件定义函数</h5><ul>
<li>定义一个空函数：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">funcname</span><span class="params">(parameter_list)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>定义一个求绝对值的函数；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数</span></span><br><span class="line">print(my_abs(<span class="number">-5</span>)) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>
<h5 id="python交互环境定义函数"><a href="#python交互环境定义函数" class="headerlink" title="python交互环境定义函数"></a>python交互环境定义函数</h5><p>在Python交互环境中定义函数时，注意Python会出现…的提示。函数定义结束后需要按两次回车重新回到&gt;&gt;&gt;提示符下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; def my_abs(x):     </span><br><span class="line">...     if x &gt;= 0:     </span><br><span class="line">...         return x   </span><br><span class="line">...     else:          </span><br><span class="line">...         return -x  </span><br><span class="line">...                    </span><br><span class="line">&gt;&gt;&gt; my_abs(-9)         </span><br><span class="line">9</span><br></pre></td></tr></table></figure>
<h5 id="函数返回多个值"><a href="#函数返回多个值" class="headerlink" title="函数返回多个值"></a>函数返回多个值</h5><p>函数返回多个值时，python将多个值放到一个tuple中，语法上可以省略():</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_value</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>, <span class="number">88</span></span><br><span class="line"></span><br><span class="line">print(multi_value()) <span class="comment"># (1, 88)</span></span><br></pre></td></tr></table></figure>
<h5 id="函数的参数"><a href="#函数的参数" class="headerlink" title="函数的参数"></a>函数的参数</h5><h6 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h6><p>定义函数时，函数的参数可以设置默认值,设置默认值使用等号直接赋值即可：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfn</span><span class="params">(name, sex=<span class="string">'man'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'name='</span> + name + <span class="string">',sex='</span> + sex</span><br><span class="line"></span><br><span class="line">print(myfn(<span class="string">'ethan'</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p><span style="color:orange">定义默认参数要牢记一点：默认参数必须指向不变对象！</span></p>
</blockquote>
<h6 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h6><blockquote>
<p>可变参数允许你传入0个或任意个参数，这些可变参数在函数调用时自动组装为一个tuple.</p>
</blockquote>
<p>定义函数时接收的参数个数不确定时，可以在参数前加*，此时参数就是可变参数；</p>
<blockquote>
<p>在调用接收可变参数的函数时，如果传入已有的list或tuple作为多个参数时,需要在调用处给list或tuple前也加*，这样list或tuple的元素才能正确转化为一个元组，否则转化后的元组只有整个list或整个tuple作为1个参数；</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfn</span><span class="params">(*args)</span>:</span></span><br><span class="line">    print(type(args))</span><br><span class="line">    print(args)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">print(myfn(*[<span class="number">1</span>, <span class="number">33</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line"><span class="comment"># &lt;class 'tuple'&gt;</span></span><br><span class="line"><span class="comment"># ('ethan', 1, 33)</span></span><br><span class="line"><span class="comment"># None</span></span><br></pre></td></tr></table></figure>
<h6 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h6><blockquote>
<p>关键字参数允许你传入0个或任意个含参数名的参数，这些关键字参数在函数内部自动组装为一个dict.</p>
</blockquote>
<p>关键字参数使用 **kw表示；</p>
<blockquote>
<p>在调用接收关键字参数的函数时，如果传入已有的dict作为多个参数时,需要在调用处给dict前也加**，这样dict的元素才能正确转化为一个dict，否则转化后的dict只有整个dict作为1个参数；</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfn</span><span class="params">(**kw)</span>:</span></span><br><span class="line">    print(type(kw))</span><br><span class="line">    print(kw)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">'name'</span>: <span class="string">'ethan'</span>&#125;</span><br><span class="line">print(myfn(**d))</span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line"><span class="comment"># &lt;class 'dict'&gt;</span></span><br><span class="line"><span class="comment"># &#123;'name': 'ethan'&#125;</span></span><br><span class="line"><span class="comment"># None</span></span><br></pre></td></tr></table></figure>
<h6 id="命名关键字参数"><a href="#命名关键字参数" class="headerlink" title="命名关键字参数"></a>命名关键字参数</h6><p>命名关键字参数主要是为了限制调用者传入哪些参数名的参数，如果传入了函数未声明接收的参数名则会报错，是非必要参数；</p>
<p><strong style="color:red">注意点</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 关键字参数**kw不同，命名关键字参数需要一个特殊分隔符*，*后面的参数被视为命名关键字参数。</span><br><span class="line">- 如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符*了。</span><br><span class="line">- 命名关键字参数必须传入参数名，这和位置参数不同。如果没有传入参数名，调用将报错。</span><br><span class="line">- 命名关键字参数可以有缺省值，即可以设置默认值；</span><br><span class="line">- 使用命名关键字参数时，要特别注意，如果没有可变参数，就必须加一个*作为特殊分隔符。如果缺少*，Python解释器将无法识别位置参数和命名关键字参数。</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfn</span><span class="params">(name, *, city, age=<span class="number">23</span>)</span>:</span></span><br><span class="line">    print(name + <span class="string">","</span> + str(age) + <span class="string">"岁,现居"</span> + city)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">d = &#123;<span class="string">'city'</span>: <span class="string">'北京'</span>&#125;</span><br><span class="line">myfn(<span class="string">'ethan'</span>, **d)</span><br><span class="line"><span class="comment"># 结果：ethan,23岁,现居北京</span></span><br></pre></td></tr></table></figure>
<h6 id="参数组合"><a href="#参数组合" class="headerlink" title="参数组合"></a>参数组合</h6><p>在Python中定义函数，可以用必选参数、默认参数、可变参数、关键字参数和命名关键字参数，这5种参数都可以组合使用。</p>
<blockquote>
<p><span style="color:red">参数定义的顺序</span>必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数。</p>
</blockquote>
<p><strong>要点</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-  虽然可以组合多达5种参数，但不要同时使用太多的组合，否则函数接口的可理解性很差。</span><br><span class="line">-  对于任意函数，都可以通过类似func(*args, **kw)的形式定义。</span><br></pre></td></tr></table></figure></p>
<p><strong>示例</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">(a, b, c=<span class="string">'None'</span>, *args, name, **kw)</span>:</span></span><br><span class="line">    print(<span class="string">'a ='</span>, a, <span class="string">'b ='</span>, b, <span class="string">'c ='</span>, c, <span class="string">'args ='</span>, args, <span class="string">'name ='</span>, name, <span class="string">'kw ='</span>, kw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span><span class="params">(a, b, c=<span class="string">'None'</span>, *, name, **kw)</span>:</span></span><br><span class="line">    print(<span class="string">'a ='</span>, a, <span class="string">'b ='</span>, b, <span class="string">'c ='</span>, c, <span class="string">'name ='</span>, name, <span class="string">'kw ='</span>, kw)</span><br><span class="line"></span><br><span class="line">d1 = &#123;<span class="string">'name'</span>: <span class="string">'name'</span>&#125;</span><br><span class="line">d2 = &#123;<span class="string">'other'</span>: <span class="string">'other'</span>&#125;</span><br><span class="line"></span><br><span class="line">f1(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'*args'</span>, **d1, **d2)</span><br><span class="line"><span class="comment"># a = a b = b c = c args = ('*args',) name = name kw = &#123;'other': 'other'&#125;</span></span><br><span class="line">f2(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, **d1, **d2)</span><br><span class="line"><span class="comment"># a = a b = b c = c name = name kw = &#123;'other': 'other'&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="函数的要点"><a href="#函数的要点" class="headerlink" title="函数的要点"></a>函数的要点</h4><ul>
<li>函数可以赋值给变量：f=fn()-&gt;f()；</li>
<li>函数可以作为参数：fn(fn1())；</li>
<li>函数内可以再定义函数，函数可以作为函数的返回；</li>
<li>函数内的变量和模块的变量同名时，就近原则，优先使用函数内定义的变量；</li>
<li>函数内给模块变量赋值：python就会看做这是重新定义一个与模块变量同名的局部变量；</li>
<li>函数内给模块变量赋值：需要在函数内使用<span style="color:red">global</span>关键字重新声明一下模块变量为全局变量；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 函数中的函数调用</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">curve_pre</span><span class="params">()</span>:</span></span><br><span class="line">    a=<span class="number">25</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">curve</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> a*x*x</span><br><span class="line">    <span class="keyword">return</span> curve</span><br><span class="line">    </span><br><span class="line">f = curve_pre()</span><br><span class="line">print(f(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数中重新赋值模块变量：</span></span><br><span class="line">origin=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_step</span><span class="params">(step)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> origin</span><br><span class="line">    new_step = origin + step</span><br><span class="line">    origin = new_step</span><br><span class="line">    <span class="keyword">return</span> new_step</span><br><span class="line">    </span><br><span class="line">print(count_step(<span class="number">2</span>))</span><br><span class="line">print(count_step(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>
<h4 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h4><p>如果一个函数在内部调用自身本身，这个函数就是递归函数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> n * fact(n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">print(fact(<span class="number">998</span>))</span><br></pre></td></tr></table></figure>
<h5 id="递归栈溢出"><a href="#递归栈溢出" class="headerlink" title="递归栈溢出"></a>递归栈溢出</h5><p>使用递归函数需要注意防止栈溢出。在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。可以试试fact(1000)；</p>
<p>解决递归调用栈溢出的方法是通过<span style="color:red">尾递归</span>优化；</p>
<h5 id="尾递归优化"><a href="#尾递归优化" class="headerlink" title="尾递归优化"></a><span style="color:gray"><del>尾递归优化</del></span></h5><p>尾递归是指，对函数返回的优化，即：<span style="color:blue">函数返回时调用函数自身</span>，并且，<span style="color:blue">return语句不能包含调用函数自身之外的表达式</span>。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p>
<blockquote>
<p><span style="color:red">严重警告</span>：Python标准的解释器没有针对尾递归做优化，任何递归函数都存在栈溢出的问题。</p>
</blockquote>
<h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><blockquote>
<p>纯粹的函数式编程语言编写的函数没有变量；</p>
</blockquote>
<p>Python的函数允许使用变量，因此，Python不是纯函数式编程语言。</p>
<h4 id="函数式编程特点"><a href="#函数式编程特点" class="headerlink" title="函数式编程特点"></a>函数式编程特点</h4><ul>
<li>允许使用变量；</li>
<li>允许把函数本身作为参数传入另一个函数；</li>
<li>函数允许返回一个函数；</li>
<li>函数内可以定义函数；</li>
<li><span style="color:red">函数名可以赋值给变量</span>，此时不会立刻执行函数，使用变量名加圆括号f()调用;</li>
</ul>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>当函数<span style="color:red">返回一个函数名</span>时，函数名对应的函数并没有立刻执行，而是直到调用了f()才执行，这称为闭包(closure).</p>
<h5 id="闭包的特点"><a href="#闭包的特点" class="headerlink" title="闭包的特点"></a>闭包的特点</h5><ul>
<li>闭包返回的函数并未执行，返回函数中不要引用任何可能会变化的变量;</li>
<li>闭包返回的函数每次调用都会返回一个新的函数，并且每次调用互不影响;</li>
<li>闭包返回的函数内，通过nonlocal关键字声明变量不是局部变量，而是父函数的变量；</li>
</ul>
<h5 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h5><ul>
<li>eg1: 一个简单的闭包</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">             <span class="keyword">return</span> i*i</span><br><span class="line">        fs.append(f)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line"></span><br><span class="line">f= count()</span><br><span class="line">f() <span class="comment"># 9</span></span><br></pre></td></tr></table></figure>
<ul>
<li>eg3：闭包返回的函数内的非局部变量：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">origin = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factory</span><span class="params">(pos)</span>:</span></span><br><span class="line">    x = pos</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">go</span><span class="params">(step)</span>:</span></span><br><span class="line">        <span class="comment"># nonlocal声明非局部变量，即父函数的变量；</span></span><br><span class="line">        <span class="keyword">nonlocal</span> x</span><br><span class="line">        new_step = step + x</span><br><span class="line">        x = new_step</span><br><span class="line">        <span class="keyword">return</span> new_step</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> go</span><br><span class="line"></span><br><span class="line">tourist = factory(origin)</span><br><span class="line">print(tourist(<span class="number">2</span>))  <span class="comment"># 2</span></span><br><span class="line">print(tourist(<span class="number">3</span>))  <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>
<h5 id="闭包函数的闭包信息"><a href="#闭包函数的闭包信息" class="headerlink" title="闭包函数的闭包信息"></a>闭包函数的闭包信息</h5><ul>
<li>打印f函数的闭包信息</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__closure__)</span><br></pre></td></tr></table></figure>
<ul>
<li>打印f函数闭包内环境变量(环境变量按字母排序对应索引)的值</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(f.__closure__[<span class="number">0</span>].cell_contents)</span><br></pre></td></tr></table></figure>
<h5 id="闭包的缺点"><a href="#闭包的缺点" class="headerlink" title="闭包的缺点"></a>闭包的缺点</h5><ul>
<li>闭包根函数的变量（环境变量）常驻内存，容易发生内存泄漏；</li>
</ul>
<h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><p>在Python中，对匿名函数提供了有限支持,匿名函数有个限制，就是只能有一个表达式，不用写return，返回值就是该表达式的结果。</p>
<h5 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h5><p>关键字lambda用来修饰匿名函数，使用冒号分割参数和返回表达式，冒号前面的x表示函数参数，冒号后面是返回结果。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匿名函数示例</span></span><br><span class="line"><span class="keyword">lambda</span> x: x * x</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br></pre></td></tr></table></figure>
<h4 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h4><blockquote>
<p>在代码运行期间动态增加函数的功能而且不会改变原有函数的定义的方式，称之为装饰器（Decorator）。</p>
</blockquote>
<p>装饰器：可以不改变函数逻辑，给函数新增功能；</p>
<h5 id="装饰器函数"><a href="#装饰器函数" class="headerlink" title="装饰器函数"></a>装饰器函数</h5><ol>
<li>定义装饰器函数：<br>定义一个装饰器函数，需要接收一个被装饰函数为参数，装饰器内部定义一个返回被装饰函数的扩展功能函数，最终装饰器函数返回扩展功能函数<span style="color:blue"> (需要注意：扩展函数应该加@functools.wraps(func)修饰，确保最终返回的函数保持被装饰函数本身的属性)</span>。</li>
<li>使用装饰器函数：<br>当我们给被装饰函数上方添加声明：@装饰器函数名，此时直接调用被装饰函数时就得到了扩展的功能，实际是一种装饰模式（AOP编程思想）；</li>
</ol>
<h6 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h6><ol>
<li>定义一个打印日志的装饰器函数：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="comment"># @functools.wraps的作用是让返回的wrapper函数保持func函数的属性；</span></span><br><span class="line"><span class="meta">    @functools.wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">        <span class="comment"># 在运行被修饰的函数前打印一行日志</span></span><br><span class="line">        print(<span class="string">'call %s() start'</span> % func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># @log = log(func_test)</span></span><br><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="comment"># 调用结束的log</span></span><br><span class="line">    print(<span class="string">'call %s() end'</span> % <span class="string">'func_test'</span>)</span><br><span class="line"></span><br><span class="line">f = func_test</span><br><span class="line">f()</span><br><span class="line">print(f.__name__)</span><br></pre></td></tr></table></figure>
<h5 id="装饰器函数带参数"><a href="#装饰器函数带参数" class="headerlink" title="装饰器函数带参数"></a>装饰器函数带参数</h5><p>如果装饰器本身需要传入参数，定义最外层装饰器函数接收参数，内部定义一个无参数的装饰器函数，最外层有参数的装饰器函数返回无参数的装饰器函数名即可；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_has_argument</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="comment"># @functools.wraps的作用是让返回的wrapper函数保持func函数的属性；</span></span><br><span class="line"><span class="meta">        @functools.wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">            print(<span class="string">'接收了一个参数text=%s'</span> % text)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># @log = log(args)(func_test)</span></span><br><span class="line"><span class="meta">@log_has_argument('我是参数')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func_test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"hello"</span>)</span><br><span class="line">    <span class="comment"># 调用结束的log</span></span><br><span class="line">    print(<span class="string">'call func_test() end'</span>)</span><br><span class="line"></span><br><span class="line">f = func_test</span><br><span class="line">f()</span><br></pre></td></tr></table></figure>
<h5 id="装饰器通用优化"><a href="#装饰器通用优化" class="headerlink" title="装饰器通用优化"></a>装饰器通用优化</h5><ul>
<li>装饰器内给被装饰函数支持可变参数：func(*args);</li>
<li>装饰器内给被装饰函数支持可变参数和可变关键字参数：func(<em>args,*</em>kw);</li>
</ul>
<h4 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h4><blockquote>
<p>Python的functools模块提供了很多有用的功能，其中一个就是偏函数（Partial function）。</p>
</blockquote>
<h5 id="创建偏函数"><a href="#创建偏函数" class="headerlink" title="创建偏函数"></a>创建偏函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 创建偏函: functools.partial就是帮助我们创建一个偏函数的;</span><br><span class="line">2&gt; 创建偏函数时，实际上可以接收函数对象、*args和**kw这3个参数;</span><br><span class="line">3&gt; functools.partial的作用就是，把一个函数的某些参数给固定住（也就是设置默认值）。</span><br><span class="line">4&gt; 调用创建好的偏函数，还可以改变默认参数;</span><br></pre></td></tr></table></figure>
<h6 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h6><ol>
<li>创建一个偏函数：用于求2进制数对应10进制:</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个偏函数：用于求2进制数对应10进制</span></span><br><span class="line">int2 = functools.partial(int, base=<span class="number">2</span>)</span><br><span class="line">print(int2(<span class="string">'1000000'</span>))</span><br><span class="line"><span class="comment"># 调用创建好的偏函数，可以改变默认参数</span></span><br><span class="line">print(int2(<span class="string">'1000000'</span>, base=<span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<h5 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h5><p>当函数的参数个数太多，需要简化时，使用functools.partial可以创建一个新的函数（偏函数），这个新函数可以固定住原函数的部分参数，从而在调用时更简单。</p>
<h4 id="内建的高阶函数"><a href="#内建的高阶函数" class="headerlink" title="内建的高阶函数"></a>内建的高阶函数</h4><blockquote>
<p>变量可以指向函数，函数的参数能接收变量，函数可以接收另一个函数作为参数，这种函数就称之为高阶函数。</p>
</blockquote>
<p>python提供了许多内建的高阶函数供开发者调用；</p>
<h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><p>map将传入的函数依次作用到序列的每个元素，并把结果作为新的Iterator返回。</p>
<h6 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h6><p>1&gt; 语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map(fn,iterableData)</span><br></pre></td></tr></table></figure>
<p>2&gt; 参数说明：</p>
<ul>
<li>fn：函数；</li>
<li>iterableData：iterable类型的数据；</li>
</ul>
<h6 id="示例-6"><a href="#示例-6" class="headerlink" title="示例"></a>示例</h6><ol>
<li>对序列中的每个元素求平方：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line">r = map(f, [<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">print(list(r))</span><br><span class="line"><span class="comment"># [1,4]</span></span><br></pre></td></tr></table></figure>
<ol>
<li>将序列的元素都转str:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(map(str, [1, 2, 3, 4, 5, 6, 7, 8, 9]))</span><br><span class="line">[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;]</span><br></pre></td></tr></table></figure>
<h5 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h5><blockquote>
<p>reduce函数来自functools模块；</p>
</blockquote>
<p>reduce把一个函数作用在一个序列[x1, x2, x3, …]上，这个函数必须接收两个参数，reduce把结果继续和序列的下一个元素做<span style="color:red">累积</span>计算,返回一个计算结果，其效果就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<h6 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduce(function, sequence, initial=None)</span><br></pre></td></tr></table></figure>
<h6 id="示例-7"><a href="#示例-7" class="headerlink" title="示例"></a>示例</h6><ol>
<li>reduce累加序列中元素的实现： </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from functools import reduce</span><br><span class="line"></span><br><span class="line">def fn(x, y):</span><br><span class="line">    return x + y</span><br><span class="line"></span><br><span class="line">print(reduce(fn, [1, 3, 5]))</span><br></pre></td></tr></table></figure>
<ol>
<li>把序列[1, 3, 5, 7, 9]变换成整数13579:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from functools import reduce</span><br><span class="line"></span><br><span class="line">def fn(x, y):</span><br><span class="line">    return x*10 + y</span><br><span class="line"></span><br><span class="line">print(reduce(fn, [1, 3, 5]))</span><br></pre></td></tr></table></figure>
<h5 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h5><blockquote>
<p>Python内建的filter()函数用于过滤序列,filter()函数返回的是一个Iterator;</p>
</blockquote>
<p>和map()类似，filter()也接收一个函数和一个序列。和map()不同的是，filter()把传入的函数依次作用于每个元素，然后根据返回值是True还是False决定保留还是丢弃该元素。</p>
<h6 id="示例-8"><a href="#示例-8" class="headerlink" title="示例"></a>示例</h6><ol>
<li>在一个list中，删掉偶数，只保留奇数：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_odd</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">r = list(filter(is_odd, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>]))</span><br><span class="line">print(r)</span><br><span class="line"><span class="comment"># [1, 5, 9, 15]</span></span><br></pre></td></tr></table></figure>
<h5 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h5><ul>
<li>Python内置的sorted()函数就可以直接对list进行排序;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sorted([36, 5, -12, 9, -21])</span><br><span class="line">[-21, -12, 5, 9, 36]</span><br></pre></td></tr></table></figure>
<ul>
<li>sorted()函数也是一个高阶函数，它还可以接收一个key函数来实现自定义的排序，key指定的函数将作用于list的每一个元素上，并根据key函数返回的结果进行排序；</li>
</ul>
<h6 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sorted(list, func, reverse):</span><br><span class="line"># reverse: 是否倒序；</span><br></pre></td></tr></table></figure>
<h6 id="示例-9"><a href="#示例-9" class="headerlink" title="示例"></a>示例</h6><ol>
<li>对list元素求绝对值后再排序：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; sorted([36, 5, -12, 9, -21], key=abs, reverse=false)</span><br><span class="line">[5, 9, -12, -21, 36]</span><br></pre></td></tr></table></figure>
<h6 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h6><ul>
<li>默认情况下，对字符串排序，是按照ASCII的大小比较的，由于’Z’ &lt; ‘a’，结果，大写字母Z会排在小写字母a的前面。</li>
</ul>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><h4 id="模块的概念"><a href="#模块的概念" class="headerlink" title="模块的概念"></a>模块的概念</h4><p>在Python中，一个.py文件就称之为一个模块（Module）。</p>
<ul>
<li>模块是一组Python代码的集合，可以使用其他模块，也可以被其他模块使用。</li>
<li>模块还可以避免函数名和变量名冲突。相同名字的函数和变量完全可以分别存在不同的模块中。</li>
</ul>
<h5 id="模块的命名"><a href="#模块的命名" class="headerlink" title="模块的命名"></a>模块的命名</h5><ul>
<li>模块名要遵循Python变量命名规范，不要使用中文、特殊字符；</li>
<li>模块名不要和系统模块名冲突，最好先查看系统是否已存在该模块，检查方法是在Python交互环境执行import abc，若成功则说明系统存在此模块。</li>
</ul>
<h4 id="包"><a href="#包" class="headerlink" title="包"></a>包</h4><p>为了避免模块名冲突，Python引入了按目录来组织模块的方法，称为包（Package）。</p>
<h5 id="包的定义"><a href="#包的定义" class="headerlink" title="包的定义"></a>包的定义</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果目录文件夹中有一个__init__.py文件，Python就把这个目录当成包，否则Python就把这个目录当成普通目录。</span><br></pre></td></tr></table></figure>
<h5 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&gt; __init__.py可以是空文件，也可以有Python代码，因为__init__.py本身就是一个模块，它的模块名就是包名。</span><br><span class="line">2&gt; 包可以有多级目录，即包内可以包含包，组成多级层次的包结构。</span><br></pre></td></tr></table></figure>
<h5 id="示例-10"><a href="#示例-10" class="headerlink" title="示例"></a>示例</h5><ol>
<li>mypackage多级层次的包结构：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mypackage</span><br><span class="line"> ├─ __init__.py</span><br><span class="line"> ├─ web</span><br><span class="line"> │  ├─ __init__.py</span><br><span class="line"> │  ├─ utils.py</span><br><span class="line"> │  └─ www.py</span><br><span class="line"> ├─ __init__.py</span><br><span class="line"> ├─ abc.py</span><br><span class="line"> └─ xyz.py</span><br></pre></td></tr></table></figure>
<h4 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a>导入模块</h4><p>Python模块文件导入另一个模块后，当前模块就可以通过(包名.)模块名或者别名来访问模块中的所有功能了。</p>
<h5 id="导入模块注意点"><a href="#导入模块注意点" class="headerlink" title="导入模块注意点"></a>导入模块注意点</h5><ul>
<li>当python中的模块1导入了模块2，则模块2里的代码会被执行一遍；</li>
<li>要<span style="color:red">避免循环导入</span>：如module1引用module2，module2又引用module1；</li>
</ul>
<h5 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h5><p>导入其它模块的语法有两种方式：</p>
<ol>
<li>方式一：import…</li>
<li>方式二：from…import…</li>
</ol>
<h6 id="import…"><a href="#import…" class="headerlink" title="import…"></a>import…</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> package_name.module_name <span class="keyword">as</span> alias</span><br><span class="line"><span class="comment"># package_name: 包名</span></span><br><span class="line"><span class="comment"># module_name：模块名</span></span><br><span class="line"><span class="comment"># alias: 别名</span></span><br></pre></td></tr></table></figure>
<h6 id="from…import…"><a href="#from…import…" class="headerlink" title="from…import…"></a>from…import…</h6><ol>
<li>注意点：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">【注意】</span><br><span class="line">1&gt; 当使用from...import导入一个模块中的多个成员,用逗号隔开: from utils.m1 import a, b;</span><br><span class="line">2&gt; 当使用from...import *时,可以在被导入的模块文件中用__all__=[&apos;elemnt1&apos;,...]列表来表示*要导出的元素名；</span><br></pre></td></tr></table></figure>
<ol>
<li>语法格式：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> [包名.]模块 <span class="keyword">import</span> 函数/变量</span><br><span class="line"><span class="keyword">from</span> [包名] <span class="keyword">import</span> 模块</span><br><span class="line"><span class="comment"># 不推荐用*</span></span><br><span class="line"><span class="keyword">from</span> [包名][模块] <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h5 id="模块导入示例"><a href="#模块导入示例" class="headerlink" title="模块导入示例"></a>模块导入示例</h5><h6 id="导入内建模块"><a href="#导入内建模块" class="headerlink" title="导入内建模块"></a>导入内建模块</h6><p>以导入sys模块为例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br></pre></td></tr></table></figure>
<h6 id="导入自定义模块"><a href="#导入自定义模块" class="headerlink" title="导入自定义模块"></a>导入自定义模块</h6><p>1&gt; 创建utils包，在保重创建一个test模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc = <span class="string">'from test module'</span></span><br></pre></td></tr></table></figure>
<p>2&gt; 如果创建一个与test模块不同包的模块main,来使用test模块的功能:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> utils.test</span><br><span class="line">print(utils.test.desc)</span><br></pre></td></tr></table></figure>
<p>如果导入的模块包级别特别深时，可以使用别名：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> utils.test <span class="keyword">as</span> test</span><br><span class="line">print(test.desc)</span><br></pre></td></tr></table></figure>
<p>3&gt; 如果创建一个与test模块同包的模块main,来使用test模块的功能:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> test</span><br><span class="line">print(test.desc)</span><br></pre></td></tr></table></figure>
<h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><p>作用域有公开的和私有的作用域，来控制模块内的属性是否能被外界访问；</p>
<h5 id="公开作用域"><a href="#公开作用域" class="headerlink" title="公开作用域"></a>公开作用域</h5><ul>
<li>模块内正常的函数和变量名是公开的（public），可以被直接引用；</li>
<li>模块内类似<strong>xxx</strong>这样的变量是特殊变量，可以被直接引用，但是有特殊用途，我们自己的变量一般不要用这种变量名；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">【特殊变量】</span><br><span class="line">模块文件可以定义，如__author__,__name__,__doc__等特殊变量，来表示模块的一些标识;</span><br></pre></td></tr></table></figure>
<h5 id="私有作用域"><a href="#私有作用域" class="headerlink" title="私有作用域"></a>私有作用域</h5><p>在Python中，是通过下滑线(“_”)前缀来实现私有作用域（private），被私有化的属性不能被外部访问；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private函数或变量不应该被别人引用，只需给名称加单下划线（&quot;_&quot;）前缀即可；</span><br></pre></td></tr></table></figure>
<h4 id="安装第三方模块"><a href="#安装第三方模块" class="headerlink" title="安装第三方模块"></a>安装第三方模块</h4><h5 id="pip包管理工具"><a href="#pip包管理工具" class="headerlink" title="pip包管理工具"></a>pip包管理工具</h5><p>在Python中，安装第三方模块，是通过包管理工具pip完成的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【pip的安装】</span><br><span class="line">1&gt; Mac或Linux,pip在安装python时默认安装了；</span><br><span class="line">   Mac或Linux上有可能并存Python 3.x和Python 2.x，python2只支持pip,python3既支持pip3也支持pip 。</span><br><span class="line">2&gt; windows安装python时，确保安装时勾选了pip和Add python.exe to Path。</span><br></pre></td></tr></table></figure>
<h5 id="第三方库的获取"><a href="#第三方库的获取" class="headerlink" title="第三方库的获取"></a>第三方库的获取</h5><ul>
<li>官方地址：<br>一般第三方库都会在Python官方的<a href="https://pypi.org/" target="_blank" rel="noopener">pypi.python.org</a>网站注册，可以直接在此网站搜索需要的库；</li>
<li><a href="https://www.anaconda.com/" target="_blank" rel="noopener">anaconda官网</a> ：一个基于Python的数据处理和科学计算平台，它已经内置了许多非常有用的第三方库，我们装上Anaconda，就相当于把数十个第三方模块自动安装好了，Anaconda会把系统Path中的python指向自己自带的Python，可直接使用python命令进入。</li>
</ul>
<h5 id="安装第三方库"><a href="#安装第三方库" class="headerlink" title="安装第三方库"></a>安装第三方库</h5><ul>
<li>安装Pillow库，参考官方文档，安装命令如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install Pillow</span><br></pre></td></tr></table></figure>
<h5 id="模块搜索路径Path"><a href="#模块搜索路径Path" class="headerlink" title="模块搜索路径Path"></a>模块搜索路径Path</h5><p>当使用import加载一个模块时，Python会在指定的路径下搜索对应的.py文件，如果找不到，就会报错ImportError。</p>
<h6 id="默认搜索路径"><a href="#默认搜索路径" class="headerlink" title="默认搜索路径"></a>默认搜索路径</h6><blockquote>
<p>默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在sys模块的path变量中；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">【查看搜索路径】</span><br><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path</span><br></pre></td></tr></table></figure>
<h6 id="自定义模块搜索路径"><a href="#自定义模块搜索路径" class="headerlink" title="自定义模块搜索路径"></a>自定义模块搜索路径</h6><p>添加自己的搜索目录，有两种方法：</p>
<p>1&gt; 方法一：是直接修改sys.path，添加要搜索的目录(这种方法是在运行时修改，运行结束后失效)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path.append(&apos;/Users/michael/my_py_scripts&apos;)</span><br></pre></td></tr></table></figure>
<p>2&gt; 方法二：是设置环境变量PYTHONPATH，该环境变量的内容会被自动添加到模块搜索路径中。设置方式与设置Path环境变量类似。注意只需要添加你自己的搜索路径，Python自己本身的搜索路径不受影响。</p>
<h3 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h3><ul>
<li>面向对象的设计思想是抽象出类（Class），根据Class创建实例（Instance）对象；</li>
<li>面向对象的抽象程度又比函数要高，因为一个Class既包含数据，又包含操作数据的方法。</li>
</ul>
<h4 id="类和实例"><a href="#类和实例" class="headerlink" title="类和实例"></a>类和实例</h4><p>类是创建实例的模板，而实例则是一个一个具体的对象，各个实例拥有的数据都互相独立，互不影响；</p>
<h5 id="创建类"><a href="#创建类" class="headerlink" title="创建类"></a>创建类</h5><h6 id="语法格式"><a href="#语法格式" class="headerlink" title="语法格式"></a>语法格式</h6><p>定义类的语法格式如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>【注释】</p>
<ul>
<li>ClassName：类名通常是大写开头的单词，不同于变量名、函数名，类名推荐驼峰命名;</li>
<li>(object)：表示该类是从哪个类继承下来的，通常，如果没有合适的继承类，就使用object类，这是所有类最终都会继承的类。</li>
</ul>
<h6 id="示例-11"><a href="#示例-11" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h5 id="类实例"><a href="#类实例" class="headerlink" title="类实例"></a>类实例</h5><p>定义好了类，就可以通过ClassName()创建类的实例对象,即创建实例是通过类名+()实现的;</p>
<ul>
<li>类的实例可以自由的访问类公开的成员变量和方法；</li>
<li><span style="color:blue">可以自由地给一个类的实例变量绑定属性, 此时只作用于此实例，不会影响到其它实例；</span></li>
</ul>
<h6 id="示例-12"><a href="#示例-12" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类的实例对象</span></span><br><span class="line">student = Student()</span><br><span class="line"><span class="comment"># 可以自由地给一个实例变量绑定属性</span></span><br><span class="line">student.name = <span class="string">'ethan'</span></span><br></pre></td></tr></table></figure>
<h5 id="类的构造函数"><a href="#类的构造函数" class="headerlink" title="类的构造函数"></a>类的构造函数</h5><p>类可以起到模板的作用，可以定义类的构造函数（比普通函数多了个默认不用传的self参数，代表类自身的实例），让类实例化时传入一些默认的属性值，作为类初始化属性的值。</p>
<blockquote>
<p>构造函数的默认参数<span style="color:red">self可以直接给当前类添加新属性</span></p>
</blockquote>
<h6 id="构造函数语法"><a href="#构造函数语法" class="headerlink" title="构造函数语法"></a>构造函数语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过定义一个特殊的__init__方法，在创建实例的时候，就把设定的必须的属性绑上去；</span><br><span class="line">构造函数格式：def __init__(self,*args)</span><br><span class="line">【构造函数的参数】</span><br><span class="line">- self：默认参数，不需要传；</span><br><span class="line">- *args: 其他参数，必须传；</span><br></pre></td></tr></table></figure>
<p>例如：在创建Student类实例的时候，传入name、score属性</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, score)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line">student = Student(<span class="string">'ethan'</span>, <span class="number">99</span>)</span><br><span class="line">print(student.name, student.score)</span><br><span class="line"><span class="comment"># ethan 99</span></span><br></pre></td></tr></table></figure>
<h5 id="类变量"><a href="#类变量" class="headerlink" title="类变量"></a>类变量</h5><blockquote>
<p>概述：类变量必须通过“类名.变量名”来访问和赋值；</p>
</blockquote>
<ul>
<li>获取类的所有变量组成的字典：通过类名.__dict__来访问，返回类所有成员组成的字典；</li>
<li>类方法访问类变量：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 类名.变量名</span><br><span class="line">2&gt; self.__class__.变量名；</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'张三'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Student.name = <span class="string">'hello'</span> </span><br><span class="line">print(Student.name) <span class="comment"># hello</span></span><br><span class="line">print(Student.__dict__) <span class="comment"># &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h5 id="实例变量"><a href="#实例变量" class="headerlink" title="实例变量"></a>实例变量</h5><blockquote>
<p>概述：实例变量必须通过“实例对象.变量名”来访问和赋值；</p>
</blockquote>
<ul>
<li>实例变量的定义：必须在类中用self.变量名定义，才会被添加到实例变量字典中；</li>
<li>实例方法中使用实例变量：最好加self.变量名；</li>
<li><span style="color:blue">实例变量和类变量的访问：首先会在实例变量里找，没有用self.varname定义时，python会到类中再查找，返回同名的类变量，如果类中也没有，会到父类中继续查找</span>；</li>
<li>实例变量字典：通过对象.__dict__来访问，返回字典；</li>
</ul>
<h5 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h5><blockquote>
<p>实例方法相对于函数，增加了一个默认参数self，<span style="color:red">可以直接操作self给当前类添加新属性</span>;</p>
</blockquote>
<h6 id="定义类实例的方法"><a href="#定义类实例的方法" class="headerlink" title="定义类实例的方法"></a>定义类实例的方法</h6><p>实例方法实际就是函数添加了self作为第一个参数，调用时除了self不用传递，其他参数正常传入；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, score)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例方法封装：打印分数score</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_score</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.score)</span><br><span class="line"></span><br><span class="line">student = Student(<span class="string">'ethan'</span>, <span class="number">99</span>)</span><br><span class="line">student.print_score()</span><br></pre></td></tr></table></figure>
<h6 id="类名访问实例方法"><a href="#类名访问实例方法" class="headerlink" title="类名访问实例方法"></a>类名访问实例方法</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'张三'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__name = <span class="string">"ethan"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_hello</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"hello,"</span> + self.__name)</span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line">s.print_hello()</span><br><span class="line">Student.print_hello(s)</span><br></pre></td></tr></table></figure>
<h6 id="实例方法访问类变量"><a href="#实例方法访问类变量" class="headerlink" title="实例方法访问类变量"></a>实例方法访问类变量</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 方法内部直接使用：类名.变量名；</span><br><span class="line">2. 方法内部使用__class__内置函数来访问：self.__class__.变量名；</span><br><span class="line">3. 实例方法操作类变量：会直接改变类变量；</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'ethan'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_name</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment"># Test.name = name</span></span><br><span class="line">        self.__class__.name = name</span><br><span class="line"></span><br><span class="line">t = Test()</span><br><span class="line">t.set_name(<span class="string">"张三"</span>)</span><br><span class="line">print(Test.name)</span><br><span class="line"><span class="comment"># 张三</span></span><br></pre></td></tr></table></figure>
<h6 id="实例方法访问实例变量"><a href="#实例方法访问实例变量" class="headerlink" title="实例方法访问实例变量"></a>实例方法访问实例变量</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.变量名</span><br></pre></td></tr></table></figure>
<h5 id="类方法"><a href="#类方法" class="headerlink" title="类方法"></a>类方法</h5><p>类方法定义时，也需要用一个标识符cls作为第一个参数（cls同self类似也可以是任意的字符），cls代表类本身，但是方法需要用装饰器@classmethod来声明；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 类方法</span></span><br><span class="line">    <span class="comment"># @classmethod:装饰器，标识类方法</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_sum</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="comment"># 类方法操作类变量</span></span><br><span class="line">        cls.sum += <span class="number">1</span></span><br><span class="line">        print(cls.sum)</span><br><span class="line"></span><br><span class="line">Test.do_sum()</span><br></pre></td></tr></table></figure>
<h6 id="要点-1"><a href="#要点-1" class="headerlink" title="要点"></a>要点</h6><ul>
<li>在python中类的对象访问类方法是可以的，不推荐使用；</li>
<li>类方法可以访问静态方法；</li>
<li>类方法不能直接访问实例方法；</li>
</ul>
<h5 id="类的静态方法"><a href="#类的静态方法" class="headerlink" title="类的静态方法"></a>类的静态方法</h5><p> 概述：静态方法可以同时被类和对象访问，不同于类方法和实例方法的是不需要默认有第一个参数代表静态方法，但是需要装饰器@staticmethod作为静态方法的标识；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 静态方法可以同时被对象和类访问</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_info</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'调用了静态方法'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象访问静态方法</span></span><br><span class="line">test = Test()</span><br><span class="line">test.__class__.print_info()</span><br><span class="line"><span class="comment"># 类名访问静态方法</span></span><br><span class="line">Test.print_info()</span><br></pre></td></tr></table></figure>
<h6 id="要点-2"><a href="#要点-2" class="headerlink" title="要点"></a>要点</h6><ul>
<li>静态方法可以用类方法代替使用；</li>
<li>静态方法不可以直接访问实例方法；</li>
<li>静态方法可以访问类方法：类名.方法名();</li>
</ul>
<h4 id="类的访问限制"><a href="#类的访问限制" class="headerlink" title="类的访问限制"></a>类的访问限制</h4><h5 id="私有变量"><a href="#私有变量" class="headerlink" title="私有变量"></a>私有变量</h5><h6 id="私有变量-1"><a href="#私有变量-1" class="headerlink" title="私有变量"></a>私有变量</h6><p>如果要让内部属性不被外部访问，可以把属性的名称前加上双下划线<strong>，在Python中，实例的变量名如果以</strong>开头，就变成了一个私有变量（private）。</p>
<h6 id="要点-3"><a href="#要点-3" class="headerlink" title="要点"></a>要点</h6><ul>
<li>私有变量只有类的内部可以访问，外部实例不能访问。</li>
<li>可以通过对外暴露返回私有变量的方法，供外部调用来访问私有成员；</li>
<li>注意：同时以双下划线做前缀和后缀的变量是<span style="color:red">特殊变量，类的外部实例可以直接访问。</span></li>
</ul>
<p><strong>示例</strong>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 私有变量</span></span><br><span class="line">    __age = <span class="number">28</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment"># 私有变量</span></span><br><span class="line">        self.__name = name</span><br><span class="line">        self.sex = <span class="string">'man'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">print_info</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.__name, self.__age)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回私有变量name</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改私有变量name</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_name</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">student = Student(<span class="string">'ethan'</span>)</span><br><span class="line">student.print_info() <span class="comment"># ethan 28</span></span><br><span class="line">student.set_name(<span class="string">"令狐冲"</span>)</span><br><span class="line">print(student.get_name()) <span class="comment"># 令狐冲</span></span><br></pre></td></tr></table></figure>
<h6 id="单下划线前缀属性"><a href="#单下划线前缀属性" class="headerlink" title="单下划线前缀属性"></a>单下划线前缀属性</h6><p>通常模块的私有成员使用单下划线做前缀，类似的，在类中，以一个下划线开头的实例变量名，比如_name，这样的实例变量外部是可以访问的，但是，按照约定俗成的规定，当你看到这样的变量时，意思就是，“虽然我可以被访问，但是，请把我视为私有变量，不要随意访问”。</p>
<h5 id="私有方法"><a href="#私有方法" class="headerlink" title="私有方法"></a>私有方法</h5><p>同私有变量</p>
<h5 id="访问私有属性"><a href="#访问私有属性" class="headerlink" title="访问私有属性"></a>访问私有属性</h5><blockquote>
<p><span style="color:red">强烈建议不要这么干</span></p>
</blockquote>
<p>Python私有属性不是绝对的，可以通过如下格式访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例名._类名__方法名()或属性名</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    __name = <span class="string">'二哈'</span></span><br><span class="line">    __name2 = <span class="string">'二哈'</span></span><br><span class="line">    _age = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line">        self._age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__print_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(self.__name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">"三哈"</span>, <span class="number">15</span>)</span><br><span class="line">print(dog._Animal__name)</span><br><span class="line">print(dog._Animal__print_name())</span><br></pre></td></tr></table></figure>
<h4 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h4><ul>
<li>Python的类也支持类似java中的继承，在定义类时，类名后面紧跟的圆括号里的类名就是当前定义的类需要继承的父类，通常无需继承时，默认要写object表示所有类的父类；</li>
<li>Python允许使用多重继承，继承多个类时，用逗号分隔即可；</li>
</ul>
<h5 id="单继承示例"><a href="#单继承示例" class="headerlink" title="单继承示例"></a>单继承示例</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例1</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Animal is running...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">dog = Dog()</span><br><span class="line">dog.run()</span><br><span class="line"></span><br><span class="line">cat = Cat()</span><br><span class="line">cat.run()</span><br></pre></td></tr></table></figure>
<h5 id="多继承示例"><a href="#多继承示例" class="headerlink" title="多继承示例"></a>多继承示例</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 示例2</span><br><span class="line">class Animal(object):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">class Runnable(object):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(&apos;it is running...&apos;)</span><br><span class="line"></span><br><span class="line">class Dog(Animal, Runnable):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">dog = Dog()</span><br><span class="line">dog.run()</span><br></pre></td></tr></table></figure>
<h4 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h4><p>同一操作作用于不同的对象，可以有不同的解释，产生不同的执行结果，这就是多态性。简单的说，多态就是用基类的引用指向子类的对象。</p>
<p>例如：当子类和父类都存在相同方法时，子类的方法会覆盖了父类的同名方法。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Animal is running...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Dog is running...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Cat is running...'</span>)</span><br><span class="line"></span><br><span class="line">dog = Dog()</span><br><span class="line">dog.run()</span><br><span class="line"></span><br><span class="line">cat = Cat()</span><br><span class="line">cat.run()</span><br><span class="line"><span class="comment"># Dog is running...</span></span><br><span class="line"><span class="comment"># Cat is running...</span></span><br></pre></td></tr></table></figure>
<h4 id="对象的类型判断"><a href="#对象的类型判断" class="headerlink" title="对象的类型判断"></a>对象的类型判断</h4><p>判断对象的类型，同判断变量类型类似，两种方法：</p>
<ol>
<li>type(x)</li>
<li>isinstance(x,type)</li>
</ol>
<h5 id="type"><a href="#type" class="headerlink" title="type()"></a>type()</h5><ul>
<li>基本的type()方法可以判断一些基本的数据类型,也可以判断对象的类型：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">dog = Animal()</span><br><span class="line"><span class="comment"># 注意这种方式无法用于判断继承类型</span></span><br><span class="line">print(type(dog) == Animal)</span><br></pre></td></tr></table></figure>
<ul>
<li>判断一个对象是否是函数,可以使用types模块:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> types</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fn</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数类型</span></span><br><span class="line">print(type(fn) == types.FunctionType)</span><br><span class="line"><span class="comment"># 内建函数类型</span></span><br><span class="line">print(type(abs) == types.BuiltinFunctionType)</span><br><span class="line"><span class="comment"># lambda表达式类型</span></span><br><span class="line">print((type(<span class="keyword">lambda</span> x: x) == types.LambdaType))</span><br><span class="line"><span class="comment"># 生成器类型</span></span><br><span class="line">print(type((x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>))) == types.GeneratorType)</span><br></pre></td></tr></table></figure>
<h5 id="isinstance"><a href="#isinstance" class="headerlink" title="isinstance()"></a>isinstance()</h5><blockquote>
<p>建议一直使用来判断对象或者变量的数据类型；</p>
</blockquote>
<ul>
<li>对于class的继承关系来说，使用type()就很不方便。我们要判断class的类型，可以使用isinstance()函数；</li>
<li>能用type()判断的基本类型也可以用isinstance()判断；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">dog = Dog()</span><br><span class="line">print(isinstance(dog, Dog))</span><br><span class="line">print(isinstance(dog, Animal))</span><br></pre></td></tr></table></figure>
<h4 id="获取对象的信息"><a href="#获取对象的信息" class="headerlink" title="获取对象的信息"></a>获取对象的信息</h4><h5 id="获取所有属性和方法"><a href="#获取所有属性和方法" class="headerlink" title="获取所有属性和方法"></a>获取所有属性和方法</h5><p>Python提供内置函数dir()来获取对象的所有属性和方法,dir()返回一个包含字符串的list；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    __name = <span class="string">'二哈'</span></span><br><span class="line">    _age = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line">        self._age = age</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">dog = Dog(<span class="string">"三哈"</span>, <span class="number">15</span>)</span><br><span class="line">print(dir(dog))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ['_Animal__name', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', '_age', 'get_name']</span></span><br></pre></td></tr></table></figure>
<h5 id="属性变量的设置和获取"><a href="#属性变量的设置和获取" class="headerlink" title="属性变量的设置和获取"></a>属性变量的设置和获取</h5><ul>
<li>获取对象的属性：getattr</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果不存在，会抛异常，推荐设置默认值</span></span><br><span class="line">getattr(obj,str,default)</span><br></pre></td></tr></table></figure>
<ul>
<li>设置对象的属性：setattr</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setattr(obj,str,default)</span><br></pre></td></tr></table></figure>
<p><strong>示例：</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    alias = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">dog = Animal()</span><br><span class="line">setattr(dog, <span class="string">'alias'</span>, <span class="string">'小名'</span>)</span><br><span class="line">print(getattr(dog, <span class="string">'alias'</span>, <span class="string">'默认'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="判断是否包含某属性"><a href="#判断是否包含某属性" class="headerlink" title="判断是否包含某属性"></a>判断是否包含某属性</h5><p>hasattr()内置函数用来判断某对象是否包含某个属性；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(object)</span>:</span></span><br><span class="line">    alias = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">dog = Animal()</span><br><span class="line">print(hasattr(dog, <span class="string">'alias'</span>)) <span class="comment"># True</span></span><br><span class="line">print(hasattr(dog, <span class="string">'name'</span>)) <span class="comment"># False</span></span><br></pre></td></tr></table></figure>
<h4 id="实例绑定属性和类绑定属性"><a href="#实例绑定属性和类绑定属性" class="headerlink" title="实例绑定属性和类绑定属性"></a>实例绑定属性和类绑定属性</h4><ol>
<li>实例属性属于各个实例所有，实例之间互不干扰；</li>
<li>类属性属于类所有，所有实例共享一个属性；</li>
<li>不要对实例属性和类属性使用相同的名字，否则将产生难以发现的错误。</li>
</ol>
<h5 id="实例绑定属性"><a href="#实例绑定属性" class="headerlink" title="实例绑定属性"></a>实例绑定属性</h5><blockquote>
<p>由于Python是动态语言，根据类创建的实例可以任意绑定属性。</p>
</blockquote>
<h6 id="绑定方式"><a href="#绑定方式" class="headerlink" title="绑定方式"></a>绑定方式</h6><ul>
<li>给实例绑定属性的方法是通过实例变量，或者通过self变量；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment"># 绑定name属性</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'Bob'</span>)</span><br><span class="line"><span class="comment">#  绑定score属性</span></span><br><span class="line">s.score = <span class="number">90</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过setattr内置函数设置实例的属性；</li>
</ul>
<h6 id="限制允许绑定的属性"><a href="#限制允许绑定的属性" class="headerlink" title="限制允许绑定的属性"></a>限制允许绑定的属性</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&gt; Python允许在定义class的时候，定义一个特殊的__slots__变量，来限制该class实例能添加的属性；</span><br><span class="line">2&gt; __slots__赋值一个元组，元组中是存放的是允许添加的属性名称；</span><br><span class="line">3&gt; __slots__定义的属性仅对当前类实例起作用，对继承的子类是不起作用的,除非在子类中也定义__slots__，这样，子类实例允许定义的属性就是自身的__slots__加上父类的__slots__。</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># 限制实例的属性</span></span><br><span class="line">    <span class="comment"># 用tuple定义允许绑定的属性名称</span></span><br><span class="line">    __slots__ = (<span class="string">'name'</span>, <span class="string">'age'</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">student = Student()</span><br><span class="line">student.age = <span class="number">18</span></span><br><span class="line">print(student.age)</span><br></pre></td></tr></table></figure>
<h5 id="类绑定属性"><a href="#类绑定属性" class="headerlink" title="类绑定属性"></a>类绑定属性</h5><ul>
<li>直接在class中定义属性变量，这种属性变量是类属性，可以直接通过类名.属性变量名访问;</li>
<li>当我们定义了一个类属性后，这个属性虽然归类所有，类的所有实例都可以访问到。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'ethan'</span></span><br><span class="line"></span><br><span class="line">print(Test.name) <span class="comment"># ethan</span></span><br><span class="line">Test.age = <span class="number">11</span></span><br><span class="line">print(Test.age) <span class="comment"># 11</span></span><br><span class="line">t = Test()</span><br><span class="line">print(t.__class__.age) <span class="comment"># 11</span></span><br></pre></td></tr></table></figure>
<h4 id="实例绑定方法和类绑定方法"><a href="#实例绑定方法和类绑定方法" class="headerlink" title="实例绑定方法和类绑定方法"></a>实例绑定方法和类绑定方法</h4><h5 id="实例绑定方法"><a href="#实例绑定方法" class="headerlink" title="实例绑定方法"></a>实例绑定方法</h5><blockquote>
<p>类的实例的操作，不影响类的其它实例;</p>
</blockquote>
<p>直接给一个初始化的实例绑定的方法，对另一个实例是不起作用，可以使用types模块的MethodType函数给实例对象绑定方法；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> types <span class="keyword">import</span> MethodType</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'miao'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给实例绑定一个方法</span></span><br><span class="line"><span class="comment"># 定义一个函数作为实例方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_age</span><span class="params">(self, age)</span>:</span></span><br><span class="line">    self.age = age</span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line">s.set_age = MethodType(set_age, s)</span><br><span class="line">s.set_age(<span class="number">25</span>)</span><br><span class="line">print(s.age)</span><br></pre></td></tr></table></figure>
<h5 id="类绑定方法"><a href="#类绑定方法" class="headerlink" title="类绑定方法"></a>类绑定方法</h5><p>可以定义以个函数，然后通过类名.方法名直接给类绑定一个方法;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    name = <span class="string">'miao'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以给class绑定方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_score</span><span class="params">(self, score)</span>:</span></span><br><span class="line">    self.score = score</span><br><span class="line"></span><br><span class="line">Student.set_score = set_score</span><br><span class="line">s.set_score(<span class="number">100</span>)</span><br><span class="line">print(s.score)</span><br></pre></td></tr></table></figure>
<h4 id="类方法的装饰器"><a href="#类方法的装饰器" class="headerlink" title="类方法的装饰器"></a>类方法的装饰器</h4><p>装饰器（decorator）可以给函数动态加上功能，对于类的方法，装饰器一样起作用。</p>
<h5 id="property属性读写限制和检查"><a href="#property属性读写限制和检查" class="headerlink" title="@property属性读写限制和检查"></a>@property属性读写限制和检查</h5><blockquote>
<p>Python内置的@property装饰器就是负责<span style="color:red">把一个方法变成属性调用的</span>, 并且可以限制属性的读写；</p>
</blockquote>
<ol>
<li>在方法上添加@property，负责把此属性的getter方法变成属性的读取，此时只读。</li>
<li>@属性名.setter，负责把一个setter方法变成属性赋值；</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, birth)</span>:</span></span><br><span class="line">        self._birth = birth</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._birth</span><br><span class="line"></span><br><span class="line"><span class="meta">    @birth.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">birth</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self._birth = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2015</span> - self._birth</span><br><span class="line"></span><br><span class="line"><span class="comment"># birth是可读写属性，而age就是一个只读属性</span></span><br><span class="line">s = Student(<span class="number">2008</span>)</span><br><span class="line">print(s.age) <span class="comment"># 7</span></span><br><span class="line">s.birth = <span class="number">2014</span></span><br><span class="line">print(s.age) <span class="comment"># 1</span></span><br><span class="line">s.age = <span class="number">12</span> <span class="comment"># error</span></span><br></pre></td></tr></table></figure>
<h4 id="类可定制"><a href="#类可定制" class="headerlink" title="类可定制"></a>类可定制</h4><blockquote>
<p>Python为类class内部提供了一些特殊方法用来定制类，允许重写这些特殊方法，为类的实例添加一些特殊的功能。</p>
</blockquote>
<p><a href="https://docs.python.org/3/reference/datamodel.html#special-method-names" target="_blank" rel="noopener">类的可定制方法官方文档</a></p>
<h5 id="str"><a href="#str" class="headerlink" title="__str__"></a>__str__</h5><blockquote>
<p><span style="color:red">字符串输出实例</span></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&gt; __str__用来输出类实例字符串信息，通常我们可以重新定义它来返回一个规则的字符串；</span><br><span class="line">2&gt; __repr__用来输出类实例变量的字符串表示信息，通常__str__()和__repr__()代码都是一样的；</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Student object (name: %s)'</span> % self.name</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line">print(Student(<span class="string">'Michael'</span>))</span><br><span class="line">s = Student(<span class="string">'Lily'</span>)</span><br><span class="line">print(s)</span><br><span class="line"><span class="comment"># Student object (name: Michael)</span></span><br><span class="line"><span class="comment"># Student object (name: Lily)</span></span><br></pre></td></tr></table></figure>
<h5 id="iter"><a href="#iter" class="headerlink" title="__iter__"></a>__iter__</h5><blockquote>
<p><span style="color:red">类添支持迭代</span></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果一个类想被用于for ... in循环，类似list或tuple那样，就必须实现一个__iter__()方法，</span><br><span class="line">该方法返回一个迭代对象，然后，Python的for循环就会不断调用该迭代对象的__next__()方法</span><br><span class="line">拿到循环的下一个值，直到遇到StopIteration错误时退出循环。</span><br></pre></td></tr></table></figure>
<p>示例：以斐波那契数列为例，写一个Fib类，可以作用于for循环：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a, self.b = <span class="number">0</span>, <span class="number">1</span> <span class="comment"># 初始化两个计数器a，b</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self <span class="comment"># 实例本身就是迭代对象，故返回自己</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.a, self.b = self.b, self.a + self.b <span class="comment"># 计算下一个值</span></span><br><span class="line">        <span class="keyword">if</span> self.a &gt; <span class="number">100000</span>: <span class="comment"># 退出循环的条件</span></span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br><span class="line">        <span class="keyword">return</span> self.a <span class="comment"># 返回下一个值</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> Fib():</span><br><span class="line">     print(n)</span><br></pre></td></tr></table></figure>
<h5 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__"></a>__getitem__</h5><blockquote>
<p><span style="color:red">类实例支持索引访问</span></p>
</blockquote>
<p>__getitem__()传入的参数可能是一个int，也可能是一个切片对象slice</p>
<ol>
<li>当接收的是int参数时，仅支持下标访问：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        a, b = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(n):</span><br><span class="line">            a, b = b, a + b</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">f = Fib()</span><br><span class="line">print(f[<span class="number">10</span>])</span><br></pre></td></tr></table></figure>
<ol>
<li>支持切片访问：接收的参数也可以是切片对象，需要判断做处理；</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(n, int):  <span class="comment"># n是索引</span></span><br><span class="line">            a, b = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(n):</span><br><span class="line">                a, b = b, a + b</span><br><span class="line">            <span class="keyword">return</span> a</span><br><span class="line">        <span class="keyword">if</span> isinstance(n, slice):  <span class="comment"># n是切片</span></span><br><span class="line">            start = n.start</span><br><span class="line">            stop = n.stop</span><br><span class="line">            <span class="keyword">if</span> start <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">                start = <span class="number">0</span></span><br><span class="line">            a, b = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">            result = []</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(stop):</span><br><span class="line">                <span class="keyword">if</span> x &gt;= start:</span><br><span class="line">                    result.append(a)</span><br><span class="line">                a, b = b, a + b</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">f = Fib()</span><br><span class="line">print(f[<span class="number">0</span>:<span class="number">5</span>])</span><br></pre></td></tr></table></figure>
<h6 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 与__getitem__对应的是__setitem__()方法，把对象视作list或dict来对集合赋值。</span><br><span class="line">2&gt; __delitem__()方法，用于删除某个元素。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过上面的方法,我们自己定义的类表现得和Python自带的list、tuple、dict没什么区别，这完全归功于动态语言的“鸭子类型”，不需要强制继承某个接口。</p>
</blockquote>
<h5 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__"></a>__getattr__</h5><blockquote>
<p><span style="color:red">类实例调用未定义的属性和方法处理</span></p>
</blockquote>
<p>正常情况下，当我们调用类的方法或属性时，如果不存在，就会报错。</p>
<h6 id="要点-4"><a href="#要点-4" class="headerlink" title="要点"></a>要点</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 重写__getattr__()方法，可以对未知属性和方法进行处理；</span><br><span class="line">2&gt; 如果属性未定义，也没有在__getattr__()中处理，也会返回None;</span><br><span class="line">3&gt; 如果方法未定义，也没有在__getattr__()中处理，则会抛出错误；</span><br><span class="line">4&gt; 注意:只有在没有找到属性的情况下，才调用__getattr__，已有的属性;</span><br></pre></td></tr></table></figure>
<h6 id="示例-13"><a href="#示例-13" class="headerlink" title="示例"></a>示例</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.name = &apos;Michael&apos;</span><br><span class="line"></span><br><span class="line">    def __getattr__(self, attr):</span><br><span class="line">        if attr == &apos;score&apos;:</span><br><span class="line">            return 99</span><br><span class="line">        elif attr == &apos;age&apos;: # 返回函数</span><br><span class="line">            return lambda: 25</span><br><span class="line"></span><br><span class="line">s = Student()</span><br><span class="line">print(s.money) # None</span><br><span class="line">print(s.score) # 99</span><br><span class="line">print(s.age()) # 25</span><br><span class="line">print(s.agex()) # error</span><br></pre></td></tr></table></figure>
<h5 id="call"><a href="#call" class="headerlink" title="__call__"></a>__call__</h5><blockquote>
<p><span style="color:red">可调用对象</span></p>
</blockquote>
<h6 id="要点-5"><a href="#要点-5" class="headerlink" title="要点"></a>要点</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt; 任何类，只需要定义一个__call__()方法，就可以直接对实例进行调用;</span><br><span class="line">2&gt; __call__()还可以定义参数。</span><br><span class="line">3&gt; 对实例进行直接调用就好比对一个函数进行调用一样;</span><br><span class="line">4&gt; 能被调用的对象就是一个Callable对象;</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'My name is %s.'</span> % self.name)</span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'Michael'</span>)</span><br><span class="line">s()</span><br><span class="line"><span class="comment"># My name is Michael.</span></span><br></pre></td></tr></table></figure>
<h6 id="可调用对象"><a href="#可调用对象" class="headerlink" title="可调用对象"></a>可调用对象</h6><p>通过callable()函数，我们就可以判断一个对象是否是“可调用”对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; callable(Student())</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; callable(None)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h4 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h4><blockquote>
<p>Python提供了Enum枚举类来实现每个类中的常量都是class的一个唯一实例;</p>
</blockquote>
<h5 id="概念要点"><a href="#概念要点" class="headerlink" title="概念要点"></a>概念要点</h5><h6 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h6><ul>
<li>枚举类本质还是一个类，需要继承enum模块的Enum类或IntEnum类，枚举成员名称大写；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum,IntEnum,unique(标识枚举标签的值不能相等)</span><br></pre></td></tr></table></figure>
<h6 id="枚举值类型"><a href="#枚举值类型" class="headerlink" title="枚举值类型"></a>枚举值类型</h6><ul>
<li>Enum类型的枚举成员的值可以是字符串、数字类型;</li>
<li>IntEnum类型的枚举成员的值只能是int类型；</li>
</ul>
<h6 id="使用注意"><a href="#使用注意" class="headerlink" title="使用注意"></a>使用注意</h6><ul>
<li>Enum可以把一组相关常量定义在一个class中，且class不可变，而且成员可以直接比较。</li>
<li>枚举成员是不可更改的常量；</li>
<li>既可以用成员名称引用枚举常量，又可以直接根据value的值获得枚举常量；</li>
<li>枚举不能实例化，它通过单例模式设计的；</li>
<li>枚举有两个成员值相等时，第二个重复的是第一个的别名，一般别名枚举标签不会被打印，获取到的都是第一次出现的标签名；</li>
<li>如果需要打印别名可以遍历：枚举类.__members__(只打印枚举标签的名称)，枚举类.__member__.items()(打印的是各个枚举成员的所有内容元组)；</li>
</ul>
<h5 id="简单的枚举类"><a href="#简单的枚举类" class="headerlink" title="简单的枚举类"></a>简单的枚举类</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enum(cls,value)</span></span><br><span class="line">Month = Enum(<span class="string">'Month'</span>, (<span class="string">'Jan'</span>, <span class="string">'Feb'</span>, <span class="string">'Mar'</span>, <span class="string">'Apr'</span>, <span class="string">'May'</span>, <span class="string">'Jun'</span>, <span class="string">'Jul'</span>, <span class="string">'Aug'</span>, <span class="string">'Sep'</span>, <span class="string">'Oct'</span>, <span class="string">'Nov'</span>, <span class="string">'Dec'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历枚举类的所有成员</span></span><br><span class="line"><span class="comment"># name: cls类名，member 枚举类中的常量值</span></span><br><span class="line"><span class="keyword">for</span> name, member <span class="keyword">in</span> Month.__members__.items():</span><br><span class="line">    <span class="comment"># value属性则是自动赋给成员的int常量，默认从1开始计数。</span></span><br><span class="line">    print(name, <span class="string">'=&gt;'</span>, member, <span class="string">','</span>, member.value)</span><br></pre></td></tr></table></figure>
<h5 id="自定义枚举类"><a href="#自定义枚举类" class="headerlink" title="自定义枚举类"></a>自定义枚举类</h5><blockquote>
<p>如果需要更精确地控制枚举类型，可以从Enum派生出自定义类；</p>
</blockquote>
<p>自定义枚举类，需要使用@unique装饰器帮助我们检查保证没有重复值。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, unique</span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekday</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    Sun = <span class="number">0</span>  <span class="comment"># Sun的value被设定为0</span></span><br><span class="line">    Mon = <span class="number">1</span></span><br><span class="line">    Tue = <span class="number">2</span></span><br><span class="line">    Wed = <span class="number">3</span></span><br><span class="line">    Thu = <span class="number">4</span></span><br><span class="line">    Fri = <span class="number">5</span></span><br><span class="line">    Sat = <span class="number">6</span></span><br></pre></td></tr></table></figure>
<h5 id="访问枚举类"><a href="#访问枚举类" class="headerlink" title="访问枚举类"></a>访问枚举类</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1. 获取枚举的标签名称：枚举类名.标签名.name</span><br><span class="line">2. 获取枚举标签对应的值：枚举类名.标签.value</span><br><span class="line">3. 获取枚举的标签：枚举类名[&apos;标签名&apos;]、枚举类名(标签值)、枚举类.标签</span><br><span class="line">4. 遍历枚举的所有标签：for e in 枚举类；</span><br><span class="line">5. 遍历枚举的所有成员包括别名标签名：枚举类.__members__;</span><br><span class="line">6. 遍历枚举的所有成员包括别名标签详细信息：枚举类.__members__.items();</span><br><span class="line">7. 枚举不支持大小和值的比较，可以做等值比较 ：枚举类.标签==枚举类.标签；</span><br><span class="line">8. 枚举可做身份比较：枚举类.标签 is 枚举类.标签；</span><br><span class="line">9. 枚举中通过标签值获取枚举标签：枚举类(value);</span><br><span class="line">10. 约束枚举标签的值不能重复：使用装饰器 @unique；</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, unique</span><br><span class="line"></span><br><span class="line"><span class="comment"># @unique装饰器可以帮助我们检查保证没有重复值。</span></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weekday</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    Sun = <span class="number">0</span>  <span class="comment"># Sun的value被设定为0</span></span><br><span class="line">    Mon = <span class="number">1</span></span><br><span class="line">    Tue = <span class="number">2</span></span><br><span class="line">    Wed = <span class="number">3</span></span><br><span class="line">    Thu = <span class="number">4</span></span><br><span class="line">    Fri = <span class="number">5</span></span><br><span class="line">    Sat = <span class="number">6</span></span><br><span class="line"></span><br><span class="line">print(Weekday.Mon)</span><br><span class="line">print(Weekday(<span class="number">1</span>))</span><br><span class="line">print(Weekday[<span class="string">'Mon'</span>])</span><br><span class="line"><span class="comment"># 获取枚举对应int值</span></span><br><span class="line">print(Weekday.Mon.value)</span><br><span class="line"><span class="comment"># 枚举比较</span></span><br><span class="line">day1 = Weekday.Mon</span><br><span class="line">print(day1 == Weekday.Mon)</span><br><span class="line">print(Weekday(<span class="number">1</span>) == Weekday.Mon)</span><br><span class="line">print(Weekday(<span class="number">1</span>) == day1)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">结果：</span></span><br><span class="line"><span class="string">Weekday.Mon</span></span><br><span class="line"><span class="string">Weekday.Mon</span></span><br><span class="line"><span class="string">Weekday.Mon</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h4 id="动态创建类"><a href="#动态创建类" class="headerlink" title="动态创建类"></a>动态创建类</h4><h5 id="使用type函数"><a href="#使用type函数" class="headerlink" title="使用type函数"></a>使用type函数</h5><blockquote>
<p>通过type()函数创建的类和直接写class是完全一样的；</p>
</blockquote>
<p>type()函数既可以返回一个对象的类型，又可以创建出新的类型，比如，我们可以通过type()函数创建出Hello类，而无需通过class Hello(object)…的定义；</p>
<h6 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type(&apos;类名&apos;,(object,父类元组...),属性字典)</span><br></pre></td></tr></table></figure>
<p>要创建一个class对象，type()函数依次传入以下3个参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. class的名称；</span><br><span class="line">2. 继承的父类集合，注意Python支持多重继承，如果只有一个父类，别忘了tuple的单元素写法；</span><br><span class="line">3. class的方法名称与函数绑定的dict。</span><br></pre></td></tr></table></figure>
<h6 id="示例-14"><a href="#示例-14" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fn</span><span class="params">(self, name=<span class="string">'world'</span>)</span>:</span></span><br><span class="line">    print(<span class="string">'Hello, %s.'</span> % name)</span><br><span class="line"></span><br><span class="line">d = &#123;</span><br><span class="line">    <span class="string">'hello'</span>: fn,</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'ethan'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态代码创建Hello class</span></span><br><span class="line">Hello = type(<span class="string">'Hello'</span>, (object,), d)</span><br><span class="line"></span><br><span class="line">h = Hello()</span><br><span class="line">h.hello()</span><br><span class="line">print(h.name)</span><br></pre></td></tr></table></figure>
<h5 id="使用metaclass"><a href="#使用metaclass" class="headerlink" title="使用metaclass"></a>使用metaclass</h5><blockquote>
<p>除了使用type()动态创建类以外，要控制类的创建行为，还可以使用metaclass(元类)。</p>
</blockquote>
<p><span style="color:blue">定义和使用元类的步骤：</span></p>
<ul>
<li>元类需要继承type类，并重写__new__()方法用于创建类实例；</li>
<li>元类需要重写的__new__()方法实际是增加对attrs逻辑处理，最终回调type.__new__(mcs, name, bases, attrs)，来应用修改后的实例化逻辑；</li>
<li>自定义一个类来使用元类时，只需要给自定类的父类元组中添加metaclass属性来指向已定义的元类，那么自定义类实例化时，就会调用元类定义的__new__()方法来进行实例化；</li>
</ul>
<blockquote>
<p><span style="color:red">应用metaclass的类的mataclass特性会继续应用到子类;</span></p>
</blockquote>
<h6 id="new"><a href="#new" class="headerlink" title="__new__()"></a>__new__()</h6><p>__new__(mcs, name, bases, attrs)方法接收到的参数依次是：</p>
<ol>
<li>mcs: 当前准备创建的元类模板自己的实例对象；</li>
<li>name: 类的名字；</li>
<li>bases: 类继承的父类集合；</li>
<li>attrs: 类的属性和方法集合。</li>
</ol>
<h6 id="示例-15"><a href="#示例-15" class="headerlink" title="示例"></a>示例</h6><ul>
<li>metaclass给自定义的MyList增加一个add方法来拓展list：<blockquote>
<p>不要使用元类来添加方法，此处只做演示；</p>
</blockquote>
</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># metaclass是类的模板，所以必须从`type`类型派生：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListMetaclass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="comment"># 指定在创建MyList时，要通过ListMetaclass.__new__()来创建</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(mcs, name, bases, attrs)</span>:</span></span><br><span class="line">        attrs[<span class="string">'add'</span>] = <span class="keyword">lambda</span> self, value: self.append(value)</span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指示使用ListMetaclass来定制类，传入关键字参数metaclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyList</span><span class="params">(list, metaclass=ListMetaclass)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">L = MyList()</span><br><span class="line">L.add(<span class="string">'hello'</span>)</span><br><span class="line">L.add(<span class="string">'world'</span>)</span><br><span class="line">print(L)</span><br></pre></td></tr></table></figure>
<ul>
<li>metaclass可以隐式地继承到子类:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># metaclass是类的模板，所以必须从`type`类型派生：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListMetaclass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="comment"># 指定在创建MyList时，要通过ListMetaclass.__new__()来创建</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(mcs, name, bases, attrs)</span>:</span></span><br><span class="line">        attrs[<span class="string">'add'</span>] = <span class="keyword">lambda</span> self, value: self.append(value)</span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指示使用ListMetaclass来定制类，传入关键字参数metaclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyList</span><span class="params">(list, metaclass=ListMetaclass)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># metaclass可以隐式地继承到子类，但子类自己却感觉不到</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XList</span><span class="params">(MyList)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">L = XList()</span><br><span class="line">L.add(<span class="string">'hello'</span>)</span><br><span class="line">L.add(<span class="string">'world'</span>)</span><br><span class="line">print(L)</span><br></pre></td></tr></table></figure>
<h6 id="元类实现ORM"><a href="#元类实现ORM" class="headerlink" title="元类实现ORM"></a>元类实现ORM</h6><blockquote>
<p>ORM全称“Object Relational Mapping”，即对象-关系映射，就是把关系数据库的一行映射为一个对象，也就是一个类对应一个表，这样，写代码更简单，不用直接操作SQL语句。 </p>
</blockquote>
<p>要编写一个ORM框架，所有的类都只能动态定义，因为只有使用者才能根据表的结构定义出对应的类来。</p>
<p><strong>实现ORM简单框架的代码加注释，详细如下：</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Field: 存储数据表的映射字段名和类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Field</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># name 字段名</span></span><br><span class="line">    <span class="comment"># column_type 对应数据库的数据类型</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, column_type)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.column_type = column_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%s:%s&gt;'</span> % (self.__class__.__name__, self.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串类型(varchar(100))</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringField</span><span class="params">(Field)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        super(StringField, self).__init__(name, <span class="string">'varchar(100)'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 整数类型(bigint)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerField</span><span class="params">(Field)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        super(IntegerField, self).__init__(name, <span class="string">'bigint'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元类模板：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelMetaclass</span><span class="params">(type)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重写使用此元类模板的子类创建实例对象的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(mcs, name, bases, attrs)</span>:</span></span><br><span class="line">        <span class="comment"># 尚未实例化时的处理</span></span><br><span class="line">        <span class="keyword">if</span> name == <span class="string">'Model'</span>:</span><br><span class="line">            <span class="keyword">return</span> type.__new__(mcs, name, bases, attrs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 实例化后的处理</span></span><br><span class="line">        <span class="comment"># 打印实例化的类名</span></span><br><span class="line">        print(<span class="string">'Found model: %s'</span> % name)</span><br><span class="line">        <span class="comment"># 将attrs转存到mappings实例属性对的映射字典：存储数据字段和值</span></span><br><span class="line">        mappings = dict()</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():</span><br><span class="line">            <span class="keyword">if</span> isinstance(v, Field):</span><br><span class="line">                print(<span class="string">'Found mapping: %s ==&gt; %s'</span> % (k, v))</span><br><span class="line">                mappings[k] = v</span><br><span class="line">        <span class="comment"># 清空attrs</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> mappings.keys():</span><br><span class="line">            attrs.pop(k)</span><br><span class="line">        <span class="comment"># 给attrs重设属性</span></span><br><span class="line">        attrs[<span class="string">'__mappings__'</span>] = mappings  <span class="comment"># 保存属性和列的映射关系</span></span><br><span class="line">        attrs[<span class="string">'__table__'</span>] = name  <span class="comment"># 假设表名和类名一致</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重新利用type创建实例</span></span><br><span class="line">        <span class="keyword">return</span> type.__new__(mcs, name, bases, attrs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用元类作为模板，统一对外暴露对数据处理的方法和属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span><span class="params">(dict, metaclass=ModelMetaclass)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kw)</span>:</span></span><br><span class="line">        super(Model, self).__init__(**kw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self[key]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError(<span class="string">r"'Model' object has no attribute '%s'"</span> % key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 插入数据到数据库的sql</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self)</span>:</span></span><br><span class="line">        fields = []</span><br><span class="line">        params = []</span><br><span class="line">        args = []</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> self.__mappings__.items():</span><br><span class="line">            fields.append(v.name)</span><br><span class="line">            params.append(<span class="string">'?'</span>)</span><br><span class="line">            args.append(getattr(self, k, <span class="keyword">None</span>))</span><br><span class="line">        sql = <span class="string">'insert into %s (%s) values (%s)'</span> % (self.__table__, <span class="string">','</span>.join(fields), <span class="string">','</span>.join(params))</span><br><span class="line">        <span class="comment"># 打印最终的插入sql</span></span><br><span class="line">        print(<span class="string">'SQL: %s'</span> % sql)</span><br><span class="line">        print(<span class="string">'ARGS: %s'</span> % str(args))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># testing code:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Model)</span>:</span></span><br><span class="line">    id = IntegerField(<span class="string">'id'</span>)</span><br><span class="line">    name = StringField(<span class="string">'username'</span>)</span><br><span class="line">    email = StringField(<span class="string">'email'</span>)</span><br><span class="line">    password = StringField(<span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">u = User(id=<span class="number">12345</span>, name=<span class="string">'Michael'</span>, email=<span class="string">'test@orm.org'</span>, password=<span class="string">'my-pwd'</span>)</span><br><span class="line">u.save()</span><br></pre></td></tr></table></figure>
<h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h4><h5 id="定义抽象类"><a href="#定义抽象类" class="headerlink" title="定义抽象类"></a>定义抽象类</h5><p>定义一个类，并指定抽象类的metaclass=ABCMeta(Abstract Base Classes)即表示抽象类；</p>
<ul>
<li>抽象类不能直接被实例化；</li>
<li>抽象类中使用@abstractmethod装饰器标识的方法时抽象方法，方法体使用pass无需实现，但是子类必须实现抽象方法；</li>
<li>可以直接使用继承抽象类的方式来直接使用抽象类；</li>
<li>抽象类中使用@property+@abstractmethod装饰的方法称为抽象属性；</li>
</ul>
<h5 id="示例-16"><a href="#示例-16" class="headerlink" title="示例"></a>示例</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个抽象类(不能直接被实例化)</span></span><br><span class="line"><span class="comment"># ABCMeta(Abstract Base Classes)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(metaclass=ABCMeta)</span>:</span></span><br><span class="line">    <span class="comment"># 抽象属性</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义抽象方法,无需实现功能,但是子类必须实现该方法</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承的方式让类实现实现抽象基类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(People)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self._name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_sex</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'男'</span></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'ethan'</span>)</span><br><span class="line">print(s.name)  <span class="comment"># ethan</span></span><br><span class="line">print(s.get_sex()) <span class="comment"># 男</span></span><br></pre></td></tr></table></figure>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><ul>
<li>Python所有的错误都是从BaseException类派生的;</li>
<li>只有在必要的时候再使用错误类型，尽量使用Python内置的错误类型。</li>
</ul>
<h4 id="捕获和处理错误"><a href="#捕获和处理错误" class="headerlink" title="捕获和处理错误"></a>捕获和处理错误</h4><p>Python异常处理使用try…except…else…finally,try语句块内是需要被检查的代码， except捕获的异常类型可以有多个，else是没有异常时的处理，finally每次都会执行；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyError</span><span class="params">(BaseException)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: <span class="comment"># try区域是需要被检查的代码</span></span><br><span class="line">    print(<span class="string">'异常检测区...'</span>)</span><br><span class="line">    r = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line">    print(<span class="string">'result:'</span>, r)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e: <span class="comment"># 具体错误</span></span><br><span class="line">    <span class="keyword">raise</span> MyError(<span class="string">'抛出一个自定义错误'</span>) </span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    logging.exception(e)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 抛出异常，将终端程序</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'抛出异常，将终端程序'</span>)</span><br><span class="line"><span class="keyword">except</span> BaseException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># logging模块打印异常信息</span></span><br><span class="line">    logging.exception(e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'没有错误代码块'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">'finally...'</span>)</span><br><span class="line">print(<span class="string">'END'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="错误调试"><a href="#错误调试" class="headerlink" title="错误调试"></a>错误调试</h4><h5 id="断言错误"><a href="#断言错误" class="headerlink" title="断言错误"></a>断言错误</h5><p>断言使用assert标识的语句，assert后跟表达式和错误信息，如果表达式返回True说明断言成功，否则就是断言失败，断言失败标识后面的语句就会报错；</p>
<blockquote>
<p>注意：断言失败后会抛出异常，中断程序，<span style="color:red">不推荐</span>；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def foo(s):</span><br><span class="line">    n = int(s)</span><br><span class="line">    assert n != 0, &apos;n is zero!&apos;</span><br><span class="line">    return 10 / n</span><br><span class="line"></span><br><span class="line">foo(2)</span><br></pre></td></tr></table></figure>
<h6 id="关闭断言"><a href="#关闭断言" class="headerlink" title="关闭断言"></a>关闭断言</h6><p>启动Python解释器时可以用-O参数来关闭assert，关闭后，你可以把所有的assert语句当成pass来看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python -O err.py</span><br></pre></td></tr></table></figure>
<h5 id="打印错误日志"><a href="#打印错误日志" class="headerlink" title="打印错误日志"></a>打印错误日志</h5><ul>
<li>使用logging模块，来打印错误日志，好处是不会抛出错误中断程序；</li>
<li>logging模块有debug，info，warning，error等几个级别的信息；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入logging模块</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># 配置日志显示信息的级别</span></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logging.info(<span class="string">'输出一段错误信息'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="pdb命令调试"><a href="#pdb命令调试" class="headerlink" title="pdb命令调试"></a>pdb命令调试</h5><p>略</p>
<h5 id="IDE调试"><a href="#IDE调试" class="headerlink" title="IDE调试"></a>IDE调试</h5><p>PyCharm和VScode都支持很智能的调试功能；</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy" target="_blank" rel="noopener">常见的错误类型和继承关系官方文档</a></p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>正则表达式由普通字符和元字符组成，普通字符就是普通的字符，元字符是正则规定的特殊字符，Python提供re模块来操作正则表达式的模块；</p>
<h4 id="正则元字符"><a href="#正则元字符" class="headerlink" title="正则元字符"></a>正则元字符</h4><h5 id="转义字符-1"><a href="#转义字符-1" class="headerlink" title="转义字符"></a>转义字符</h5><p>正则表达式使用斜杠（\）来表示转义字符；</p>
<h5 id="边界符"><a href="#边界符" class="headerlink" title="边界符"></a>边界符</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">元字符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">^</td>
<td style="text-align:left">匹配正则表达式的开始</td>
</tr>
<tr>
<td style="text-align:left">$</td>
<td style="text-align:left">匹配正则表达式的结束</td>
</tr>
</tbody>
</table>
</div>
<h5 id="数量限制符"><a href="#数量限制符" class="headerlink" title="数量限制符"></a>数量限制符</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">元字符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">匹配此元字符前面的子表达式任意次</td>
</tr>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">匹配此元字符前面的子表达式一次或多次</td>
</tr>
<tr>
<td style="text-align:left">?</td>
<td style="text-align:left">匹配此元字符前面的子表达式零次或一次，也可做非贪婪匹配限制符</td>
</tr>
<tr>
<td style="text-align:left">{n}</td>
<td style="text-align:left">匹配n(n&gt;=0)次</td>
</tr>
<tr>
<td style="text-align:left">{n,}</td>
<td style="text-align:left">至少匹配n(n&gt;=0)次</td>
</tr>
<tr>
<td style="text-align:left">{n,m}</td>
<td style="text-align:left">最少匹配n次,最多匹配m次(n&lt;=m,n&gt;=0,m&gt;=0)</td>
</tr>
</tbody>
</table>
</div>
<h5 id="匹配表达式"><a href="#匹配表达式" class="headerlink" title="匹配表达式"></a>匹配表达式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">. 匹配除“\r\n”之外的任何单个字符,要匹配包括“\r\n”在内的任何字符,请使用像“[\s\S]” </span><br><span class="line">[xyz] 匹配[]内包含的任意一个字符 </span><br><span class="line">[^xyz] 匹配未包含在[]内的任意字符 </span><br><span class="line">[a-z] 匹配指定范围内的任意字符(例如：[a-zA-Z0-9])</span><br><span class="line">[^a-z] 匹配任何不在指定范围内的任意字符 </span><br><span class="line">\d 匹配一个数字字符,等价于[0-9] </span><br><span class="line">\D 匹配一个非数字字符 </span><br><span class="line">\w 匹配包括下划线的任何单词字符,类似但不等价于“[A-Za-z0-9_]”，这里的&quot;单词&quot;字符使用Unicode字符集 </span><br><span class="line">\W 匹配任何非单词字符,等价于“[^A-Za-z0-9_]” </span><br><span class="line">\s 匹配任何不可见字符,包括空格、制表符、换页符等等。等价于[ \f\n\r\t\v] </span><br><span class="line">\S  匹配任何可见字符。等价于[^ \f\n\r\t\v] </span><br><span class="line">() 将括号中的表达式定义为一个组，一个表达式最多9个组 </span><br><span class="line">| 将两个匹配条件进行逻辑“或”运算(例如:(him丨her)匹配him或her)</span><br></pre></td></tr></table></figure>
<h5 id="获取和非获取匹配"><a href="#获取和非获取匹配" class="headerlink" title="获取和非获取匹配"></a>获取和非获取匹配</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">| 元字符 | 描述 |</span><br><span class="line">| :--- | :--- |</span><br><span class="line">|(pattern) | 匹配pattern并获取这一匹配;&lt;br /&gt;如果要匹配的正则有多个（pattern）则每个pattern单独获得一个结果,&lt;br /&gt;组成元组作为符合条件的一组结果) |</span><br><span class="line">| (?:pattern) | 非获取匹配，匹配pattern但不获取匹配结果,不进行存储供以后使用；&lt;br /&gt; 例如“industr(?:y\|ies)”就是一个比“industry\|industries”更简略的表达式。 |</span><br><span class="line">| (?=pattern) | 非获取匹配，正向肯定预查；&lt;br /&gt;在任何匹配pattern的字符串开始处匹配查找字符串，该匹配不需要获取供以后使用。&lt;br /&gt;例如：“Windows(?=95\|98\|NT\|2000)”&lt;br /&gt; 能匹配“Windows2000”中的“Windows”,但不能匹配“Windows3.1”中的“Windows”。&lt;br /&gt;预查不消耗 字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次，&lt;br /&gt;匹配的搜索而不 是从包含预查的字符之后开始。 |</span><br><span class="line">| (?!pattern) | 非获取匹配，正向否定预查;&lt;br /&gt;在任何不匹配pattern的字符串开始处匹配查找字符串，&lt;br /&gt;该匹配不需要获取供以后使用;&lt;br /&gt;例如：“Windows(?!95\|98\|NT\|2000)”能匹配“Windows3.1”中的&lt;br /&gt;“Windows”，但不能匹配“Windows2000”中的“Windows”。 |</span><br><span class="line">| (?&lt;=pattern) | 非获取匹配，反向肯定预查，与正向肯定预查类似，只是方向相反；&lt;br /&gt;例如：“(?&lt;=95\|98\|NT\|2000)Windows”能匹配“2000Windows”中&lt;br /&gt;的“Windows”，但不能匹配“3.1Windows”中的“Windows”) |</span><br><span class="line">| (?&lt;!pattern) | 非获取匹配，反向否定预查，与正向否定预查类似，只是方向相反；&lt;br /&gt;(例如“(?&lt;!95\|98\|NT\|2000)Windows”能匹配“3.1Windows”中的“Windows”,&lt;br /&gt;但不能匹配“2000Windows”中的“Windows” |</span><br></pre></td></tr></table></figure>
<h5 id="其它匹配字符"><a href="#其它匹配字符" class="headerlink" title="其它匹配字符"></a>其它匹配字符</h5><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">元字符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">\f</td>
<td style="text-align:left">匹配一个换页符。等价于\x0c和\cL</td>
</tr>
<tr>
<td style="text-align:left">\n</td>
<td style="text-align:left">匹配一个换行符。等价于\x0a和\cJ</td>
</tr>
<tr>
<td style="text-align:left">\r</td>
<td style="text-align:left">匹配一个回车符。等价于\x0d和\cM</td>
</tr>
<tr>
<td style="text-align:left">\t</td>
<td style="text-align:left">匹配一个制表符。等价于\x09和\cI</td>
</tr>
<tr>
<td style="text-align:left">\v</td>
<td style="text-align:left">匹配一个垂直制表符。等价于\x0b和\cK</td>
</tr>
<tr>
<td style="text-align:left">\xn</td>
<td style="text-align:left">匹配十六进制数n的转义值（例如：“\x41”匹配“A”）</td>
</tr>
</tbody>
</table>
</div>
<h4 id="转义字符问题"><a href="#转义字符问题" class="headerlink" title="转义字符问题"></a>转义字符问题</h4><p>由于Python的字符串本身也用\转义，因此强烈建议使用Python的r前缀来写正则，就不用考虑转义的问题了：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'ABC\\-001'</span> <span class="comment"># 'ABC\-001'</span></span><br><span class="line">s = <span class="string">r'ABC\-001'</span> <span class="comment"># 'ABC\-001'</span></span><br></pre></td></tr></table></figure>
<h4 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h4><blockquote>
<p>Python提供re模块，提供所有与正则表达式相关的功能;</p>
</blockquote>
<h5 id="正则匹配方法"><a href="#正则匹配方法" class="headerlink" title="正则匹配方法"></a>正则匹配方法</h5><h6 id="查找和匹配"><a href="#查找和匹配" class="headerlink" title="查找和匹配"></a>查找和匹配</h6><blockquote>
<p>match、search、findall</p>
</blockquote>
<p>1.语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">re.match(pattern,string,flag)：判断字符串的首个元素是否匹配pattern，不匹配直接返回None，匹配时返回一个结果对象；</span><br><span class="line">re.search(pattern,string,flag)：搜索整个字符串查找第一个匹配的字符串并返回它的结果对象，没有匹配的则返回None；</span><br><span class="line">re.findall(pattern,string)：找出string中所有匹配的元素，返回结果[]列表；</span><br><span class="line">re.findall(pattern,string,flag)：找出string中所有匹配的元素，返回结果[]列表；</span><br><span class="line">【参数解析】</span><br><span class="line">flag：代表匹配模式，可以用|(或)符号一次使用多个flag.</span><br><span class="line">      常见flag匹配模式有：</span><br><span class="line">      1&gt; re.I：不区分大小写；</span><br><span class="line">      2&gt; re.S：让.(点)可以匹配\n；</span><br></pre></td></tr></table></figure>
<p>2.示例：</p>
<p>1&gt; match</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">regex = <span class="string">r'^\d&#123;3&#125;\-\d&#123;3,8&#125;$'</span></span><br><span class="line">test = <span class="string">'010-12345'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印匹配结果</span></span><br><span class="line">r = re.match(regex, <span class="string">'010-12345'</span>)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑判断是否匹配</span></span><br><span class="line"><span class="keyword">if</span> re.match(regex, test):</span><br><span class="line">    print(<span class="string">'ok'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'failed'</span>)</span><br></pre></td></tr></table></figure>
<p>2&gt; findall</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">a = <span class="string">'hello ethan, hello jason'</span></span><br><span class="line">b = re.findall(<span class="string">'hello'</span>, a)</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure>
<h6 id="分组匹配"><a href="#分组匹配" class="headerlink" title="分组匹配"></a>分组匹配</h6><p>除了简单地判断是否匹配之外，正则表达式还有提取子串的强大功能。正则表达式中用()包裹的部分表示的就是要提取的分组（Group）。</p>
<p><strong>要点</strong></p>
<ul>
<li>如果正则表达式中定义了组，就可以在Match对象上用group()方法提取出子串来。</li>
<li>group(0)永远是原始字符串，group(1)、group(2)……表示第1、2、……个子串。</li>
</ul>
<p><strong>示例</strong></p>
<ol>
<li>普通分组和子串的提取：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; m = re.match(r&apos;^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$&apos;, &apos;010-12345&apos;)</span><br><span class="line">&gt;&gt;&gt; m</span><br><span class="line">&lt;_sre.SRE_Match object; span=(0, 9), match=&apos;010-12345&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; m.group(0)</span><br><span class="line">&apos;010-12345&apos;</span><br><span class="line">&gt;&gt;&gt; m.group(1)</span><br><span class="line">&apos;010&apos;</span><br><span class="line">&gt;&gt;&gt; m.group(2)</span><br><span class="line">&apos;12345&apos;</span><br></pre></td></tr></table></figure>
<ol>
<li>正则来识别合法的时间：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; t = &apos;19:05:30&apos;</span><br><span class="line">&gt;&gt;&gt; m = re.match(r&apos;^(0[0-9]|1[0-9]|2[0-3]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$&apos;, t)</span><br><span class="line">&gt;&gt;&gt; m.groups()</span><br><span class="line">(&apos;19&apos;, &apos;05&apos;, &apos;30&apos;)</span><br></pre></td></tr></table></figure>
<h6 id="贪婪匹配"><a href="#贪婪匹配" class="headerlink" title="贪婪匹配"></a>贪婪匹配</h6><p>贪婪匹配模式：正则表达式默认匹配模式，尽可能多的匹配所搜索的字符串；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; re.match(r&apos;^(\d+)(0*)$&apos;, &apos;102300&apos;).groups()</span><br><span class="line">(&apos;102300&apos;, &apos;&apos;)</span><br><span class="line"># 由于\d+采用贪婪匹配，直接把后面的0全部匹配了，结果0*只能匹配空字符串了。</span><br></pre></td></tr></table></figure>
<h6 id="非贪婪匹配"><a href="#非贪婪匹配" class="headerlink" title="非贪婪匹配"></a>非贪婪匹配</h6><p>非贪婪匹配模式：尽可能少的匹配所搜索的字符串；</p>
<blockquote>
<p>非贪婪模式限制符为问号?,即当?字符紧跟在任何一个其他限制符（*,+,?，{n}，{n,}，{n,m}）后面时，匹配模式是非贪婪的。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如：对于字符串“oooo”的贪婪和非贪婪匹配处理？</span><br><span class="line">1&gt; “o+”将尽可能多的匹配“o”，得到结果[“oooo”]，</span><br><span class="line">2&gt; “o+?”将尽可能少的匹配“o”，得到结果 [&apos;o&apos;, &apos;o&apos;, &apos;o&apos;, &apos;o&apos;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 示例</span><br><span class="line">&gt;&gt;&gt; re.match(r&apos;^(\d+?)(0*)$&apos;, &apos;102300&apos;).groups()</span><br><span class="line">(&apos;1023&apos;, &apos;00&apos;)</span><br></pre></td></tr></table></figure>
<h5 id="re模块其他操作函数"><a href="#re模块其他操作函数" class="headerlink" title="re模块其他操作函数"></a>re模块其他操作函数</h5><h6 id="查找替换"><a href="#查找替换" class="headerlink" title="查找替换"></a>查找替换</h6><ol>
<li>语法：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">re.sub(pattern,replace,string,count)</span><br><span class="line">【参数】</span><br><span class="line">&gt; replace是字符串时：将string中符合pattern表达式的字符替换成replace；</span><br><span class="line">&gt; replace是函数时：接收string中满足替换条件pattern的所有结果所组成的value对象作为参数，通过value.group()方法拿到pattern符合表达式的结果字符；</span><br><span class="line">    【value.group解析】</span><br><span class="line">    value.group(index)：index不传时默认0，获取匹配的结果字符；</span><br><span class="line">                        如果pattern使用()分组，则返回结果同分组类似：</span><br><span class="line">                        1&gt; index=0时，返回的是完整匹配;</span><br><span class="line">                        2&gt; index&gt;0时，返回对应第index组匹配结果；</span><br><span class="line">    value.groups()：返回value对应的所有结果组成的元组；</span><br><span class="line">&gt; count：表示替换几个(默认0表示替换所有)；</span><br></pre></td></tr></table></figure>
<ol>
<li>示例：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">language = &apos;PythonC#12JavaC#3PHPC#21&apos;</span><br><span class="line"></span><br><span class="line">def convert(value):</span><br><span class="line">    print(value.groups())</span><br><span class="line">    print(value.group())</span><br><span class="line">    return &apos;*&apos;</span><br><span class="line"></span><br><span class="line"># 普通匹配</span><br><span class="line">r = re.sub(r&apos;C#&apos;, convert, language)</span><br><span class="line"># 分组匹配</span><br><span class="line">r = re.sub(r&apos;(C#)(\d)&apos;, convert, language)</span><br><span class="line"></span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>
<h6 id="预编译该正则表达式"><a href="#预编译该正则表达式" class="headerlink" title="预编译该正则表达式"></a>预编译该正则表达式</h6><p>如果一个正则表达式要重复使用几千次，出于效率的考虑，我们可以预编译该正则表达式，接下来重复使用时就不需要编译这个步骤了，直接匹配：</p>
<blockquote>
<p>编译后生成Regular Expression对象，由于该对象自己包含了正则表达式，所以调用对应的方法时不用给出正则字符串。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import re</span><br><span class="line"># 编译:</span><br><span class="line">&gt;&gt;&gt; re_telephone = re.compile(r&apos;^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$&apos;)</span><br><span class="line"># 使用：</span><br><span class="line">&gt;&gt;&gt; re_telephone.match(&apos;010-12345&apos;).groups()</span><br><span class="line">(&apos;010&apos;, &apos;12345&apos;)</span><br><span class="line">&gt;&gt;&gt; re_telephone.match(&apos;010-8086&apos;).groups()</span><br><span class="line">(&apos;010&apos;, &apos;8086&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="正则切分字符串"><a href="#正则切分字符串" class="headerlink" title="正则切分字符串"></a>正则切分字符串</h4><p>用正则表达式切分字符串比用固定的字符更灵活；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 普通分隔符切分，无法识别连续空格</span><br><span class="line">&gt;&gt;&gt; &apos;a b   c&apos;.split(&apos; &apos;)</span><br><span class="line">[&apos;a&apos;, &apos;b&apos;, &apos;&apos;, &apos;&apos;, &apos;c&apos;]</span><br><span class="line"></span><br><span class="line"># 使用正则切分字符串，可以识别连续空格</span><br><span class="line">&gt;&gt;&gt; re.split(r&apos;\s+&apos;, &apos;a b   c&apos;)</span><br><span class="line">[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]</span><br></pre></td></tr></table></figure>
<h4 id="正则表达式收集"><a href="#正则表达式收集" class="headerlink" title="正则表达式收集"></a>正则表达式收集</h4><h5 id="校验数字的表达式"><a href="#校验数字的表达式" class="headerlink" title="校验数字的表达式"></a>校验数字的表达式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1. 数字：^[0-9]*$</span><br><span class="line">2. n位的数字：^\d&#123;n&#125;$</span><br><span class="line">3. 至少n位的数字：^\d&#123;n,&#125;$</span><br><span class="line">4. m-n位的数字：^\d&#123;m,n&#125;$</span><br><span class="line">5. 零和非零开头的数字：^(0|[1-9][0-9]*)$</span><br><span class="line">6. 非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line">7. 带1-2位小数的正数或负数：^(\-)?\d+(\.\d&#123;1,2&#125;)?$</span><br><span class="line">8. 正数、负数、和小数：^(\-|\+)?\d+(\.\d+)?$</span><br><span class="line">9. 有两位小数的正实数：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line">10. 有1~3位小数的正实数：^[0-9]+(.[0-9]&#123;1,3&#125;)?$</span><br><span class="line">11. 非零的正整数：^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$</span><br><span class="line">12. 非零的负整数：^\-[1-9][]0-9&quot;*$ 或 ^-[1-9]\d*$</span><br><span class="line">13. 非负整数：^\d+$ 或 ^[1-9]\d*|0$</span><br><span class="line">14. 非正整数：^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$</span><br><span class="line">15. 非负浮点数：^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</span><br><span class="line">16. 非正浮点数：^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</span><br><span class="line">17. 正浮点数：^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</span><br><span class="line">18. 负浮点数：^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</span><br><span class="line">19. 浮点数：^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</span><br></pre></td></tr></table></figure>
<h5 id="校验字符的表达式"><a href="#校验字符的表达式" class="headerlink" title="校验字符的表达式"></a>校验字符的表达式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1. 汉字：^[\u4e00-\u9fa5]&#123;0,&#125;$</span><br><span class="line">2. 英文和数字：^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$</span><br><span class="line">3. 长度为3-20的所有字符：^.&#123;3,20&#125;$</span><br><span class="line">4. 由26个英文字母组成的字符串：^[A-Za-z]+$</span><br><span class="line">5. 由26个大写英文字母组成的字符串：^[A-Z]+$</span><br><span class="line">6. 由26个小写英文字母组成的字符串：^[a-z]+$</span><br><span class="line">7. 由数字和26个英文字母组成的字符串：^[A-Za-z0-9]+$</span><br><span class="line">8. 由数字、26个英文字母或者下划线组成的字符串：^\w+$ 或 ^\w&#123;3,20&#125;$</span><br><span class="line">9. 中文、英文、数字包括下划线：^[\u4E00-\u9FA5A-Za-z0-9_]+$</span><br><span class="line">10. 中文、英文、数字但不包括下划线等符号：^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$</span><br><span class="line">11. 可以输入含有^%&amp;&apos;,;=?$\&quot;等字符：[^%&amp;&apos;,;=?$\x22]+ 12 禁止输入含有~的字符：[^~\x22]+</span><br><span class="line">12. 空白行的正则表达式：\n\s*\r (可以用来删除空白行)</span><br></pre></td></tr></table></figure>
<h5 id="Email地址"><a href="#Email地址" class="headerlink" title="Email地址"></a>Email地址</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</span><br></pre></td></tr></table></figure>
<h5 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?</span><br></pre></td></tr></table></figure>
<h5 id="手机号码"><a href="#手机号码" class="headerlink" title="手机号码"></a>手机号码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$</span><br></pre></td></tr></table></figure>
<h5 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 提取IP地址</span><br><span class="line">\d+\.\d+\.\d+\.\d+</span><br><span class="line"># 匹配IP地址</span><br><span class="line">((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</span><br></pre></td></tr></table></figure>
<h3 id="IO编程"><a href="#IO编程" class="headerlink" title="IO编程"></a>IO编程</h3><h4 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h4><p>Python中文件读写的IO操作主要有以下步骤内容：</p>
<ol>
<li>通过with open()函数打开文件,with的作用是自动关闭文件(等价于调用close函数关闭文件)；</li>
<li>使用read或write进行读写操作；</li>
<li>读写文件的过程，最好捕获错误；</li>
</ol>
<h5 id="读文件示例"><a href="#读文件示例" class="headerlink" title="读文件示例"></a>读文件示例</h5><p>读一个文本文件，输出所有内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./test.txt'</span>, <span class="string">'rt'</span>, encoding=<span class="string">'utf-8'</span>, errors=<span class="string">'ignore'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(f.read())</span><br><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<p>等价于：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">None</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 内置函数open()函数用来打开文件对象</span></span><br><span class="line">    <span class="comment"># 标示符'r'表示读</span></span><br><span class="line">    f = open(<span class="string">'./test.txt'</span>, <span class="string">'rt'</span>, encoding=<span class="string">'utf-8'</span>, errors=<span class="string">'ignore'</span>)</span><br><span class="line">    <span class="comment"># read()一次读取文件的全部内容</span></span><br><span class="line">    print(f.read())</span><br><span class="line">    <span class="comment"># close()关闭文件</span></span><br><span class="line">    f.close()</span><br><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">raise</span> IOError(<span class="string">'IO异常'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<h5 id="读写文件的内置函数"><a href="#读写文件的内置函数" class="headerlink" title="读写文件的内置函数"></a>读写文件的内置函数</h5><h6 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h6><p>open函数用来打开文件准备进行操作，语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">open(file, mode=&apos;r&apos;, buffering=None, encoding=None, errors=None, newline=None, closefd=True)</span><br><span class="line">【参数】</span><br><span class="line">&gt; file: 将要打开的文件，可以是文件地址；</span><br><span class="line">&gt; mode: 操作文件的模式（r(读)、w(覆盖写)、x(创建文件并打开写)、a(追加写)、b(二进制)、t(默认文本)、+(更新模式读写)）</span><br><span class="line">        注意：r/w/x可以与b/t拼接使用；</span><br><span class="line">&gt; encoding: 编码格式；</span><br><span class="line">&gt; error: 错误处理，可以设置为&apos;ignore&apos;，忽略错误；</span><br></pre></td></tr></table></figure>
<p><strong>示例</strong></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开读一个二进制文件</span></span><br><span class="line">f = open(<span class="string">'./test.jpg'</span>, <span class="string">'rb'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="read"><a href="#read" class="headerlink" title="read()"></a>read()</h6><p>读文件，返回字符串，语法解释如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(size): size不传时默认读取全部，否则按size大小读；</span><br></pre></td></tr></table></figure>
<h6 id="readlines"><a href="#readlines" class="headerlink" title="readlines()"></a>readlines()</h6><p>调用readlines()一次读取所有内容并按行返回list。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">    print(line.strip()) <span class="comment"># 把末尾的'\n'删掉</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>类似方法：readline()可以每次读取一行内容，</p>
</blockquote>
<h6 id="write"><a href="#write" class="headerlink" title="write()"></a>write()</h6><p>写文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write(str): str为写入的内容；</span><br></pre></td></tr></table></figure>
<h4 id="内存读写"><a href="#内存读写" class="headerlink" title="内存读写"></a>内存读写</h4><h5 id="StringIO"><a href="#StringIO" class="headerlink" title="StringIO"></a>StringIO</h5><blockquote>
<p><span style="color:red">StringIO作用是在内存中读写str。</span></p>
</blockquote>
<h6 id="内存读写操作"><a href="#内存读写操作" class="headerlink" title="内存读写操作"></a>内存读写操作</h6><ul>
<li>write(str)方法将数据写入内存,调用此方法后读的位置会变成当前字符末尾，如果调用read()读的话，需要先调用seek(0)将读的位置重置才行； </li>
<li>getvalue()方法用于获得写入后的str;</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">f = StringIO()</span><br><span class="line">f.write(<span class="string">'hello world'</span>)</span><br><span class="line">print(f.getvalue())</span><br></pre></td></tr></table></figure>
<ul>
<li>StringIO实例对象可以像读文件一调用read方法读，但是如果实例化后再调用写入方法则需要调用seek(0)重置读的位置；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实例化后读</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">f = StringIO(<span class="string">"hello\nworld\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    s = f.readline()</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(s.strip())</span><br><span class="line"></span><br><span class="line">print(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入后再读，需要seek(0)</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line">f = StringIO(<span class="string">"hello\nworld\n"</span>)</span><br><span class="line">print(f.read())</span><br><span class="line"></span><br><span class="line">f.write(<span class="string">"welcome read"</span>)</span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    s = f.read()</span><br><span class="line">    <span class="keyword">if</span> s == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(s.strip())</span><br><span class="line"></span><br><span class="line">print(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="ByteIO"><a href="#ByteIO" class="headerlink" title="ByteIO"></a>ByteIO</h5><p>StringIO操作的只能是str，如果要操作二进制数据，就需要使用BytesIO。</p>
<h6 id="读写操作"><a href="#读写操作" class="headerlink" title="读写操作"></a>读写操作</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">f = BytesIO()</span><br><span class="line"><span class="comment"># 写入二进制</span></span><br><span class="line">f.write(<span class="string">'中文'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(f.getvalue())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 像读文件一样读</span></span><br><span class="line">f_read = BytesIO(<span class="string">b'\xe4\xb8\xad\xe6\x96\x87'</span>)</span><br><span class="line">print(f.read())</span><br></pre></td></tr></table></figure>
<h4 id="操作系统和文件目录"><a href="#操作系统和文件目录" class="headerlink" title="操作系统和文件目录"></a>操作系统和文件目录</h4><p>Python的os模块封装了操作系统的目录和文件操作，要注意这些函数有的在os模块中，有的在os.path模块中。</p>
<h5 id="获取操作系统信息"><a href="#获取操作系统信息" class="headerlink" title="获取操作系统信息"></a>获取操作系统信息</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># os模块的某些函数是跟操作系统相关</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取操作系统类型(nt:windows,posix:linux/macOs/unix)</span></span><br><span class="line">print(os.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux获取详细的系统信息</span></span><br><span class="line"><span class="comment"># print(os.uname())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取操作系统中定义的环境变量</span></span><br><span class="line">print(os.environ)</span><br><span class="line"><span class="comment"># 获取某个环境变量的值</span></span><br><span class="line">print(os.environ.get(<span class="string">'PATH'</span>))</span><br><span class="line">print(os.environ.get(<span class="string">'x'</span>, <span class="string">'default'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="操作文件和目录"><a href="#操作文件和目录" class="headerlink" title="操作文件和目录"></a>操作文件和目录</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前路径可以用'.'表示</span></span><br><span class="line"><span class="comment"># 获取当前模块的文件名</span></span><br><span class="line">print(__file__)</span><br><span class="line"><span class="comment"># 当前系统的路径分隔符</span></span><br><span class="line">print(os.sep)</span><br><span class="line"><span class="comment"># 操作文件和目录</span></span><br><span class="line"><span class="comment"># 查看当前目录的绝对路径</span></span><br><span class="line">print(os.path.abspath(<span class="string">'.'</span>))</span><br><span class="line"><span class="comment"># 获取当前目录下所有文件和目录</span></span><br><span class="line">print(os.listdir(<span class="string">'.'</span>))</span><br><span class="line"><span class="comment"># 判断是否是目录</span></span><br><span class="line">print(os.path.isdir(<span class="string">'./utils'</span>))</span><br><span class="line"><span class="comment"># 判断是否是文件</span></span><br><span class="line">print(os.path.isfile(<span class="string">'./test.md'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 路径拼接：不要直接拼字符串，而要通过os.path.join()函数进行拼接</span></span><br><span class="line"><span class="comment"># 创建一个目录:</span></span><br><span class="line">new_dir = os.path.join(os.path.abspath(<span class="string">'.'</span>), <span class="string">'testdir'</span>)</span><br><span class="line">os.mkdir(new_dir)</span><br><span class="line"><span class="comment"># 删掉一个目录:</span></span><br><span class="line">os.rmdir(new_dir)</span><br><span class="line"><span class="comment"># split将最后面级别的目录或文件与前缀的路径分割</span></span><br><span class="line">print(os.path.split(<span class="string">'/Users/michael/testdir/file.txt'</span>))</span><br><span class="line"><span class="comment"># 将文件路径加文件名作为整体和文件扩展名分割</span></span><br><span class="line">print(os.path.splitext(<span class="string">'/path/to/file.txt'</span>))</span><br><span class="line"><span class="comment"># 文件重命名</span></span><br><span class="line">os.rename(<span class="string">'./test.txt'</span>, <span class="string">'test.md'</span>)</span><br><span class="line"><span class="comment"># 删除一个文件</span></span><br><span class="line">os.remove(<span class="string">'test.py'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="复制文件"><a href="#复制文件" class="headerlink" title="复制文件"></a>复制文件</h6><ul>
<li>os模块中没有复制文件的函数，但是读写文件可以完成文件复制，也可以使用shutil模块提供的copyfile()</li>
<li>shutil模块中找到很多实用函数，它们可以看做是os模块的补充。</li>
</ul>
<h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><h5 id="pickling序列化"><a href="#pickling序列化" class="headerlink" title="pickling序列化"></a>pickling序列化</h5><h6 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h6><blockquote>
<p>Python提供了pickle模块来实现序列化。</p>
</blockquote>
<p>我们把变量从内存中变成可存储或传输的过程称之为序列化，在Python中叫pickling，在其他语言中也被称之为serialization，marshalling，flattening等等，都是一个意思。</p>
<ul>
<li>序列化：序列化之后，就可以把序列化后的内容写入磁盘，或者通过网络传输到别的机器上。</li>
<li>反序列化：反过来，把变量内容从序列化的对象重新读到内存里称之为反序列化，即unpickling。</li>
</ul>
<h6 id="序列化操作"><a href="#序列化操作" class="headerlink" title="序列化操作"></a>序列化操作</h6><ul>
<li>pickle.dumps()方法把任意对象序列化成一个bytes；</li>
<li>pickle.loads()方法把序列化的bytes反序列化为Python对象；</li>
<li>pickle.dump()方法将一个对象序列化，并写入文件;</li>
<li>pickle.loads()方法从文件中读取byte并反序列化出对象；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">d = dict(name=<span class="string">'Bob'</span>, age=<span class="number">20</span>, score=<span class="number">88</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象的序列化和反序列化</span></span><br><span class="line">b = pickle.dumps(d)</span><br><span class="line">print(b)</span><br><span class="line">print(pickle.loads(b))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 序列化到文件，从文件中反序列化</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'dump.txt'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> fw:</span><br><span class="line">    pickle.dump(d, fw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'dump.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> fr:</span><br><span class="line">    print(pickle.load(fr))</span><br></pre></td></tr></table></figure>
<h3 id="JSON序列化"><a href="#JSON序列化" class="headerlink" title="JSON序列化"></a>JSON序列化</h3><h4 id="json写法"><a href="#json写法" class="headerlink" title="json写法"></a>json写法</h4><blockquote>
<p>注意：json对象的key和字符串value必须用双引号包裹；</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">json对象写法：&#123;“key”:&quot;value&quot;,....&#125; </span><br><span class="line">json数组写法：[&#123;“key”:&quot;value&quot;,....&#125; ,&#123;&#125;]</span><br><span class="line">json字符串写法：json_str=&apos;&#123;“key”:&quot;value&quot;,....&#125;&apos;</span><br></pre></td></tr></table></figure>
<h4 id="json和python的数据类型"><a href="#json和python的数据类型" class="headerlink" title="json和python的数据类型"></a>json和python的数据类型</h4><p>json和python的数据类型对应关系如下：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">json</th>
<th style="text-align:center">python</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">object</td>
<td style="text-align:center">dict</td>
</tr>
<tr>
<td style="text-align:center">array</td>
<td style="text-align:center">list</td>
</tr>
<tr>
<td style="text-align:center">string</td>
<td style="text-align:center">str</td>
</tr>
<tr>
<td style="text-align:center">number</td>
<td style="text-align:center">int或float</td>
</tr>
<tr>
<td style="text-align:center">true</td>
<td style="text-align:center">True</td>
</tr>
<tr>
<td style="text-align:center">false</td>
<td style="text-align:center">False</td>
</tr>
<tr>
<td style="text-align:center">null</td>
<td style="text-align:center">None</td>
</tr>
</tbody>
</table>
</div>
<h4 id="处理json"><a href="#处理json" class="headerlink" title="处理json"></a>处理json</h4><h5 id="json字符串转python对象"><a href="#json字符串转python对象" class="headerlink" title="json字符串转python对象"></a>json字符串转python对象</h5><p>json.loads()函数是将json格式数据转换为字典</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">json_str = <span class="string">'[&#123;"key": "value"&#125;]'</span></span><br><span class="line">d = json.loads(json_str)</span><br><span class="line">print(d)</span><br><span class="line"><span class="comment"># [&#123;'key': 'value'&#125;]</span></span><br></pre></td></tr></table></figure>
<h5 id="python对象转json字符串"><a href="#python对象转json字符串" class="headerlink" title="python对象转json字符串"></a>python对象转json字符串</h5><p>json.dumps()函数是将一个Python数据类型列表进行json格式的编码;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">obj_py = [&#123;<span class="string">'key'</span>: <span class="string">'value'</span>&#125;]</span><br><span class="line">print(json.dumps(obj_py))</span><br><span class="line"><span class="comment"># [&#123;"key": "value"&#125;]</span></span><br></pre></td></tr></table></figure>
<h6 id="处理中文"><a href="#处理中文" class="headerlink" title="处理中文"></a>处理中文</h6><p>json.dumps接收ensure_ascii参数表示是否使用ascii编码，默认为True时不能正确显示中文，如果显示中文请设置为False;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">obj = dict(name=<span class="string">'小明'</span>, age=<span class="number">20</span>)</span><br><span class="line">s = json.dumps(obj, ensure_ascii=<span class="keyword">False</span>)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<h5 id="读写json文件"><a href="#读写json文件" class="headerlink" title="读写json文件"></a>读写json文件</h5><ul>
<li>json.dump()函数将json信息写入.json文件；</li>
<li>json.load()函数从.json文件中读取json信息；</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># json.dump()函数的使用，将json信息写进文件</span></span><br><span class="line">json_info = <span class="string">"&#123;'age': '12'&#125;"</span></span><br><span class="line">file = open(<span class="string">'1.json'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">json.dump(json_info, file)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json.load()函数的使用，将读取json信息</span></span><br><span class="line">file = open(<span class="string">'1.json'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">info = json.load(file)</span><br><span class="line">print(info)</span><br></pre></td></tr></table></figure>
<h5 id="json序列化类对象"><a href="#json序列化类对象" class="headerlink" title="json序列化类对象"></a>json序列化类对象</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, score)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################</span></span><br><span class="line"><span class="comment"># 序列化对象：dumps接收自定义转换函数</span></span><br><span class="line"><span class="comment">#######################################</span></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="number">20</span>, <span class="number">88</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数将对象转为dict</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">student2dict</span><span class="params">(std)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'name'</span>: std.name,</span><br><span class="line">        <span class="string">'age'</span>: std.age,</span><br><span class="line">        <span class="string">'score'</span>: std.score</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># dumps()方法可选参数default用来指定转换方法</span></span><br><span class="line">print(json.dumps(s, default=student2dict))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把任意class的实例变为dict</span></span><br><span class="line"><span class="comment"># class的实例都有一个__dict__属性,但是定义了__slots__的class没有；</span></span><br><span class="line">print(json.dumps(s, default=<span class="keyword">lambda</span> objx: objx.__dict__))</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################</span></span><br><span class="line"><span class="comment"># 对象反序列化：loads接收自定义转换函数</span></span><br><span class="line"><span class="comment">#######################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 反序列化对象</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dict2student</span><span class="params">(d)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Student(d[<span class="string">'name'</span>], d[<span class="string">'age'</span>], d[<span class="string">'score'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义转换函数</span></span><br><span class="line">json_str = <span class="string">'&#123;"age": 20, "score": 88, "name": "Bob"&#125;'</span></span><br><span class="line">print(json.loads(json_str, object_hook=dict2student))</span><br><span class="line"></span><br><span class="line">obj = dict(name=<span class="string">'小明'</span>, age=<span class="number">20</span>)</span><br><span class="line"><span class="comment"># ensure_ascii: 表示是否使用ascii编码，ascii不能正确显示中文</span></span><br><span class="line">s = json.dumps(obj)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<h3 id="多任务"><a href="#多任务" class="headerlink" title="多任务"></a>多任务</h3><p>多任务的实现有3种方式：</p>
<ol>
<li>多进程模式；</li>
<li>多线程模式；</li>
<li>多进程+多线程模式。</li>
</ol>
<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><h4 id="os模块进程方法"><a href="#os模块进程方法" class="headerlink" title="os模块进程方法"></a>os模块进程方法</h4><ul>
<li>os.getppid()：获取父进程id；</li>
<li>os.getpid()：获取当前进程id；</li>
<li>os.fork()：创建子进程(仅支持Unix/Linux/Mac)；</li>
</ul>
<h4 id="fork进程"><a href="#fork进程" class="headerlink" title="fork进程"></a>fork进程</h4><blockquote>
<p>在Python的os模块的fork函数可以轻松创建子进程，但是fork()仅支持Unix/Linux/Mac;</p>
</blockquote>
<p>调用fork函数创建进程，需要注意fork()调用一次，返回两次:</p>
<blockquote>
<p>for()调用时操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回；</p>
</blockquote>
<ul>
<li>子进程永远返回0；</li>
<li>父进程返回子进程的ID。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">print(<span class="string">'Process (%s) start...'</span> % os.getpid())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个子进程</span></span><br><span class="line">pid = os.fork()</span><br><span class="line"><span class="keyword">if</span> pid == <span class="number">0</span>:</span><br><span class="line">    print(<span class="string">'子进程 (%s) 的父进程是 %s.'</span> % (os.getpid(), os.getppid()))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'父进程 (%s) 创建了一个子进程 (%s).'</span> % (os.getpid(), pid))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Process c start...</span></span><br><span class="line"><span class="comment"># 子进程 c 的父进程是 p.</span></span><br><span class="line"><span class="comment"># 父进程 p 创建了一个子进程 c.</span></span><br></pre></td></tr></table></figure>
<h4 id="跨平台进程模块"><a href="#跨平台进程模块" class="headerlink" title="跨平台进程模块"></a>跨平台进程模块</h4><blockquote>
<p>multiprocessing模块就是跨平台版本的多进程模块.</p>
</blockquote>
<p>multiprocessing模块提供了一个Process类来表示一个进程对象;</p>
<h5 id="Process进程对象"><a href="#Process进程对象" class="headerlink" title="Process进程对象"></a>Process进程对象</h5><h6 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def __init__(self, group=None, target=None, name=None, args=(), kwargs=&#123;&#125;)</span><br><span class="line">【参数解析】</span><br><span class="line">- group：进程所属组，基本不用 </span><br><span class="line">- target：进程调用的处理方法对象（可以是一个函数名，也可以是一个可调用的对象（实现了__call__方法的类）） </span><br><span class="line">- args：调用对象的位置参数元组 </span><br><span class="line">- name：别名 </span><br><span class="line">- kwargs：调用对象的关键字参数字典</span><br></pre></td></tr></table></figure>
<h6 id="实例方法-1"><a href="#实例方法-1" class="headerlink" title="实例方法"></a>实例方法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">is_alive()：返回进程是否在运行 </span><br><span class="line">start()：启动进程，等待CPU调度 </span><br><span class="line">join([timeout])：阻塞当前上下文环境，直到调用此方法的进程终止或者到达指定timeout </span><br><span class="line">terminate()：不管任务是否完成，立即停止该进程 </span><br><span class="line">run()：start()调用该方法，当实例进程没有传入target参数，stat()将执行默认的run()方法</span><br></pre></td></tr></table></figure>
<h6 id="实例属性"><a href="#实例属性" class="headerlink" title="实例属性"></a>实例属性</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- authkey：进程的认证密钥(字节字符串) </span><br><span class="line">- daemon：守护进程标识，在start()调用之前可以对其进行修改 </span><br><span class="line">- exitcode：进程的退出状态码 </span><br><span class="line">- name：进程名 </span><br><span class="line">- pid：进程</span><br></pre></td></tr></table></figure>
<h6 id="示例-17"><a href="#示例-17" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数，作为进程任务</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_proc</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'进程(%s)运行中: 接收外部信息参数name = %s'</span> % (os.getpid(),name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'当前进程是 %s.'</span> % os.getpid())</span><br><span class="line">    <span class="comment"># 1. 创建一个进程</span></span><br><span class="line">    p = Process(target=run_proc, args=(<span class="string">'test'</span>,))</span><br><span class="line">    print(<span class="string">'子进程将开始...'</span>)</span><br><span class="line">    <span class="comment"># 2. 启动进程</span></span><br><span class="line">    p.start()</span><br><span class="line">    <span class="comment"># 3. join方法阻塞进程，等待进程结束再继续执行</span></span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">'子进程结束'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="Pool进程池"><a href="#Pool进程池" class="headerlink" title="Pool进程池"></a>Pool进程池</h5><blockquote>
<p>如果要启动大量的子进程，可以用进程池Pool的方式批量创建子进程;</p>
</blockquote>
<h6 id="要点-6"><a href="#要点-6" class="headerlink" title="要点"></a>要点</h6><ul>
<li>Pool的默认大小是CPU的核数;</li>
</ul>
<h6 id="Pool实例方法"><a href="#Pool实例方法" class="headerlink" title="Pool实例方法"></a>Pool实例方法</h6><ul>
<li>创建进程池：Pool(count);</li>
<li>创建子进程：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建子进程任务，串行执行（需要等待当前子进程执行完毕后，再执行下一个进程）；</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">apply</span><span class="params">(self, func, args=<span class="params">()</span>, kwds=&#123;&#125;)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子进程任务，并行执行（不用等待当前进程执行完毕，随时根据系统调度来进行进程切换）；</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">apply_async</span><span class="params">(self, func, args=<span class="params">()</span>, kwds=&#123;&#125;, callback=None,error_callback=None)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<ul>
<li>close()：关闭pool，使其不在接受新的任务；</li>
<li>terminate()：结束工作进程，不在处理未完成的任务。</li>
<li>join()：主进程阻塞，等待子进程的退出，join方法要在close或terminate之后使用。</li>
</ul>
<h6 id="示例-18"><a href="#示例-18" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于创建子进程的耗时任务函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_time_task</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'Run task %s (%s)...'</span> % (name, os.getpid()))</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * <span class="number">3</span>)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">'Task %s runs %0.2f seconds.'</span> % (name, (end - start)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(<span class="string">'Parent process %s.'</span> % os.getpid())</span><br><span class="line">    p = Pool(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="comment"># 异步执行一个进程任务，并行任务</span></span><br><span class="line">        <span class="comment"># 异步任务进程</span></span><br><span class="line">        p.apply_async(long_time_task, args=(i,))</span><br><span class="line">        <span class="comment"># 同步任务进程</span></span><br><span class="line">        <span class="comment"># p.apply(long_time_task, args=(i,))</span></span><br><span class="line">    print(<span class="string">'Waiting for all subprocesses done...'</span>)</span><br><span class="line">    <span class="comment"># 调用join()之前必须先调用close()，调用close()之后就不能继续添加新的Process了；</span></span><br><span class="line">    p.close()</span><br><span class="line">    <span class="comment"># join()方法会等待所有子进程执行完毕；</span></span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">'All subprocesses done.'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="subprocess子进程模块"><a href="#subprocess子进程模块" class="headerlink" title="subprocess子进程模块"></a>subprocess子进程模块</h5><blockquote>
<p>subprocess模块用来创建子进程；</p>
</blockquote>
<p>subprocess模块允许创建一个新的进程来执行另外的程序，可以与进程进行通信，获取标准的输入、标准输出、标准错误以及返回码等。</p>
<h6 id="subprocess模块常用函数"><a href="#subprocess模块常用函数" class="headerlink" title="subprocess模块常用函数"></a>subprocess模块常用函数</h6><ul>
<li>常用函数表：</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">run()</td>
<td style="text-align:center">Python 3.5中新增的函数。执行指定的命令，等待命令执行完成后返回一个包含执行结果的CompletedProcess类的实例。</td>
</tr>
<tr>
<td style="text-align:center">call()</td>
<td style="text-align:center">执行指定的命令，返回命令执行状态，其功能类似于os.system(cmd)。</td>
</tr>
<tr>
<td style="text-align:center">check_call()</td>
<td style="text-align:center">Python 2.5中新增的函数。 执行指定的命令，如果执行成功则返回状态码，否则抛出异常。其功能等价于subprocess.run(…, check=True)。</td>
</tr>
<tr>
<td style="text-align:center">check_output()</td>
<td style="text-align:center">Python 2.7中新增的的函数。执行指定的命令，如果执行状态码为0则返回命令执行结果，否则抛出异常。</td>
</tr>
<tr>
<td style="text-align:center">getoutput(cmd)</td>
<td style="text-align:center">接收字符串格式的命令，执行命令并返回执行结果，其功能类似于os.popen(cmd).read()和commands.getoutput(cmd)。</td>
</tr>
<tr>
<td style="text-align:center">getstatusoutput(cmd)</td>
<td style="text-align:center">执行cmd命令，返回一个元组(命令执行状态, 命令执行结果输出)，其功能类似于commands.getstatusoutput()。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><span style="color:red">表中常用函数都是基于subprocess.Popen类实现的。</span></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">【说明】</span><br><span class="line">1. 在Python 3.5之后的版本中，官方文档中提倡通过subprocess.run()函数替代其他函数来使用subproccess模块的功能；</span><br><span class="line">2. 在Python 3.5之前的版本中，我们可以通过subprocess.call()，subprocess.getoutput()等上面列出的其他函数来使用subprocess模块的功能；</span><br><span class="line">3. subprocess.run()、subprocess.call()、subprocess.check_call()和subprocess.check_output()都是通过对subprocess.Popen的封装来实现的高级函数，因此如果我们需要更复杂功能时，可以通过subprocess.Popen来完成。</span><br><span class="line">4. subprocess.getoutput()和subprocess.getstatusoutput()函数是来自Python 2.x的commands模块的两个遗留函数。它们隐式的调用系统shell，并且不保证其他函数所具有的安全性和异常处理的一致性。另外，它们从Python 3.3.4开始才支持Windows平台。</span><br></pre></td></tr></table></figure>
<ul>
<li>常用函数的定义：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subprocess.call(*popenargs, *, stdin=<span class="keyword">None</span>, stdout=<span class="keyword">None</span>, stderr=<span class="keyword">None</span>, shell=<span class="keyword">False</span>, timeout=<span class="keyword">None</span>)</span><br><span class="line">subprocess.run(*popenargs,input=<span class="keyword">None</span>, capture_output=<span class="keyword">False</span>, timeout=<span class="keyword">None</span>, check=<span class="keyword">False</span>, **kwargs)</span><br><span class="line">//...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">【参数说明】</span><br><span class="line">- args：要执行的shell命令，默认应该是一个字符串序列，如[&apos;df&apos;, &apos;-Th&apos;]或(&apos;df&apos;, &apos;-Th&apos;)，也可以是一个字符串，如&apos;df -Th&apos;，但是此时需要把shell参数的值置为True。</span><br><span class="line">- shell： 如果shell为True，那么指定的命令将通过shell执行。如果我们需要访问某些shell的特性，如管道、文件名通配符、环境变量扩展功能，这将是非常有用的。当然，python本身也提供了许多类似shell的特性的实现，如glob、fnmatch、os.walk()、os.path.expandvars()、os.expanduser()和shutil等。</span><br><span class="line">- check： 如果check参数的值是True，且执行命令的进程以非0状态码退出，则会抛出一个CalledProcessError的异常，且该异常对象会包含 参数、退出状态码、以及stdout和stderr(如果它们有被捕获的话)。</span><br><span class="line">- stdout, stderr：run()函数默认不会捕获命令执行结果的正常输出和错误输出，如果我们向获取这些内容需要传递subprocess.PIPE，然后可以通过返回的CompletedProcess类实例的stdout和stderr属性或捕获相应的内容；</span><br><span class="line">call()和check_call()函数返回的是命令执行的状态码，而不是CompletedProcess类实例，所以对于它们而言，stdout和stderr不适合赋值为subprocess.PIPE；</span><br><span class="line">- check_output()函数默认就会返回命令执行结果，所以不用设置stdout的值，如果我们希望在结果中捕获错误信息，可以执行stderr=subprocess.STDOUT。</span><br><span class="line">- input：该参数是传递给Popen.communicate()，通常该参数的值必须是一个字节序列，如果universal_newlines=True，则其值应该是一个字符串。</span><br><span class="line">universal_newlines：该参数影响的是输入与输出的数据格式，比如它的值默认为False，此时stdout和stderr的输出是字节序列；当该参数的值设置为True时，stdout和stderr的输出是字符串。</span><br></pre></td></tr></table></figure>
<ul>
<li>示例：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行指定的命令，返回命令执行状态，其功能类似于os.system(cmd)。</span></span><br><span class="line">r = subprocess.call([<span class="string">'nslookup'</span>, <span class="string">'www.python.org'</span>])</span><br><span class="line">print(<span class="string">'result:'</span>, r)</span><br></pre></td></tr></table></figure>
<h6 id="subproces-Popen"><a href="#subproces-Popen" class="headerlink" title="subproces.Popen()"></a>subproces.Popen()</h6><blockquote>
<p>如果我们需要更复杂功能时，并且要与进程进行复杂的交互，可以利用Popen类来实现；</p>
</blockquote>
<p>1&gt; 构造函数概述：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构造函数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">subprocess</span>.<span class="title">Popen</span><span class="params">(args, bufsize=<span class="number">-1</span>, executable=None, stdin=None, stdout=None, stderr=None, </span></span></span><br><span class="line"><span class="class"><span class="params">    preexec_fn=None, close_fds=True, shell=False, cwd=None, env=None, universal_newlines=False,</span></span></span><br><span class="line"><span class="class"><span class="params">    startup_info=None, creationflags=<span class="number">0</span>, restore_signals=True, start_new_session=False, pass_fds=<span class="params">()</span>)</span></span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class"># 参数说明</span></span><br><span class="line"><span class="class">&gt; <span class="title">args</span>：要执行的<span class="title">shell</span>命令，可以是字符串，也可以是命令各个参数组成的序列。当该参数的值是一个字符串时，该命令的解释过程是与平台相关的，因此通常建议将<span class="title">args</span>参数作为一个序列传递。</span></span><br><span class="line"><span class="class">&gt; <span class="title">bufsize</span>：指定缓存策略，0表示不缓冲，1表示行缓冲，其他大于1的数字表示缓冲区大小，负数 表示使用系统默认缓冲策略。</span></span><br><span class="line">&gt; stdin, stdout, stderr：分别表示程序标准输入、输出、错误句柄。</span><br><span class="line">&gt; preexec_fn：用于指定一个将在子进程运行之前被调用的可执行对象，只在Unix平台下有效。</span><br><span class="line">&gt; close_fds：如果该参数的值为<span class="keyword">True</span>，则除了<span class="number">0</span>,<span class="number">1</span>和<span class="number">2</span>之外的所有文件描述符都将会在子进程执行之前被关闭。</span><br><span class="line">&gt; shell：该参数用于标识是否使用shell作为要执行的程序，如果shell值为<span class="keyword">True</span>，则建议将args参数作为一个字符串传递而不要作为一个序列传递。</span><br><span class="line">&gt; cwd：如果该参数值不是<span class="keyword">None</span>，则该函数将会在执行这个子进程之前改变当前工作目录。</span><br><span class="line">&gt; env：用于指定子进程的环境变量，如果env=<span class="keyword">None</span>，那么子进程的环境变量将从父进程中继承。如果env!=<span class="keyword">None</span>，它的值必须是一个映射对象。</span><br><span class="line">&gt; universal_newlines：如果该参数值为<span class="keyword">True</span>，则该文件对象的stdin，stdout和stderr将会作为文本流被打开，否则他们将会被作为二进制流被打开。</span><br><span class="line">&gt; startupinfo和creationflags： 这两个参数只在Windows下有效，它们将被传递给底层的CreateProcess()函数，用于设置子进程的一些属性，如主窗口的外观，进程优先级等。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：如果希望通过进程的stdin向其发送数据，在创建Popen对象的时候，参数stdin必须被设置为PIPE。同样，如果希望从stdout和stderr获取数据，必须将stdout和stderr设置为PIPE。</p>
</blockquote>
<p>2&gt; Popen实例方法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">poll()</td>
<td style="text-align:left">用于检查子进程（命令）是否已经执行结束，没结束返回None，结束后返回状态码。</td>
</tr>
<tr>
<td style="text-align:left">wait(timeout=None)</td>
<td style="text-align:left">等待子进程结束，并返回状态码；如果在timeout指定的秒数之后进程还没有结束，将会抛出一个TimeoutExpired异常。</td>
</tr>
<tr>
<td style="text-align:left">communicate()</td>
<td style="text-align:left">和子进程交互(发送数据到stdin，并从stdout和stderr读数据，直到收到EOF,要给子进程的stdin发送数据，则Popen时要设置stdin要为PIPE)。等待子进程结束。</td>
</tr>
<tr>
<td style="text-align:left">send_signal(signal)</td>
<td style="text-align:left">发送指定的信号给这个子进程。</td>
</tr>
<tr>
<td style="text-align:left">terminate()</td>
<td style="text-align:left">停止该子进程。</td>
</tr>
<tr>
<td style="text-align:left">kill()</td>
<td style="text-align:left">杀死该子进程。</td>
</tr>
</tbody>
</table>
</div>
<p>3&gt; Popen实例属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; p.pid:  子进程的PID。</span><br><span class="line">&gt; p.returncode: 该属性表示子进程的返回状态，returncode可能有多重情况(</span><br><span class="line">    None 子进程尚未结束,</span><br><span class="line">    ==0 子进程正常退出；</span><br><span class="line">    &gt; 0 子进程异常退出，</span><br><span class="line">    returncode对应于出错码；</span><br><span class="line">    &lt; 0—— 子进程被信号杀掉了。</span><br><span class="line">)</span><br><span class="line">&gt; p.stdin, p.stdout, p.stderr: 子进程对应的一些初始文件，如果调用Popen()的时候对应的参数是subprocess.PIPE，则这里对应的属性是一个包裹了这个管道的 file 对象;</span><br></pre></td></tr></table></figure>
<p>4&gt; 示例：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">'adb devices'</span>  <span class="comment"># 获取连接设备</span></span><br><span class="line">p = subprocess.Popen(cmd, shell=<span class="keyword">True</span>, stdout=subprocess.PIPE)</span><br><span class="line">print(str(p.stdout.read(), encoding=<span class="string">'utf-8'</span>))  <span class="comment"># 打印结果</span></span><br><span class="line"><span class="comment"># 阻塞子进程，直到子进程结束。</span></span><br><span class="line">p.communicate()</span><br><span class="line">print(<span class="string">"end"</span>)</span><br></pre></td></tr></table></figure>
<h5 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h5><blockquote>
<p>Process之间肯定是需要通信的，操作系统提供了很多机制来实现进程间的通信。Python的multiprocessing模块包装了底层的机制，提供了Queue、Pipes等多种方式来交换数据。</p>
</blockquote>
<p>父进程所有Python对象都必须通过pickle序列化再传到子进程去，所有，如果multiprocessing在Windows下调用失败了，要先考虑是不是pickle失败了。</p>
<h6 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h6><blockquote>
<p>在python中，多个线程之间的数据是共享的，多个线程进行数据交换的时候，不能够保证数据的安全性和一致性，所以当多个线程需要进行数据交换的时候，队列就出现了，队列可以完美解决线程间的数据交换，保证线程间数据的安全性和一致性。</p>
</blockquote>
<p><span style="color:red">三种队列:</span></p>
<ul>
<li>Python queue模块的FIFO队列先进先出。 class queue.Queue(maxsize)</li>
<li>LIFO类似于堆，即先进后出。 class queue.LifoQueue(maxsize)</li>
<li>还有一种是优先级队列级别越低越先出来。 class queue.PriorityQueue(maxsize)</li>
</ul>
<p><span style="color:red">常用方法:</span></p>
<ul>
<li>queue.qsize() 返回队列的大小</li>
<li>queue.empty() 如果队列为空，返回True,反之False</li>
<li>queue.full() 如果队列满了，返回True,反之False</li>
<li>queue.full 与 maxsize 大小对应</li>
<li>queue.get([block[, timeout]])获取队列，timeout等待时间（从队列中移除并返回一个数据，通知q可以继续添加数据）</li>
<li>queue.get_nowait() 相当queue.get(False)</li>
<li>queue.put(item) 写入队列，timeout等待时间（默认的情况，阻塞调用，等待q.get移除数据后继续执行）</li>
<li>queue.put_nowait(item) 相当queue.put(item, False)</li>
<li>queue.task_done() 在完成一项工作之后，queue.task_done()函数向任务已经完成的队列发送一个信号</li>
<li>queue.join() 实际上意味着等到队列为空，再执行别的操作</li>
</ul>
<p><span style="color:red">示例:</span><br>在父进程中创建两个子进程，一个往Queue里写数据，一个从Queue里读数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写数据进程执行的代码:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">'Process to write: %s'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]:</span><br><span class="line">        print(<span class="string">'Put %s to queue...'</span> % value)</span><br><span class="line">        <span class="comment"># 默认的情况，阻塞调用，等待q.get移除数据后继续执行；</span></span><br><span class="line">        q.put(value)</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读数据进程执行的代码:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">'Process to read: %s'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="comment"># 从队列中移除并返回一个数据，通知q可以继续添加数据</span></span><br><span class="line">        value = q.get(<span class="keyword">True</span>)</span><br><span class="line">        print(<span class="string">'Get %s from queue.'</span> % value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 父进程创建Queue，并传给各个子进程：</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    pw = Process(target=write, args=(q,))</span><br><span class="line">    pr = Process(target=read, args=(q,))</span><br><span class="line">    <span class="comment"># 启动子进程pw，写入:</span></span><br><span class="line">    pw.start()</span><br><span class="line">    <span class="comment"># 启动子进程pr，读取:</span></span><br><span class="line">    pr.start()</span><br><span class="line">    <span class="comment"># 等待pw结束:</span></span><br><span class="line">    pw.join()</span><br><span class="line">    <span class="comment"># pr进程里是死循环，无法等待其结束，只能在pw结束时强行终止:</span></span><br><span class="line">    pr.terminate()</span><br></pre></td></tr></table></figure>
<h5 id="多进程的优缺点"><a href="#多进程的优缺点" class="headerlink" title="多进程的优缺点"></a>多进程的优缺点</h5><h6 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h6><ul>
<li>多进程模式最大的优点就是稳定性高，因为一个子进程崩溃了，不会影响主进程和其他子进程。</li>
</ul>
<h6 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h6><ul>
<li>多进程模式的缺点是创建进程的代价大，在Unix/Linux系统下，用fork调用还行，在Windows下创建进程开销巨大。另外，操作系统能同时运行的进程数也是有限的，在内存和CPU的限制下，如果有几千个进程同时运行，操作系统连调度都会成问题。</li>
</ul>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><h4 id="threading模块"><a href="#threading模块" class="headerlink" title="threading模块"></a>threading模块</h4><p>Python的标准库提供了两个模块：_thread和threading，_thread是低级模块，threading是高级模块，对_thread进行了封装。绝大多数情况下，我们只需要使用threading这个高级模块。</p>
<h5 id="线程概念"><a href="#线程概念" class="headerlink" title="线程概念"></a>线程概念</h5><ul>
<li>由于任何进程默认就会启动一个线程，我们把该线程称为主线程,主线程又可以启动新的线程;</li>
<li>Python的threading模块有个current_thread()函数，它永远返回当前线程的实例。</li>
<li>主线程实例的名字叫MainThread，子线程的名字在创建时指定，如果不起名字Python就自动给线程命名为Thread-1，Thread-2等。</li>
</ul>
<h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><ul>
<li>多线程模式通常比多进程快一点，但是也快不到哪去，而且，多线程模式致命的缺点就是任何一个线程挂掉都可能直接造成整个进程崩溃，因为所有线程共享进程的内存。</li>
</ul>
<h5 id="创建线程实例"><a href="#创建线程实例" class="headerlink" title="创建线程实例"></a>创建线程实例</h5><p>启动一个线程：创建Thread实例，需要传入一个处理函数传入，然后调用start()开始执行；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新线程执行的代码:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'thread %s is running...'</span> % threading.current_thread().name)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">        print(<span class="string">'thread %s &gt;&gt;&gt; %s'</span> % (threading.current_thread().name, n))</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'thread %s ended.'</span> % threading.current_thread().name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">'thread %s is running...'</span> % threading.current_thread().name)</span><br><span class="line">t = threading.Thread(target=loop, name=<span class="string">'LoopThread'</span>)</span><br><span class="line">t.start()</span><br><span class="line">t.join()</span><br><span class="line">print(<span class="string">'thread %s ended.'</span> % threading.current_thread().name)</span><br></pre></td></tr></table></figure>
<h4 id="Lock-锁"><a href="#Lock-锁" class="headerlink" title="Lock(锁)"></a>Lock(锁)</h4><p>锁用来解决多个线程间数据共享导致的数据修改错误；</p>
<h5 id="数据共享问题"><a href="#数据共享问题" class="headerlink" title="数据共享问题"></a>数据共享问题</h5><ul>
<li>多进程中，同一个变量，互不影响；</li>
<li>多线程中，所有变量都由所有线程共享，所以，任何一个变量都可以被任何一个线程修改，因此，线程之间共享数据最大的危险在于多个线程同时改一个变量，把内容给改乱了。</li>
</ul>
<h5 id="使用锁"><a href="#使用锁" class="headerlink" title="使用锁"></a>使用锁</h5><blockquote>
<p>多线程编程，模型复杂，容易发生冲突，必须用锁加以隔离，同时，又要小心死锁的发生。</p>
</blockquote>
<ul>
<li>多个线程同时执行lock.acquire()时，只有一个线程能成功地获取锁，然后继续执行代码，其他线程就继续等待直到获得锁为止。</li>
<li>获得锁的线程用完后一定要释放锁，否则那些苦苦等待锁的线程将永远等待下去，成为死线程。所以我们用try…finally来确保锁一定会被释放。</li>
<li>锁的好处就是确保了某段关键代码只能由一个线程从头到尾完整地执行，坏处当然也很多，首先是阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下降了。其次，由于可以存在多个锁，不同的线程持有不同的锁，并试图获取对方持有的锁时，可能会造成死锁，导致多个线程全部挂起，既不能执行，也无法结束，只能靠操作系统强制终止。</li>
</ul>
<h5 id="示例-19"><a href="#示例-19" class="headerlink" title="示例"></a>示例</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假定这是你的银行存款:</span></span><br><span class="line">balance = <span class="number">0</span></span><br><span class="line"><span class="comment"># 创建一个锁</span></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_it</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="comment"># 先存后取，结果应该为0:</span></span><br><span class="line">    <span class="keyword">global</span> balance</span><br><span class="line">    balance = balance + n</span><br><span class="line">    balance = balance - n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_thread</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>):</span><br><span class="line">        <span class="comment"># 先要获取锁,给change_it()上一把锁,其它线程不能访问该方法</span></span><br><span class="line">        lock.acquire()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            change_it(n)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            lock.release()</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=run_thread, args=(<span class="number">5</span>,))</span><br><span class="line">t2 = threading.Thread(target=run_thread, args=(<span class="number">8</span>,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br><span class="line">print(balance)</span><br><span class="line"><span class="comment"># result: 0</span></span><br></pre></td></tr></table></figure>
<h4 id="GIL全局锁"><a href="#GIL全局锁" class="headerlink" title="GIL全局锁"></a>GIL全局锁</h4><p>1.现象描述？</p>
<p>理论上来看一个死循环线程会100%占用一个CPU，用C、C++或Java在n个线程中写相同的死循环，直接可以把n核心跑满，4核就跑到400%，8核就跑到800%，但是Python不会占满n核CPU；</p>
<p>2.python的GIL锁；</p>
<p>Python的线程虽然是真正的线程，但解释器执行代码时，有一个GIL锁：Global Interpreter Lock，任何Python线程执行前，必须先获得GIL锁，然后，每执行100条字节码，解释器就自动释放GIL锁，让别的线程有机会执行。这个GIL全局锁实际上把所有线程的执行代码都给上了锁，所以，多线程在Python中只能交替执行，即使100个线程跑在100核CPU上，也只能用到1个核。</p>
<p>3.利用多核CPU:</p>
<ul>
<li>通常我们用的解释器是官方实现的CPython，要真正利用多核，除非重写一个不带GIL的解释器。</li>
<li>在Python中，可以使用多线程，但不要指望能有效利用多核。</li>
<li>如果一定要通过多线程利用多核，那只能通过C扩展来实现，不过这样就失去了Python简单易用的特点。</li>
</ul>
<blockquote>
<p>Python虽然不能利用多线程实现多核任务，但可以通过多进程实现多核任务。多个Python进程有各自独立的GIL锁，互不影响。</p>
</blockquote>
<h4 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h4><blockquote>
<p>ThreadLocal解决了参数在一个线程中各个函数之间互相传递的问题。</p>
</blockquote>
<p>在多线程环境下，每个线程都有自己的数据。一个线程使用自己的局部变量比使用全局变量好，因为局部变量只有线程自己能看见，不会影响其他线程，而全局变量的修改必须加锁,但是局部变量也有问题，就是在函数调用的时候，传递起来很麻烦，<span style="color:red">ThreadLocal类型的全局变量，可以绑定其他变量，并且可以在多个线程中使用它，可以任意读写而互不干扰，也不用管理锁的问题，ThreadLocal内部会处理。</span></p>
<ul>
<li>一个ThreadLocal变量虽然是全局变量，但每个线程都只能读写自己线程的独立副本，互不干扰。</li>
<li>ThreadLocal最常用的地方就是为每个线程绑定一个数据库连接，HTTP请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源。</li>
</ul>
<h5 id="示例-20"><a href="#示例-20" class="headerlink" title="示例"></a>示例</h5><ol>
<li>创建ThreadLocal全局变量，通过绑定其它变量可以在多个线程中互不影响的特性，解决参数在一个线程中各个函数之间互相传递的问题；</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建全局ThreadLocal对象:</span></span><br><span class="line">local_school = threading.local()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_student</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 获取当前线程关联的student:</span></span><br><span class="line">    std = local_school.student</span><br><span class="line">    print(<span class="string">'Hello, %s (in %s)'</span> % (std, threading.current_thread().name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_thread</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="comment"># 绑定ThreadLocal的student:</span></span><br><span class="line">    local_school.student = name</span><br><span class="line">    process_student()</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target= process_thread, args=(<span class="string">'Alice'</span>,), name=<span class="string">'Thread-A'</span>)</span><br><span class="line">t2 = threading.Thread(target= process_thread, args=(<span class="string">'Bob'</span>,), name=<span class="string">'Thread-B'</span>)</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br></pre></td></tr></table></figure>
<h3 id="分布式进程"><a href="#分布式进程" class="headerlink" title="分布式进程"></a>分布式进程</h3><blockquote>
<p>在Thread和Process中，应当优选Process，因为Process更稳定，而且，Process可以分布到多台机器上，而Thread最多只能分布到同一台机器的多个CPU上。</p>
</blockquote>
<p>Python的multiprocessing模块不但支持多进程，其中managers子模块还支持把多进程分布到多台机器上。一个服务进程可以作为调度者，将任务分布到其他多个进程中，依靠网络通信。由于managers模块封装很好，不必了解网络通信的细节，就可以很容易地编写<span style="color:red">分布式多进程程序</span>。Python的分布式进程接口简单，封装良好，适合需要把繁重任务分布到多台机器的环境下。</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><blockquote>
<p>需要在linux/mac系统下，windows无法正常运行；</p>
</blockquote>
<p>如果我们已经有一个通过Queue通信的多进程程序在同一台机器上运行，现在，由于处理任务的进程任务繁重，希望把发送任务的进程和处理任务的进程分布到两台机器上。怎么用分布式进程实现？</p>
<p>原有的Queue可以继续使用，但是，通过managers模块把Queue通过网络暴露出去，就可以让其他机器的进程访问Queue了。</p>
<ol>
<li>我们先看服务进程，服务进程负责启动Queue，把Queue注册到网络上，然后往Queue里面写入任务：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># task_master.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random, time, queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing.managers <span class="keyword">import</span> BaseManager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送任务的队列:</span></span><br><span class="line">task_queue = queue.Queue()</span><br><span class="line"><span class="comment"># 接收结果的队列:</span></span><br><span class="line">result_queue = queue.Queue()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从BaseManager继承的QueueManager:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueManager</span><span class="params">(BaseManager)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把两个Queue都注册到网络上, callable参数关联了Queue对象:</span></span><br><span class="line">QueueManager.register(<span class="string">'get_task_queue'</span>, callable=<span class="keyword">lambda</span>: task_queue)</span><br><span class="line">QueueManager.register(<span class="string">'get_result_queue'</span>, callable=<span class="keyword">lambda</span>: result_queue)</span><br><span class="line"><span class="comment"># 绑定端口5000, 设置验证码'abc':</span></span><br><span class="line">manager = QueueManager(address=(<span class="string">''</span>, <span class="number">5000</span>), authkey=<span class="string">b'abc'</span>)</span><br><span class="line"><span class="comment"># 启动Queue:</span></span><br><span class="line">manager.start()</span><br><span class="line"><span class="comment"># 获得通过网络访问的Queue对象:</span></span><br><span class="line">task = manager.get_task_queue()</span><br><span class="line">result = manager.get_result_queue()</span><br><span class="line"><span class="comment"># 放几个任务进去:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    n = random.randint(<span class="number">0</span>, <span class="number">10000</span>)</span><br><span class="line">    print(<span class="string">'Put task %d...'</span> % n)</span><br><span class="line">    task.put(n)</span><br><span class="line"><span class="comment"># 从result队列读取结果:</span></span><br><span class="line">print(<span class="string">'Try get results...'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    r = result.get(timeout=<span class="number">10</span>)</span><br><span class="line">    print(<span class="string">'Result: %s'</span> % r)</span><br><span class="line"><span class="comment"># 关闭:</span></span><br><span class="line">manager.shutdown()</span><br><span class="line">print(<span class="string">'master exit.'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请注意，当我们在一台机器上写多进程程序时，创建的Queue可以直接拿来用，但是，在分布式多进程环境下，添加任务到Queue不可以直接对原始的task_queue进行操作，那样就绕过了QueueManager的封装，必须通过manager.get_task_queue()获得的Queue接口添加。</span><br></pre></td></tr></table></figure>
<ol>
<li>然后，在另一台机器上启动任务进程（本机上启动也可以）：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># task_worker.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time, sys, queue</span><br><span class="line"><span class="keyword">from</span> multiprocessing.managers <span class="keyword">import</span> BaseManager</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建类似的QueueManager:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueueManager</span><span class="params">(BaseManager)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于这个QueueManager只从网络上获取Queue，所以注册时只提供名字:</span></span><br><span class="line">QueueManager.register(<span class="string">'get_task_queue'</span>)</span><br><span class="line">QueueManager.register(<span class="string">'get_result_queue'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到服务器，也就是运行task_master.py的机器:</span></span><br><span class="line">server_addr = <span class="string">'127.0.0.1'</span></span><br><span class="line">print(<span class="string">'Connect to server %s...'</span> % server_addr)</span><br><span class="line"><span class="comment"># 端口和验证码注意保持与task_master.py设置的完全一致:</span></span><br><span class="line">m = QueueManager(address=(server_addr, <span class="number">5000</span>), authkey=<span class="string">b'abc'</span>)</span><br><span class="line"><span class="comment"># 从网络连接:</span></span><br><span class="line">m.connect()</span><br><span class="line"><span class="comment"># 获取Queue的对象:</span></span><br><span class="line">task = m.get_task_queue()</span><br><span class="line">result = m.get_result_queue()</span><br><span class="line"><span class="comment"># 从task队列取任务,并把结果写入result队列:</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        n = task.get(timeout=<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">'run task %d * %d...'</span> % (n, n))</span><br><span class="line">        r = <span class="string">'%d * %d = %d'</span> % (n, n, n*n)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        result.put(r)</span><br><span class="line">    <span class="keyword">except</span> Queue.Empty:</span><br><span class="line">        print(<span class="string">'task queue is empty.'</span>)</span><br><span class="line"><span class="comment"># 处理结束:</span></span><br><span class="line">print(<span class="string">'worker exit.'</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>运行</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">先启动task_master.py服务进程：</span><br><span class="line">$ python3 task_master.py </span><br><span class="line">Put task 3411...</span><br><span class="line">Put task 1605...</span><br><span class="line">Put task 1398...</span><br><span class="line">Put task 4729...</span><br><span class="line">Put task 5300...</span><br><span class="line">Put task 7471...</span><br><span class="line">Put task 68...</span><br><span class="line">Put task 4219...</span><br><span class="line">Put task 339...</span><br><span class="line">Put task 7866...</span><br><span class="line">Try get results...</span><br><span class="line"></span><br><span class="line">task_master.py进程发送完任务后，开始等待result队列的结果。现在启动task_worker.py进程：</span><br><span class="line">$ python3 task_worker.py</span><br><span class="line">Connect to server 127.0.0.1...</span><br><span class="line">run task 3411 * 3411...</span><br><span class="line">run task 1605 * 1605...</span><br><span class="line">run task 1398 * 1398...</span><br><span class="line">run task 4729 * 4729...</span><br><span class="line">run task 5300 * 5300...</span><br><span class="line">run task 7471 * 7471...</span><br><span class="line">run task 68 * 68...</span><br><span class="line">run task 4219 * 4219...</span><br><span class="line">run task 339 * 339...</span><br><span class="line">run task 7866 * 7866...</span><br><span class="line">worker exit.</span><br><span class="line"></span><br><span class="line">task_worker.py进程结束，在task_master.py进程中会继续打印出结果：</span><br><span class="line">Result: 3411 * 3411 = 11634921</span><br><span class="line">Result: 1605 * 1605 = 2576025</span><br><span class="line">Result: 1398 * 1398 = 1954404</span><br><span class="line">Result: 4729 * 4729 = 22363441</span><br><span class="line">Result: 5300 * 5300 = 28090000</span><br><span class="line">Result: 7471 * 7471 = 55815841</span><br><span class="line">Result: 68 * 68 = 4624</span><br><span class="line">Result: 4219 * 4219 = 17799961</span><br><span class="line">Result: 339 * 339 = 114921</span><br><span class="line">Result: 7866 * 7866 = 61873956</span><br></pre></td></tr></table></figure>
<h3 id="常用内建模块"><a href="#常用内建模块" class="headerlink" title="常用内建模块"></a>常用内建模块</h3><h4 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h4><p>datetime是Python处理日期和时间的标准库，主要使用datetime模块中的datatime类来获取时间。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入datetime类</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br></pre></td></tr></table></figure>
<h5 id="本地时间"><a href="#本地时间" class="headerlink" title="本地时间"></a>本地时间</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前datetime</span></span><br><span class="line">now = datetime.now()</span><br><span class="line">print(type(now)) <span class="comment"># 2018-11-07 16:12:09.036856</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用指定日期时间创建datetime</span></span><br><span class="line">dt = datetime(<span class="number">2015</span>, <span class="number">4</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>) </span><br><span class="line">print(dt) <span class="comment"># 2015-04-19 12:20:00</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取单位时间</span></span><br><span class="line"><span class="comment"># 年</span></span><br><span class="line">print(datetime.now().year)</span><br><span class="line"><span class="comment"># 月</span></span><br><span class="line">print(datetime.now().month)</span><br><span class="line"><span class="comment"># 日</span></span><br><span class="line">print(datetime.now().day)</span><br><span class="line"><span class="comment"># 时</span></span><br><span class="line">print(datetime.now().hour)</span><br><span class="line"><span class="comment"># 分</span></span><br><span class="line">print(datetime.now().minute)</span><br><span class="line"><span class="comment"># 秒</span></span><br><span class="line">print(datetime.now().second)</span><br></pre></td></tr></table></figure>
<h5 id="时间加减法"><a href="#时间加减法" class="headerlink" title="时间加减法"></a>时间加减法</h5><p>timedelta对象表示一个时间长度，用来计算两个日期或者时间的差值；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from datetime import datetime, timedelta</span><br><span class="line"></span><br><span class="line">now = datetime.now()</span><br><span class="line"># 当前时间减2小时</span><br><span class="line">print(now + timedelta(hours=2))</span><br><span class="line"># 当前时间加2天2小时</span><br><span class="line">print(now - timedelta(days=2, hours=2))</span><br></pre></td></tr></table></figure>
<h5 id="时区时间"><a href="#时区时间" class="headerlink" title="时区时间"></a>时区时间</h5><blockquote>
<p>UTC时间是格林威治标准时间，比北京时间早了8小时。</p>
</blockquote>
<h6 id="创建时区时间"><a href="#创建时区时间" class="headerlink" title="创建时区时间"></a>创建时区时间</h6><ul>
<li>本地时间是指系统设定时区的时间，例如北京时间是UTC+8:00时区的时间，而UTC时间指UTC+0:00时区的时间。</li>
<li>datetime类型有一个时区属性tzinfo，但是默认为None，所以无法区分这个datetime到底是哪个时区，除非强行给datetime设置一个时区;</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个标准UTC时间</span></span><br><span class="line">print(datetime.utcnow())</span><br><span class="line"><span class="comment"># 获取UTC时间，并强制设置时区为UTC+0:00:</span></span><br><span class="line">utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">print(utc_dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接获取一个标准UTC+0:00时间</span></span><br><span class="line">print(datetime.now(tz=timezone.utc))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建时区UTC+8:00 北京时间</span></span><br><span class="line">tz_utc_8 = timezone(timedelta(hours=<span class="number">8</span>))</span><br><span class="line"><span class="comment"># 强制设置为UTC+8:00</span></span><br><span class="line">print(datetime.now().replace(tzinfo=tz_utc_8))</span><br></pre></td></tr></table></figure>
<h6 id="时区转换"><a href="#时区转换" class="headerlink" title="时区转换"></a>时区转换</h6><p>可以先通过utcnow()拿到当前的UTC时间，再通过astimezone根据时间差转换为任意时区的时间；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拿到UTC时间，并强制设置时区为UTC+0:00:</span></span><br><span class="line">utc_dt = datetime.utcnow().replace(tzinfo=timezone.utc)</span><br><span class="line">print(utc_dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># astimezone()将转换时区为北京时间:</span></span><br><span class="line">bj_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">8</span>)))</span><br><span class="line">print(bj_dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># astimezone()将转换时区为东京时间:</span></span><br><span class="line">tokyo_dt = utc_dt.astimezone(timezone(timedelta(hours=<span class="number">9</span>)))</span><br><span class="line">print(tokyo_dt)</span><br></pre></td></tr></table></figure>
<h5 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h5><blockquote>
<p>Python的timestamp是一个浮点数。如果有小数位，小数位表示毫秒数。</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime转timestamp</span></span><br><span class="line">print(datetime.now().timestamp())</span><br><span class="line"></span><br><span class="line"><span class="comment"># timestamp转datetime</span></span><br><span class="line">t = datetime.now().timestamp()</span><br><span class="line">print(datetime.fromtimestamp(t))</span><br><span class="line"></span><br><span class="line"><span class="comment"># timestamp转UTC时间</span></span><br><span class="line">print(datetime.utcfromtimestamp(t))</span><br></pre></td></tr></table></figure>
<h5 id="时间格式化"><a href="#时间格式化" class="headerlink" title="时间格式化"></a>时间格式化</h5><p>Python time strftime() 函数接收以时间元组，并返回以可读字符串表示的当地时间，格式由参数format决定。</p>
<h6 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">time.strftime(format[, t])</span><br><span class="line">【参数】</span><br><span class="line">format -- 格式字符串。</span><br><span class="line">t -- 可选的参数t是一个struct_time对象。</span><br></pre></td></tr></table></figure>
<h6 id="时间日期格式化符号"><a href="#时间日期格式化符号" class="headerlink" title="时间日期格式化符号"></a>时间日期格式化符号</h6><p>python中时间日期格式化符号：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">%y 两位数的年份表示（00-99）</span><br><span class="line">%Y 四位数的年份表示（000-9999）</span><br><span class="line">%m 月份（01-12）</span><br><span class="line">%d 月内中的一天（0-31）</span><br><span class="line">%H 24小时制小时数（0-23）</span><br><span class="line">%I 12小时制小时数（01-12）</span><br><span class="line">%M 分钟数（00=59）</span><br><span class="line">%S 秒（00-59）</span><br><span class="line">%a 本地简化星期名称</span><br><span class="line">%A 本地完整星期名称</span><br><span class="line">%b 本地简化的月份名称</span><br><span class="line">%B 本地完整的月份名称</span><br><span class="line">%c 本地相应的日期表示和时间表示</span><br><span class="line">%j 年内的一天（001-366）</span><br><span class="line">%p 本地A.M.或P.M.的等价符</span><br><span class="line">%U 一年中的星期数（00-53）星期天为星期的开始</span><br><span class="line">%w 星期（0-6），星期天为星期的开始</span><br><span class="line">%W 一年中的星期数（00-53）星期一为星期的开始</span><br><span class="line">%x 本地相应的日期表示</span><br><span class="line">%X 本地相应的时间表示</span><br><span class="line">%Z 当前时区的名称</span><br><span class="line">%% %号本身</span><br></pre></td></tr></table></figure>
<h6 id="示例-21"><a href="#示例-21" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime转换为str(格式化时间)</span></span><br><span class="line">print(datetime.now().strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="collections"><a href="#collections" class="headerlink" title="collections"></a>collections</h4><p>collections是Python内建的一个集合模块，提供了许多有用的集合类。</p>
<h5 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h5><blockquote>
<p><span style="color:red">利用元组创建对象</span>； </p>
</blockquote>
<p>namedtuple是一个函数，它用来创建一个自定义的tuple对象，并且规定了tuple元素的个数，并可以用属性而不是索引来引用tuple的某个元素。</p>
<h6 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">namedtuple(&apos;名称&apos;, [属性list]):</span><br></pre></td></tr></table></figure>
<h6 id="示例-22"><a href="#示例-22" class="headerlink" title="示例"></a>示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例1：定义一个点对象，拥有两个坐标点</span></span><br><span class="line">Point = namedtuple(<span class="string">'Point'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>])</span><br><span class="line">p = Point(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">print(p.x, p.y)</span><br><span class="line"></span><br><span class="line">print(isinstance(p, Point))</span><br><span class="line">print(isinstance(p, tuple))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例2：用坐标和半径表示一个圆</span></span><br><span class="line">Circle = namedtuple(<span class="string">'Circle'</span>, [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'r'</span>])</span><br></pre></td></tr></table></figure>
<h5 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h5><blockquote>
<p><span style="color:red">加强版list</span>； </p>
<p>使用list存储数据时，按索引访问元素很快，但是插入和删除元素就很慢了，因为list是线性存储，数据量大的时候，插入和删除效率很低。</p>
</blockquote>
<p>deque是为了高效实现插入和删除操作的双向列表，适合用于队列和栈：</p>
<ul>
<li>deque除了实现list的append()和pop()外，还支持appendleft()和popleft()，这样就可以非常高效地往头部添加或删除元素。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line">q = deque([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</span><br><span class="line">q.remove(<span class="string">'a'</span>)</span><br><span class="line">q.append(<span class="string">'x'</span>)</span><br><span class="line">q.appendleft(<span class="string">'y'</span>)</span><br><span class="line">print(q) <span class="comment"># deque(['y', 'b', 'c', 'x'])</span></span><br></pre></td></tr></table></figure>
<h5 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h5><blockquote>
<p><span style="color:red">dict设置默认值</span>； </p>
</blockquote>
<p>使用dict时，当通过dict.[key]访问value时，如果引用的Key不存在，就会报错KeyError。如果希望key不存在时，返回一个默认值，就可以用defaultdict;</p>
<ul>
<li>注意默认值是调用函数返回的，而函数在创建defaultdict对象时传入。</li>
<li>除了在Key不存在时返回默认值，defaultdict的其他行为跟dict是完全一样的。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">dd = defaultdict(<span class="keyword">lambda</span>: <span class="string">'N/A'</span>)</span><br><span class="line">print(dd[<span class="string">'key'</span>])</span><br></pre></td></tr></table></figure>
<h5 id="OrderedDict"><a href="#OrderedDict" class="headerlink" title="OrderedDict"></a>OrderedDict</h5><blockquote>
<p><span style="color:red">dict的key支持按顺序迭代</span>；</p>
</blockquote>
<p>使用dict时，Key是无序的。在对dict做迭代时，我们无法确定Key的顺序。如果要保持Key的顺序，可以用OrderedDict；</p>
<ul>
<li>OrderedDict的Key会按照插入的顺序排列，不是Key本身排序;</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">d_t = dict()</span><br><span class="line">print(d_t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建字典：无序的</span></span><br><span class="line">d = dict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</span><br><span class="line">print(d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有序字典</span></span><br><span class="line">od = OrderedDict([(<span class="string">'a'</span>, <span class="number">1</span>), (<span class="string">'b'</span>, <span class="number">2</span>), (<span class="string">'c'</span>, <span class="number">3</span>)])</span><br><span class="line">print(od)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照插入的Key的顺序返回</span></span><br><span class="line">od = OrderedDict()</span><br><span class="line">od[<span class="string">'z'</span>] = <span class="number">1</span></span><br><span class="line">od[<span class="string">'y'</span>] = <span class="number">2</span></span><br><span class="line">od[<span class="string">'x'</span>] = <span class="number">3</span></span><br><span class="line">print(list(od.keys()))</span><br></pre></td></tr></table></figure>
<h6 id="实现FIFO的dict"><a href="#实现FIFO的dict" class="headerlink" title="实现FIFO的dict"></a>实现FIFO的dict</h6><p>OrderedDict可以实现一个FIFO（先进先出）的dict，当容量超出限制时，先删除最早添加的Key;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LastUpdatedOrderedDict</span><span class="params">(OrderedDict)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, capacity)</span>:</span></span><br><span class="line">        super(LastUpdatedOrderedDict, self).__init__()</span><br><span class="line">        self._capacity = capacity</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        containsKey = <span class="number">1</span> <span class="keyword">if</span> key <span class="keyword">in</span> self <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> len(self) - containsKey &gt;= self._capacity:</span><br><span class="line">            last = self.popitem(last=<span class="keyword">False</span>)</span><br><span class="line">            print(<span class="string">'remove:'</span>, last)</span><br><span class="line">        <span class="keyword">if</span> containsKey:</span><br><span class="line">            <span class="keyword">del</span> self[key]</span><br><span class="line">            print(<span class="string">'set:'</span>, (key, value))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'add:'</span>, (key, value))</span><br><span class="line">        OrderedDict.__setitem__(self, key, value)</span><br><span class="line"></span><br><span class="line">d = LastUpdatedOrderedDict(<span class="number">2</span>)</span><br><span class="line">d[<span class="string">'key1'</span>] = <span class="number">1</span></span><br><span class="line">d[<span class="string">'key2'</span>] = <span class="number">2</span></span><br><span class="line">d[<span class="string">'key3'</span>] = <span class="number">3</span></span><br><span class="line">d[<span class="string">'key4'</span>] = <span class="number">4</span></span><br><span class="line">print(d)</span><br></pre></td></tr></table></figure>
<h5 id="ChainMap"><a href="#ChainMap" class="headerlink" title="ChainMap"></a>ChainMap</h5><blockquote>
<p>让参数按定义的顺序查找；</p>
</blockquote>
<p>ChainMap可以把一组dict串起来组成一个逻辑上的dict。ChainMap本身也是一个dict，但是查找的时候，会按照顺序在内部的dict依次查找。</p>
<h6 id="使用场景示例"><a href="#使用场景示例" class="headerlink" title="使用场景示例"></a>使用场景示例</h6><p>什么时候使用ChainMap最合适？举个例子：应用程序往往都需要传入参数，参数可以通过命令行传入，可以通过环境变量传入，还可以有默认参数。我们可以用ChainMap实现参数的优先级查找，即先查命令行参数，如果没有传入，再查环境变量，如果没有，就使用默认参数。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line"><span class="comment"># python中的命令行解析最简单最原始的方法是使用sys.argv来实现，更高级的可以使用argparse这个模块。</span></span><br><span class="line"><span class="keyword">import</span> os, argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造缺省参数:</span></span><br><span class="line">defaults = &#123;</span><br><span class="line">    <span class="string">'color'</span>: <span class="string">'red'</span>,</span><br><span class="line">    <span class="string">'user'</span>: <span class="string">'guest'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造命令行参数:</span></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line"><span class="comment"># 指定程序需要接受的命令参数</span></span><br><span class="line">parser.add_argument(<span class="string">'-u'</span>, <span class="string">'--user'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'-c'</span>, <span class="string">'--color'</span>)</span><br><span class="line"><span class="comment"># 将之前add_argument()定义的参数进行赋值，并返回相关的namespace</span></span><br><span class="line">namespace = parser.parse_args()</span><br><span class="line">command_line_args = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> vars(namespace).items() <span class="keyword">if</span> v&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合成ChainMap:</span></span><br><span class="line">combined = ChainMap(command_line_args, os.environ, defaults)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 没有任何参数时，打印出默认参数:</span></span><br><span class="line">print(<span class="string">'color=%s'</span> % combined[<span class="string">'color'</span>])</span><br><span class="line">print(<span class="string">'user=%s'</span> % combined[<span class="string">'user'</span>])</span><br></pre></td></tr></table></figure>
<h5 id="Counter"><a href="#Counter" class="headerlink" title="Counter"></a>Counter</h5><blockquote>
<p>Counter是一个简单的计数器，Counter实际上也是dict的一个子类；</p>
</blockquote>
<p>示例：统计字符出现的个数？</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">c = Counter()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="string">'programming'</span>:</span><br><span class="line">    c[ch] = c[ch] + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>
<h4 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h4><blockquote>
<p>Base64是一种用64个字符来表示任意二进制数据的方法,Base64是一种最常见的二进制编码方法。</p>
</blockquote>
<h5 id="base64编解码"><a href="#base64编解码" class="headerlink" title="base64编解码"></a>base64编解码</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># base64编码</span></span><br><span class="line">encodeResult = base64.b64encode(<span class="string">b'10000011'</span>)</span><br><span class="line">print(encodeResult)</span><br><span class="line"><span class="comment"># base64解码</span></span><br><span class="line">print(base64.b64decode(encodeResult))</span><br></pre></td></tr></table></figure>
<h5 id="urlsafe-b64编解码"><a href="#urlsafe-b64编解码" class="headerlink" title="urlsafe_b64编解码"></a>urlsafe_b64编解码</h5><blockquote>
<p>urlsafe_b64编码后把字符+和/分别变成-和_；</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">test_str = <span class="string">b'i\xb7\x1d\xfb\xef\xff'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># base64编码</span></span><br><span class="line">print(base64.b64encode(test_str))</span><br><span class="line"><span class="comment"># urlsafe_b64编码(标准的Base64编码后可能出现字符+和/，在URL中就不能直接作为参数，所以又有一种"url safe"的base64编码，其实就是把字符+和/分别变成-和_)</span></span><br><span class="line">safe_encode = base64.urlsafe_b64encode(test_str)</span><br><span class="line">print(safe_encode)</span><br><span class="line"><span class="comment"># urlsafe_b64解码</span></span><br><span class="line">print(base64.urlsafe_b64decode(safe_encode))</span><br></pre></td></tr></table></figure>
<h5 id="要点-7"><a href="#要点-7" class="headerlink" title="要点"></a>要点</h5><ul>
<li>Base64是一种通过查表的编码方法，不能用于加密，即使使用自定义的编码表也不行。</li>
<li>Base64适用于小段内容的编码，比如数字证书签名、Cookie的内容等。</li>
<li>由于=字符也可能出现在Base64编码中，但=用在URL、Cookie里面会造成歧义，所以，很多Base64编码后会把=去掉;</li>
<li>Base64是把3个字节变为4个字节，所以，Base64编码的长度永远是4的倍数，因此，需要加上=把Base64字符串的长度变为4的倍数，就可以正常解码了；</li>
</ul>
<p><strong>例子</strong><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#【解码byte非4的倍数用等号补位】</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 能处理掉“=”的base64解码函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_base64_decode</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="comment"># 添加等于号</span></span><br><span class="line">    <span class="keyword">if</span> len(s) % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        s = s + bytes(<span class="string">'='</span>, encoding=<span class="string">'utf-8'</span>) * (<span class="number">4</span> - len(s) % <span class="number">4</span>)</span><br><span class="line">        print(<span class="string">"1:%s"</span> % s)</span><br><span class="line">    <span class="comment"># 解决字符串和bytes类型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(s, bytes):</span><br><span class="line">        s = bytes(s, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">        print(<span class="string">'s:%s'</span> % s)</span><br><span class="line">    <span class="comment"># 解码</span></span><br><span class="line">    base64_string = base64.b64decode(s)</span><br><span class="line">    print(<span class="string">"base64:%s"</span> % base64_string)</span><br><span class="line">    <span class="keyword">return</span> base64_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试:</span></span><br><span class="line"><span class="comment"># assert b'abcd' == safe_base64_decode(b'YWJjZA=='), safe_base64_decode('YWJjZA==')</span></span><br><span class="line"><span class="comment"># assert b'abcd' == safe_base64_decode(b'YWJjZA'), safe_base64_decode('YWJjZA')</span></span><br><span class="line"><span class="comment"># print('ok')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解码带等号=的bytes</span></span><br><span class="line">safe_base64_decode(<span class="string">b'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串转byte再解码</span></span><br><span class="line">safe_base64_decode(<span class="string">'YWJjZA=='</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编码长度不是4的倍数时，用等号补位；</span></span><br><span class="line">safe_base64_decode(<span class="string">b'YWJjZA'</span>)</span><br></pre></td></tr></table></figure></p>
<h4 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h4><blockquote>
<p>Python提供了一个struct模块来解决bytes和其它数据类型的转换;</p>
</blockquote>
<p>根据格式化字符串（参考<a href="https://docs.python.org/3/library/struct.html#format-characters" target="_blank" rel="noopener">struct官方文档</a>）的格式来进行bytes和其它数据类型的转换；</p>
<h5 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h5><p>struct模块中最主要的三个函数式pack()、unpack()、calcsize()，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pack(fmt, v1, v2, ...)  ------ 根据所给的fmt指令描述的格式将值v1，v2，...转换为一个字符串，后面参数个数要和处理指令一致。</span><br><span class="line">unpack(fmt, bytes)    ------ 根据所给的fmt指令描述的格式将bytes反向解析出来，返回一个元组。</span><br><span class="line">calcsize(fmt)      ------ 根据所给的fmt描述的格式返回该结构的大小。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>fmt由字节顺序符和格式字符组成（参考<a href="https://docs.python.org/3/library/struct.html#format-characters" target="_blank" rel="noopener">struct官方文档</a>）；</p>
</blockquote>
<h5 id="示例-23"><a href="#示例-23" class="headerlink" title="示例"></a>示例</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># pack把任意数据类型变成bytes(&gt;表示字节顺序是big-endian，也就是网络序，I表示4字节无符号整数。)</span></span><br><span class="line">print(struct.pack(<span class="string">'&gt;I'</span>, <span class="number">10240099</span>)) <span class="comment"># b'\x00\x9c@c'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unpack把bytes变成相应的数据类型(&gt;表示字节顺序是big-endian,为I：4字节无符号整数和H：2字节无符号整数。)</span></span><br><span class="line"><span class="comment"># 此处解释为：字节依次将前四个字节、后两个字节转换成无符号整数；</span></span><br><span class="line">print(struct.unpack(<span class="string">'&gt;IH'</span>, <span class="string">b'\xf0\xf0\xf0\xf0\x80\x80'</span>)) <span class="comment"># (4042322160, 32896)</span></span><br></pre></td></tr></table></figure>
<h4 id="hashlib"><a href="#hashlib" class="headerlink" title="hashlib"></a>hashlib</h4><p>Python的hashlib提供了常见的摘要算法，如MD5，SHA1等等。</p>
<h5 id="摘要算法"><a href="#摘要算法" class="headerlink" title="摘要算法"></a>摘要算法</h5><blockquote>
<p>任何摘要算法都是把无限多的数据集合映射到一个有限的集合中, 这种碰撞有可能逆推出原文;</p>
</blockquote>
<ul>
<li>摘要算法又称哈希算法、散列算法。它通过一个函数，把任意长度的数据转换为一个长度固定的数据串（通常用16进制的字符串表示）。</li>
<li>摘要算法就是通过摘要函数f()对任意长度的数据data计算出固定长度的摘要digest，目的是为了发现原始数据是否被人篡改过。</li>
<li>摘要算法之所以能指出数据是否被篡改过，就是因为摘要函数是一个单向函数，计算f(data)很容易，但通过digest反推data却非常困难。而且，对原始数据做一个bit的修改，都会导致计算出的摘要完全不同。</li>
<li><span style="color:blue">摘要算法在很多地方都有广泛的应用。要注意摘要算法不是加密算法，不能用于加密（因为无法通过摘要反推明文），只能用于防篡改，但是它的单向计算特性决定了可以在不存储明文口令的情况下验证用户口令。</span></li>
</ul>
<h5 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h5><p>MD5是最常见的摘要算法，速度很快，生成结果是固定的128 bit字节，通常用一个32位的16进制字符串表示。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单用法</span></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(<span class="string">'how to use md5 in python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据量很大,分块多次调用</span></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(<span class="string">'how to use md5 in '</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">md5.update(<span class="string">'python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(md5.hexdigest())</span><br></pre></td></tr></table></figure>
<h5 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h5><ul>
<li>SHA1的结果是160 bit字节，通常用一个40位的16进制字符串表示。</li>
<li>比SHA1更安全的算法是SHA256和SHA512，不过越安全的算法不仅越慢，而且摘要长度更长。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">sha1 = hashlib.sha1()</span><br><span class="line">sha1.update(<span class="string">'how to use sha1 in '</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">sha1.update(<span class="string">'python hashlib?'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">print(sha1.hexdigest())</span><br></pre></td></tr></table></figure>
<h4 id="hmac"><a href="#hmac" class="headerlink" title="hmac"></a>hmac</h4><p>Python内置的hmac模块实现了标准的Hmac算法，它利用一个key对message计算“杂凑”后的hash，使用hmac算法比标准hash算法更安全，因为针对相同的message，不同的key会产生不同的hash。</p>
<h5 id="解决问题场景"><a href="#解决问题场景" class="headerlink" title="解决问题场景"></a>解决问题场景</h5><p><span style="color:red">问题</span></p>
<p>通过哈希算法，我们可以验证一段数据是否有效，方法就是对比该数据的哈希值，例如，判断用户口令是否正确，我们用保存在数据库中的password_md5对比计算md5(password)的结果，如果一致，用户输入的口令就是正确的。</p>
<p><span style="color:blue">解决思路</span></p>
<p>为了防止黑客通过彩虹表根据哈希值反推原始口令，在计算哈希的时候，不能仅针对原始输入计算，需要增加一个salt来使得相同的输入也能得到不同的哈希，这样，大大增加了黑客破解的难度。</p>
<h5 id="hmac算法"><a href="#hmac算法" class="headerlink" title="hmac算法"></a>hmac算法</h5><p>和我们自定义的加salt算法不同，Hmac算法针对所有哈希算法都通用，无论是MD5还是SHA-1。采用Hmac替代我们自己的salt算法，可以使程序算法更标准化，也更安全。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"></span><br><span class="line">message = <span class="string">b'Hello, world!'</span></span><br><span class="line">key = <span class="string">b'secret'</span></span><br><span class="line">h = hmac.new(key, message, digestmod=<span class="string">'MD5'</span>)</span><br><span class="line"><span class="comment"># 如果消息很长，可以多次调用h.update(msg)</span></span><br><span class="line">print(h.hexdigest())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可见使用hmac和普通hash算法非常类似。hmac输出的长度和原始哈希算法的长度一致。需要注意传入的key和message都是bytes类型，str类型需要首先编码为bytes。</p>
</blockquote>
<h4 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h4><ul>
<li>Python的内建模块itertools提供了非常有用的用于操作迭代对象的函数。</li>
<li>itertools模块提供的全部是处理迭代功能的函数，它们的返回值不是list，而是Iterator，只有用for循环迭代的时候才真正计算。</li>
</ul>
<h5 id="无限迭代函数"><a href="#无限迭代函数" class="headerlink" title="无限迭代函数"></a>无限迭代函数</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools,time</span><br><span class="line"></span><br><span class="line"><span class="comment"># count(n)会创建一个自然数从n开始的无限迭代器,n如果不传，默认为0,n可以为负数；</span></span><br><span class="line">natuals = itertools.count(<span class="number">1</span>)</span><br><span class="line">print(type(natuals))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> natuals:</span><br><span class="line">    print(n)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># cycle(iterable)会将将传入的iterable按顺序无限迭代</span></span><br><span class="line">cs = itertools.cycle(<span class="string">'ABC'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cs:</span><br><span class="line">    print(c)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># repeat()负责把一个元素无限重复下去，不过如果提供第二个参数就可以限定重复次数：</span></span><br><span class="line">ns = itertools.repeat(<span class="string">'A'</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> ns:</span><br><span class="line">    print(n)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h5 id="多个迭代串联"><a href="#多个迭代串联" class="headerlink" title="多个迭代串联"></a>多个迭代串联</h5><p>chain()可以把一组迭代对象串联起来，形成一个更大的迭代器：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools,time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> itertools.chain(<span class="string">'ABC'</span>, <span class="string">'XYZ'</span>):</span><br><span class="line">    print(c)</span><br></pre></td></tr></table></figure>
<h5 id="重复元素分组迭代"><a href="#重复元素分组迭代" class="headerlink" title="重复元素分组迭代"></a>重复元素分组迭代</h5><p>groupby()把迭代器中相邻的重复元素挑出来放在一起：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools,time</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, group <span class="keyword">in</span> itertools.groupby(<span class="string">'AAABBBCCAAA'</span>):</span><br><span class="line">    print(key, list(group))</span><br><span class="line"></span><br><span class="line">print(<span class="string">'------------------------------'</span>)</span><br><span class="line"><span class="comment"># 添加值处理函数，按照不区分大小写来挑选</span></span><br><span class="line"><span class="keyword">for</span> key, group <span class="keyword">in</span> itertools.groupby(<span class="string">'AaaBBbcCAAa'</span>, <span class="keyword">lambda</span> c: c.upper()):</span><br><span class="line">    print(key, list(group))</span><br></pre></td></tr></table></figure>
<h4 id="contextlib"><a href="#contextlib" class="headerlink" title="contextlib"></a>contextlib</h4><p>在Python中，读写文件这样的资源要特别注意，必须在使用完毕后正确关闭它们。可以使用try…finally,或者with;</p>
<h5 id="with自动关闭资源"><a href="#with自动关闭资源" class="headerlink" title="with自动关闭资源"></a>with自动关闭资源</h5><p>并不是只有open()函数返回的fp对象才能使用with语句。实际上，任何对象，只要正确实现了上下文管理，就可以用于with语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实现上下文管理是通过__enter__和__exit__这两个方法实现的。</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Query</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Begin'</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, traceback)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> exc_type:</span><br><span class="line">            print(<span class="string">'Error'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'End'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Query info about %s...'</span> % self.name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Query(<span class="string">'Bob'</span>) <span class="keyword">as</span> q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<h5 id="contextmanager"><a href="#contextmanager" class="headerlink" title="@contextmanager"></a>@contextmanager</h5><blockquote>
<p><span style="color:red">上下文管理装饰器</span></p>
</blockquote>
<p>@contextmanager让我们通过编写generator来简化上下文管理。</p>
<h6 id="实现with"><a href="#实现with" class="headerlink" title="实现with"></a>实现with</h6><ol>
<li>@contextmanager这个decorator接受一个generator，用yield语句把with … as var把变量输出出去，然后，with语句就可以正常地工作了：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Query</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'Query info about %s...'</span> % self.name)</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_query</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'Begin'</span>)</span><br><span class="line">    q = Query(name)</span><br><span class="line">    <span class="keyword">yield</span> q</span><br><span class="line">    print(<span class="string">'End'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> create_query(<span class="string">'Bob'</span>) <span class="keyword">as</span> q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<ol>
<li>希望在某段代码执行前后自动执行特定代码，也可以用@contextmanager实现:</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"&lt;%s&gt;"</span> % name)</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    print(<span class="string">"&lt;/%s&gt;"</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tag(<span class="string">"h1"</span>):</span><br><span class="line">    print(<span class="string">"hello"</span>)</span><br><span class="line">    print(<span class="string">"world"</span>)</span><br></pre></td></tr></table></figure>
<h5 id="closing"><a href="#closing" class="headerlink" title="@closing"></a>@closing</h5><p>如果一个对象没有实现上下文，我们就不能把它用于with语句。这个时候，可以用closing()来把该对象变为上下文对象。</p>
<h6 id="closing的实现"><a href="#closing的实现" class="headerlink" title="@closing的实现"></a>@closing的实现</h6><p>closing也是一个经过@contextmanager装饰的generator，这个generator编写起来其实非常简单：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">closing</span><span class="params">(thing)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> thing</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        thing.close()</span><br></pre></td></tr></table></figure>
<h6 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h6><p>closing的作用就是把任意对象变为上下文对象，并支持with语句。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> closing</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> closing(urlopen(<span class="string">'https://www.python.org'</span>)) <span class="keyword">as</span> page:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> page:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure>
<h4 id="urllib"><a href="#urllib" class="headerlink" title="urllib"></a>urllib</h4><blockquote>
<p><span style="color:red">urllib提供了一系列用于操作URL的功能。</span></p>
</blockquote>
<p>urllib提供的功能就是利用程序去执行各种HTTP请求。如果要模拟浏览器完成特定功能，需要把请求伪装成浏览器。伪装的方法是先监控浏览器发出的请求，再根据浏览器的请求头来伪装，User-Agent头就是用来标识浏览器的。</p>
<h5 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h5><h6 id="抓取Get请求的信息"><a href="#抓取Get请求的信息" class="headerlink" title="抓取Get请求的信息"></a>抓取Get请求的信息</h6><p>urllib的request模块可以非常方便地抓取URL内容，也就是发送一个GET请求到指定的页面，然后返回HTTP的响应;</p>
<p>例如，对豆瓣的一个URL<a href="https://api.douban.com/v2/book/2129650进行抓取，可以看到HTTP响应的头和JSON数据" target="_blank" rel="noopener">https://api.douban.com/v2/book/2129650进行抓取，可以看到HTTP响应的头和JSON数据</a>:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> request.urlopen(<span class="string">'https://api.douban.com/v2/book/2129650'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    print(<span class="string">'Status:'</span>, f.status, f.reason)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> f.getheaders():</span><br><span class="line">        print(<span class="string">'%s: %s'</span> % (k, v))</span><br><span class="line">    print(<span class="string">'Data:'</span>, data.decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h6 id="模拟浏览器发送GET请求"><a href="#模拟浏览器发送GET请求" class="headerlink" title="模拟浏览器发送GET请求"></a>模拟浏览器发送GET请求</h6><p>如果我们要想模拟浏览器发送GET请求，就需要使用Request对象，通过往Request对象添加HTTP头，我们就可以把请求伪装成浏览器。</p>
<p>例如，模拟iPhone 6去请求豆瓣首页，这样豆瓣会返回适合iPhone的移动版网页：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">req = request.Request(<span class="string">'http://www.douban.com/'</span>)</span><br><span class="line">req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'</span>)</span><br><span class="line"><span class="keyword">with</span> request.urlopen(req) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'Status:'</span>, f.status, f.reason)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> f.getheaders():</span><br><span class="line">        print(<span class="string">'%s: %s'</span> % (k, v))</span><br><span class="line">    print(<span class="string">'Data:'</span>, f.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h5><p>如果要以POST发送一个请求，只需要把参数data以bytes形式传入。</p>
<p>案例：模拟一个微博登录，先读取登录的邮箱和口令，然后按照weibo.cn的登录页的格式以username=xxx&amp;password=xxx的编码传入；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'Login to weibo.cn...'</span>)</span><br><span class="line">email = input(<span class="string">'Email: '</span>)</span><br><span class="line">passwd = input(<span class="string">'Password: '</span>)</span><br><span class="line">login_data = parse.urlencode([</span><br><span class="line">    (<span class="string">'username'</span>, email),</span><br><span class="line">    (<span class="string">'password'</span>, passwd),</span><br><span class="line">    (<span class="string">'entry'</span>, <span class="string">'mweibo'</span>),</span><br><span class="line">    (<span class="string">'client_id'</span>, <span class="string">''</span>),</span><br><span class="line">    (<span class="string">'savestate'</span>, <span class="string">'1'</span>),</span><br><span class="line">    (<span class="string">'ec'</span>, <span class="string">''</span>),</span><br><span class="line">    (<span class="string">'pagerefer'</span>, <span class="string">'https://passport.weibo.cn/signin/welcome?entry=mweibo&amp;r=http%3A%2F%2Fm.weibo.cn%2F'</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">req = request.Request(<span class="string">'https://passport.weibo.cn/sso/login'</span>)</span><br><span class="line">req.add_header(<span class="string">'Origin'</span>, <span class="string">'https://passport.weibo.cn'</span>)</span><br><span class="line">req.add_header(<span class="string">'User-Agent'</span>, <span class="string">'Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25'</span>)</span><br><span class="line">req.add_header(<span class="string">'Referer'</span>, <span class="string">'https://passport.weibo.cn/signin/login?entry=mweibo&amp;res=wel&amp;wm=3349&amp;r=http%3A%2F%2Fm.weibo.cn%2F'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> request.urlopen(req, data=login_data.encode(<span class="string">'utf-8'</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'Status:'</span>, f.status, f.reason)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> f.getheaders():</span><br><span class="line">        print(<span class="string">'%s: %s'</span> % (k, v))</span><br><span class="line">    print(<span class="string">'Data:'</span>, f.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h5><p>如果还需要更复杂的控制，比如通过一个Proxy去访问网站，我们需要利用ProxyHandler来处理，示例代码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">proxy_handler = request.ProxyHandler(&#123;<span class="string">'http'</span>: <span class="string">'http://www.example.com:3128/'</span>&#125;)</span><br><span class="line">proxy_auth_handler = request.ProxyBasicAuthHandler()</span><br><span class="line">proxy_auth_handler.add_password(<span class="string">'realm'</span>, <span class="string">'host'</span>, <span class="string">'username'</span>, <span class="string">'password'</span>)</span><br><span class="line">opener = request.build_opener(proxy_handler, proxy_auth_handler)</span><br><span class="line"><span class="keyword">with</span> opener.open(<span class="string">'http://www.example.com/login.html'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p>操作XML有两种方法：DOM和SAX。</p>
<ul>
<li>DOM会把整个XML读入内存，解析为树，因此占用内存大，解析慢，优点是可以任意遍历树的节点。</li>
<li>SAX是流模式，边读边解析，占用内存小，解析快，缺点是我们需要自己处理事件。</li>
</ul>
<blockquote>
<p>正常情况下，优先考虑SAX，因为DOM实在太占内存。</p>
</blockquote>
<h5 id="SAX解析XML"><a href="#SAX解析XML" class="headerlink" title="SAX解析XML"></a>SAX解析XML</h5><ul>
<li>SAX解析的关键函数：from xml.parsers.expat import ParserCreate;</li>
<li>在Python中使用SAX解析XML非常简洁，通常我们关心的事件是start_element，end_element和char_data，准备好这3个函数，然后就可以解析xml了。</li>
</ul>
<h6 id="解析步骤"><a href="#解析步骤" class="headerlink" title="解析步骤"></a>解析步骤</h6><p>例如：解析一个html节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;/&quot;&gt;python&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>会产生3个事件：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start_element事件，在读取&lt;a href=&quot;/&quot;&gt;时；</span><br><span class="line">char_data事件，在读取python时；</span><br><span class="line">end_element事件，在读取&lt;/a&gt;时。</span><br></pre></td></tr></table></figure>
<ol>
<li>定义实现了1中三个事件方法的类；</li>
<li>通过指定ParserCreate实例的三个属性与1中三个方法；</li>
<li>最后调用ParserCreate实例对象的Parse(xml)函数来解析；</li>
</ol>
<h6 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.parsers.expat <span class="keyword">import</span> ParserCreate</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultSaxHandler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_element</span><span class="params">(self, name, attrs)</span>:</span></span><br><span class="line">        print(<span class="string">'sax:start_element: %s, attrs: %s'</span> % (name, str(attrs)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">end_element</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">'sax:end_element: %s'</span> % name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">char_data</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        print(<span class="string">'sax:char_data: %s'</span> % text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xml = <span class="string">r'''&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;ol&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="/python"&gt;Python&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;li&gt;&lt;a href="/ruby"&gt;Ruby&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">&lt;/ol&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">handler = DefaultSaxHandler()</span><br><span class="line">parser = ParserCreate()</span><br><span class="line">parser.StartElementHandler = handler.start_element</span><br><span class="line">parser.EndElementHandler = handler.end_element</span><br><span class="line">parser.CharacterDataHandler = handler.char_data</span><br><span class="line">parser.Parse(xml)</span><br></pre></td></tr></table></figure>
<h5 id="生成XML"><a href="#生成XML" class="headerlink" title="生成XML"></a>生成XML</h5><p>除了解析XML外，如何生成XML呢？99%的情况下需要生成的XML结构都是非常简单的，因此，最简单也是最有效的生成XML的方法是拼接字符串；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">L = []</span><br><span class="line">L.append(<span class="string">r'&lt;?xml version="1.0"?&gt;'</span>)</span><br><span class="line">L.append(<span class="string">r'&lt;root&gt;'</span>)</span><br><span class="line">L.append(encode(<span class="string">'some &amp; data'</span>))</span><br><span class="line">L.append(<span class="string">r'&lt;/root&gt;'</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">''</span>.join(L)</span><br></pre></td></tr></table></figure>
<h4 id="HTMLParser"><a href="#HTMLParser" class="headerlink" title="HTMLParser"></a>HTMLParser</h4><p>HTML本质上是XML的子集，但是HTML的语法没有XML那么严格，所以不能用标准的DOM或SAX来解析HTML,Python提供了HTMLParser来非常方便地解析HTML。</p>
<ul>
<li>feed()方法可以多次调用，也就是不一定一次把整个HTML字符串都塞进去，可以一部分一部分塞进去。</li>
<li>特殊字符有两种，一种是英文表示的&nbsp;，一种是数字表示的&#1234;，这两种字符都可以通过Parser解析出来。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> html.parser <span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="keyword">from</span> html.entities <span class="keyword">import</span> name2codepoint</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHTMLParser</span><span class="params">(HTMLParser)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">error</span><span class="params">(self, message)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_starttag</span><span class="params">(self, tag, attrs)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;%s&gt;'</span> % tag)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_endtag</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;/%s&gt;'</span> % tag)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_startendtag</span><span class="params">(self, tag, attrs)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;%s/&gt;'</span> % tag)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        print(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_comment</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;!--'</span>, data, <span class="string">'--&gt;'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_entityref</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">'&amp;%s;'</span> % name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_charref</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        print(<span class="string">'&amp;#%s;'</span> % name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parser = MyHTMLParser()</span><br><span class="line">parser.feed(<span class="string">'''&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;!-- test html parser --&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Some &lt;a href=\"#\"&gt;html&lt;/a&gt; HTML&amp;nbsp;tutorial...&lt;br&gt;END&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;&lt;/html&gt;'''</span>)</span><br></pre></td></tr></table></figure>
<h3 id="常用第三方模块"><a href="#常用第三方模块" class="headerlink" title="常用第三方模块"></a>常用第三方模块</h3><p>除了内建的模块外，Python还有大量的第三方模块，所有的第三方模块都会在<a href="https://pypi.org/" target="_blank" rel="noopener">pypi</a>上注册，只要找到对应的模块名字，即可用pip安装。</p>
<h4 id="Pillow-图像处理"><a href="#Pillow-图像处理" class="headerlink" title="Pillow(图像处理)"></a>Pillow(图像处理)</h4><p><a href="https://github.com/python-pillow/Pillow" target="_blank" rel="noopener">Pillow</a>是图像处理标准库,支持最新Python 3.x,详情见<a href="https://pillow.readthedocs.io" target="_blank" rel="noopener">API文档</a>;</p>
<h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install pillow</span><br></pre></td></tr></table></figure>
<h5 id="操作图像"><a href="#操作图像" class="headerlink" title="操作图像"></a>操作图像</h5><p>操作图像的缩放、切片、旋转、滤镜、输出文字、调色板等功能。</p>
<h6 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h6><ul>
<li>打开一张图片并进行缩放：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开一个jpg图像文件，注意是当前路径:</span></span><br><span class="line">im = Image.open(<span class="string">'talor_swift.jpg'</span>)</span><br><span class="line"><span class="comment"># 获得图像尺寸:</span></span><br><span class="line">w, h = im.size</span><br><span class="line">print(<span class="string">'Original image size: %sx%s'</span> % (w, h))</span><br><span class="line"><span class="comment"># 缩放到50%:</span></span><br><span class="line">im.thumbnail((w//<span class="number">2</span>, h//<span class="number">2</span>))</span><br><span class="line">print(<span class="string">'Resize image to: %sx%s'</span> % (w//<span class="number">2</span>, h//<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 保存图片到本地save(self,filepath,format)</span></span><br><span class="line"><span class="comment"># 把缩放后的图像用jpeg格式保存:</span></span><br><span class="line">im.save(<span class="string">'thumbnail.jpg'</span>, <span class="string">'jpeg'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="模糊"><a href="#模糊" class="headerlink" title="模糊"></a>模糊</h6><ol>
<li>ImageFilter类中预定义了如下滤波方法：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">• BLUR：模糊滤波</span><br><span class="line">• CONTOUR：轮廓滤波</span><br><span class="line">• DETAIL：细节滤波</span><br><span class="line">• EDGE_ENHANCE：边界增强滤波</span><br><span class="line">• EDGE_ENHANCE_MORE：边界增强滤波（程度更深）</span><br><span class="line">• EMBOSS：浮雕滤波</span><br><span class="line">• FIND_EDGES：寻找边界滤波</span><br><span class="line">• SMOOTH：平滑滤波</span><br><span class="line">• SMOOTH_MORE：平滑滤波（程度更深）</span><br><span class="line">• SHARPEN：锐化滤波</span><br><span class="line">• GaussianBlur(radius=2)：高斯模糊</span><br><span class="line">&gt;radius指定平滑半径。</span><br><span class="line">• UnsharpMask(radius=2, percent=150, threshold=3)：反锐化掩码滤波</span><br><span class="line">&gt;radius指定模糊半径；</span><br><span class="line">&gt;percent指定反锐化强度（百分比）;</span><br><span class="line">&gt;threshold控制被锐化的最小亮度变化。</span><br><span class="line">• Kernel(size, kernel, scale=None, offset=0)：核滤波</span><br><span class="line">当前版本只支持核大小为3x3和5x5的核大小，且图像格式为“L”和“RGB”的图像。</span><br><span class="line">&gt;size指定核大小（width, height）；</span><br><span class="line">&gt;kernel指定核权值的序列；</span><br><span class="line">&gt;scale指定缩放因子；</span><br><span class="line">&gt;offset指定偏移量，如果使用，则将该值加到缩放后的结果上。</span><br><span class="line">• RankFilter(size, rank)：排序滤波</span><br><span class="line">&gt;size指定滤波核的大小；</span><br><span class="line">&gt;rank指定选取排在第rank位的像素，若大小为0，则为最小值滤波；若大小为size * size / 2则为中值滤波；若大小为size * size - 1则为最大值滤波。</span><br><span class="line">• MedianFilter(size=3)：中值滤波</span><br><span class="line">&gt;size指定核的大小</span><br><span class="line">• MinFilter(size=3)：最小值滤波器</span><br><span class="line">&gt;size指定核的大小</span><br><span class="line">• MaxFilter(size=3)：最大值滤波器</span><br><span class="line">&gt;size指定核的大小</span><br><span class="line">• ModeFilter(size=3)：波形滤波器</span><br><span class="line">选取核内出现频次最高的像素值作为该点像素值，仅出现一次或两次的像素将被忽略，若没有像素出现两次以上，则保留原像素值。</span><br><span class="line">&gt;size指定核的大小；</span><br></pre></td></tr></table></figure>
<ol>
<li>示例：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageFilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开一个jpg图像文件，注意是当前路径:</span></span><br><span class="line">im = Image.open(<span class="string">'taylor_swift.jpg'</span>)</span><br><span class="line"><span class="comment"># 应用高斯模糊滤镜</span></span><br><span class="line">im2 = im.filter(ImageFilter.GaussianBlur(radius=<span class="number">10</span>))</span><br><span class="line"><span class="comment"># 保存图片到本地save(self,filepath,format)</span></span><br><span class="line">im2.save(<span class="string">'blur.jpg'</span>, <span class="string">'jpeg'</span>)</span><br></pre></td></tr></table></figure>
<h5 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h5><p>PIL的ImageDraw提供了一系列绘图方法，让我们可以直接绘图。</p>
<h6 id="生成字母验证码图片"><a href="#生成字母验证码图片" class="headerlink" title="生成字母验证码图片"></a>生成字母验证码图片</h6><p>用随机颜色填充背景，再画上文字，最后对图像进行模糊，得到验证码图片:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机字母:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnd_char</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> chr(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机颜色1:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnd_color</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机颜色2:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rnd_color2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定验证码图片的宽高240x60:</span></span><br><span class="line">width = <span class="number">240</span></span><br><span class="line">height = <span class="number">60</span></span><br><span class="line"><span class="comment"># 创建图片</span></span><br><span class="line">image = Image.new(<span class="string">'RGB'</span>, (width, height), (<span class="number">122</span>, <span class="number">235</span>, <span class="number">66</span>))</span><br><span class="line"><span class="comment"># 创建Font对象:</span></span><br><span class="line">font = ImageFont.truetype(<span class="string">'SF_Arch_Rival.ttf'</span>, <span class="number">36</span>)</span><br><span class="line"><span class="comment"># 创建Draw对象:</span></span><br><span class="line">draw = ImageDraw.Draw(image)</span><br><span class="line"><span class="comment"># 填充每个像素的颜色:</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(width):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> range(height):</span><br><span class="line">        draw.point((x, y), fill=rnd_color())</span><br><span class="line"><span class="comment"># 输出文字:</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">    draw.text((<span class="number">60</span> * t + <span class="number">10</span>, <span class="number">10</span>), rnd_char(), font=font, fill=rnd_color2())</span><br><span class="line"><span class="comment"># 模糊:</span></span><br><span class="line">image = image.filter(ImageFilter.BLUR)</span><br><span class="line">image.save(<span class="string">'code.jpg'</span>, <span class="string">'jpeg'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="requests-处理url"><a href="#requests-处理url" class="headerlink" title="requests(处理url)"></a>requests(处理url)</h4><p>处理URL资源比urllib更方便；</p>
<h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install requests</span><br></pre></td></tr></table></figure>
<h5 id="GET请求"><a href="#GET请求" class="headerlink" title="GET请求"></a>GET请求</h5><h6 id="使用GET请求"><a href="#使用GET请求" class="headerlink" title="使用GET请求"></a>使用GET请求</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># GET请求访问豆瓣首页内容</span></span><br><span class="line">r = requests.get(<span class="string">'https://www.douban.com/'</span>)</span><br><span class="line"><span class="comment"># 获取请求的http状态码</span></span><br><span class="line">print(r.status_code)</span><br><span class="line"><span class="comment"># 获取请求的url内容</span></span><br><span class="line">print(r.text)</span><br><span class="line"><span class="comment"># 获取实际请求的URL</span></span><br><span class="line">print(r.url)</span><br><span class="line"><span class="comment"># requests自动检测编码，可以使用encoding属性查看</span></span><br><span class="line">print(r.encoding)</span><br><span class="line"><span class="comment"># 无论响应是文本还是二进制内容，我们都可以用content属性获得bytes对象</span></span><br><span class="line">print(type(r.content))</span><br><span class="line"><span class="comment"># 获取响应头</span></span><br><span class="line">print(r.headers)</span><br><span class="line">print(r.headers[<span class="string">'Content-Type'</span>])</span><br><span class="line"><span class="comment"># requests对Cookie做了特殊处理，使得我们不必解析Cookie就可以轻松获取指定的Cookie：</span></span><br><span class="line">print(r.cookies[<span class="string">'ts'</span>])</span><br><span class="line"><span class="comment"># 要在请求中传入Cookie，只需准备一个dict传入cookies参数：</span></span><br><span class="line">cs = &#123;<span class="string">'token'</span>: <span class="string">'12345'</span>, <span class="string">'status'</span>: <span class="string">'working'</span>&#125;</span><br><span class="line">r = requests.get(url, cookies=cs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制请求的超时时间</span></span><br><span class="line"><span class="comment"># 2.5秒后超时</span></span><br><span class="line">r = requests.get(url, timeout=<span class="number">2.5</span>)</span><br></pre></td></tr></table></figure>
<h6 id="GET请求带参数"><a href="#GET请求带参数" class="headerlink" title="GET请求带参数"></a>GET请求带参数</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'https://www.douban.com/search'</span>, params=&#123;<span class="string">'q'</span>: <span class="string">'python'</span>, <span class="string">'cat'</span>: <span class="string">'1001'</span>&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="响应数据格式Json"><a href="#响应数据格式Json" class="headerlink" title="响应数据格式Json"></a>响应数据格式Json</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定请求响应数据的格式为json</span></span><br><span class="line">r = requests.get(<span class="string">'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20%3D%202151330&amp;format=json'</span>)</span><br><span class="line">print(r.json())</span><br></pre></td></tr></table></figure>
<h6 id="请求头添加header"><a href="#请求头添加header" class="headerlink" title="请求头添加header"></a>请求头添加header</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求添加header</span></span><br><span class="line">r = requests.get(<span class="string">'https://www.douban.com/'</span>, headers=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit'</span>&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h5><p>POST请求和GET请求用法类似，只需要把get()方法变成post()，然后传入data参数作为POST请求的数据;</p>
<h6 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h6><ol>
<li>requests默认使用application/x-www-form-urlencoded对POST数据编码。</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.post(</span><br><span class="line">    <span class="string">'https://accounts.douban.com/login'</span>, </span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">'form_email'</span>: <span class="string">'abc@example.com'</span>, </span><br><span class="line">        <span class="string">'form_password'</span>: <span class="string">'123456'</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>如果要传递JSON数据，可以直接传入json关键字参数,内部自动序列化为JSON;</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://accounts.douban.com/login'</span></span><br><span class="line">params = &#123;<span class="string">'key'</span>: <span class="string">'value'</span>&#125;</span><br><span class="line"><span class="comment"># json格式的参数（内部自动序列化为JSON）</span></span><br><span class="line">r = requests.post(url, json=params)</span><br></pre></td></tr></table></figure>
<ol>
<li>上传文件：上传文件需要更复杂的编码格式，但是requests把它简化成files参数；</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'xxx'</span></span><br><span class="line"><span class="comment"># 在读取文件时，注意务必使用'rb'即二进制模式读取，这样获取的bytes长度才是文件的长度</span></span><br><span class="line">upload_files = &#123;<span class="string">'file'</span>: open(<span class="string">'report.xls'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">r = requests.post(url, files=upload_files)</span><br></pre></td></tr></table></figure>
<h4 id="chardet-编码检测"><a href="#chardet-编码检测" class="headerlink" title="chardet(编码检测)"></a>chardet(编码检测)</h4><blockquote>
<p>用它来检测编码类型；</p>
</blockquote>
<p>使用chardet检测编码非常容易，chardet支持检测中文、日文、韩文等多种语言。详情参考<a href="https://chardet.readthedocs.io/en/latest/supported-encodings.html" target="_blank" rel="noopener">官方API文档</a></p>
<h5 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install chardet</span><br></pre></td></tr></table></figure>
<h5 id="常用编码检查"><a href="#常用编码检查" class="headerlink" title="常用编码检查"></a>常用编码检查</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> chardet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测ascii字节编码</span></span><br><span class="line">r = chardet.detect(<span class="string">b'Hello, world!'</span>)</span><br><span class="line">print(r)</span><br><span class="line"><span class="comment"># &#123;'encoding(编码)': 'ascii', 'confidence': 1.0(正确的概率是1.0（即100%）), 'language': ''&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测GBK编码的中文</span></span><br><span class="line">data = <span class="string">'离离原上草，一岁一枯荣'</span>.encode(<span class="string">'gbk'</span>)</span><br><span class="line">r = chardet.detect(data)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测UTF-8编码</span></span><br><span class="line">data = <span class="string">'离离原上草，一岁一枯荣'</span>.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">r = chardet.detect(data)</span><br><span class="line">print(r)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测日文编码</span></span><br><span class="line">data = <span class="string">'最新の主要ニュース'</span>.encode(<span class="string">'euc-jp'</span>)</span><br><span class="line">r = chardet.detect(data)</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>
<h4 id="psutil-系统信息"><a href="#psutil-系统信息" class="headerlink" title="psutil(系统信息)"></a>psutil(系统信息)</h4><blockquote>
<p>在Python中获取系统信息可以使用subprocess模块，另一个更简单的方法是使用psutil这个第三方模块。</p>
</blockquote>
<p>psutil还可以获取用户信息、Windows服务等很多有用的系统信息，具体请参考psutil的官网：<a href="https://github.com/giampaolo/psutil" target="_blank" rel="noopener">https://github.com/giampaolo/psutil</a>;</p>
<h5 id="安装-3"><a href="#安装-3" class="headerlink" title="安装"></a>安装</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install psutil</span><br></pre></td></tr></table></figure>
<h5 id="获取CPU信息"><a href="#获取CPU信息" class="headerlink" title="获取CPU信息"></a>获取CPU信息</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line">print(<span class="string">'CPU逻辑数量：'</span>, psutil.cpu_count())</span><br><span class="line">print(<span class="string">'CPU物理核心：'</span>, psutil.cpu_count(logical=<span class="keyword">False</span>))</span><br><span class="line">print(<span class="string">'统计CPU的用户／系统／空闲时间：'</span>, psutil.cpu_times())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似top命令的CPU使用率，每秒刷新一次，累计10次</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    print(psutil.cpu_percent(interval=<span class="number">1</span>, percpu=<span class="keyword">True</span>))</span><br></pre></td></tr></table></figure>
<h5 id="获取内存信息"><a href="#获取内存信息" class="headerlink" title="获取内存信息"></a>获取内存信息</h5><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line">print(<span class="string">'物理内存信息：'</span>, psutil.virtual_memory())</span><br><span class="line">print(<span class="string">'交换内存信息：'</span>, psutil.swap_memory())</span><br><span class="line"><span class="comment"># 物理内存信息： svmem(total=8461451264, available=2556604416, percent=69.8, used=5904846848, free=2556604416)</span></span><br><span class="line"><span class="comment"># 交换内存信息： sswap(total=13561724928, used=10279280640, free=3282444288, percent=75.8, sin=0, sout=0)</span></span><br><span class="line"><span class="comment"># 返回的是字节为单位的整数，可以看到，总内存大小是8589934592 = 8 GB，已用7201386496 = 6.7 GB，使用了66.6%。而交换区大小是1073741824 = 1 GB。</span></span><br></pre></td></tr></table></figure>
<h5 id="获取磁盘信息"><a href="#获取磁盘信息" class="headerlink" title="获取磁盘信息"></a>获取磁盘信息</h5><p>可以通过psutil获取磁盘分区、磁盘使用率和磁盘IO信息：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line">print(<span class="string">'磁盘分区信息：'</span>, psutil.disk_partitions())</span><br><span class="line">print(<span class="string">'磁盘使用情况：'</span>, psutil.disk_usage(<span class="string">'/'</span>))</span><br><span class="line">print(<span class="string">'磁盘IO：'</span>, psutil.disk_io_counters())</span><br></pre></td></tr></table></figure>
<h5 id="获取网络信息"><a href="#获取网络信息" class="headerlink" title="获取网络信息"></a>获取网络信息</h5><p>psutil可以获取网络接口和网络连接信息;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line">print(<span class="string">'获取网络读写字节／包的个数：'</span>, psutil.net_io_counters())</span><br><span class="line">print(<span class="string">'获取网络接口信息：'</span>, psutil.net_if_addrs())</span><br><span class="line">print(<span class="string">'获取网络接口状态：'</span>, psutil.net_if_stats())</span><br><span class="line">print(<span class="string">'网络连接信息：'</span>, psutil.net_connections())</span><br></pre></td></tr></table></figure>
<h5 id="获取进程信息"><a href="#获取进程信息" class="headerlink" title="获取进程信息"></a>获取进程信息</h5><ul>
<li>psutil让Python程序获取系统信息；</li>
<li>psutil还可以获取用户信息、Windows服务等很多有用的系统信息，具体请参考psutil的官网：<a href="https://github.com/giampaolo/psutil；" target="_blank" rel="noopener">https://github.com/giampaolo/psutil；</a></li>
<li>常用操作方法：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line">print(<span class="string">'所有进程ID：'</span>, psutil.pids())</span><br><span class="line"><span class="comment"># 获取指定进程ID=6856，其实就是当前chrome的进程</span></span><br><span class="line">p = psutil.Process(<span class="number">6856</span>)</span><br><span class="line">print(<span class="string">'进程名称：'</span>, p.name())</span><br><span class="line">print(<span class="string">'进程工作目录：'</span>, p.cwd())</span><br><span class="line">print(<span class="string">'进程exe路径：'</span>, p.exe())</span><br><span class="line">print(<span class="string">'进程启动的命令行：'</span>, p.cmdline())</span><br><span class="line">print(<span class="string">'父进程ID：'</span>, p.ppid())</span><br><span class="line">print(<span class="string">'父进程：'</span>, p.parent())</span><br><span class="line">print(<span class="string">'子进程列表：'</span>, p.children())</span><br><span class="line">print(<span class="string">'进程状态：'</span>, p.status())</span><br><span class="line">print(<span class="string">'进程用户名：'</span>, p.username())</span><br><span class="line">print(<span class="string">'进程创建时间：'</span>, p.create_time())</span><br><span class="line">print(<span class="string">'进程使用的CPU时间：'</span>, p.cpu_times())</span><br><span class="line">print(<span class="string">'进程使用的内存：'</span>, p.memory_info())</span><br><span class="line">print(<span class="string">'进程打开的文件：'</span>, p.open_files())</span><br><span class="line">print(<span class="string">'进程相关网络连接：'</span>, p.connections())</span><br><span class="line">print(<span class="string">'进程的线程数量：'</span>, p.num_threads())</span><br><span class="line">print(<span class="string">'所有线程信息：'</span>, p.threads())</span><br><span class="line">print(<span class="string">'进程环境变量：'</span>, p.environ())</span><br><span class="line">print(<span class="string">'结束进程：'</span>, p.terminate())</span><br><span class="line"><span class="comment"># print('进程终端：', p.terminal())</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Linux ps命令用于显示当前进程 (process) 的状态,psutil还提供了一个test()函数，可以模拟出ps命令的效果。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(psutil.test())</span><br></pre></td></tr></table></figure>
<h3 id="独立的python运行环境"><a href="#独立的python运行环境" class="headerlink" title="独立的python运行环境"></a>独立的python运行环境</h3><p>virtualenv为python应用提供了隔离的Python运行环境，解决了不同应用间使用相同第三方或者外部模块引起多版本的冲突问题。</p>
<blockquote>
<p><span style="color:red">需要注意的是，pycharm创建的项目默认安装了virtualenv,并且pycharm terminal默认会进入venv环境。</span></p>
</blockquote>
<h4 id="安装virtualenv"><a href="#安装virtualenv" class="headerlink" title="安装virtualenv"></a>安装virtualenv</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install virtualenv</span><br></pre></td></tr></table></figure>
<h4 id="venv环境"><a href="#venv环境" class="headerlink" title="venv环境"></a>venv环境</h4><p>venv环境是python项目根目录下的venv文件夹，通过命令virtualenv —no-site-packages可以让venv文件夹变为一个不带任何第三方包的“干净”的Python运行环境；</p>
<ol>
<li>创建项目；</li>
<li>创建并进入venv环境，创建好venv环境后，命令行前面会有(venv)前缀，如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">D:\pytest&gt; $ virtualenv --no-site-packages venv</span><br><span class="line">Using base prefix &apos;/usr/local/.../Python.framework/Versions/3.4&apos;</span><br><span class="line">New python executable in venv/bin/python3.4</span><br><span class="line">Also creating executable in venv/bin/python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br><span class="line">(venv) D:\pytest&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>venv环境指定项目的python版本</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virtualenv -p /usr/bin/python2.7 my_project</span><br></pre></td></tr></table></figure>
<ol>
<li>项目venv环境中安装第三方包：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install chardet</span><br></pre></td></tr></table></figure>
<ol>
<li>退出venv环境：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ deactivate</span><br></pre></td></tr></table></figure>
<ol>
<li>进入venv环境：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//linux</span><br><span class="line">$ source my_project/bin/activate </span><br><span class="line">//windows</span><br><span class="line">$ my_project\venv\Scripts\activate</span><br></pre></td></tr></table></figure>
<h3 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h3><p>Python支持多种图形界面的第三方库，包括：</p>
<ul>
<li>Tk（Python自带的库Tkinter是支持Tk的）</li>
<li>wxWidgets</li>
<li>Qt</li>
<li>GTK</li>
</ul>
<h4 id="Tkinter"><a href="#Tkinter" class="headerlink" title="Tkinter"></a>Tkinter</h4><blockquote>
<p>Python内置的Tkinter可以满足基本的GUI程序的要求，如果是非常复杂的GUI程序，建议用操作系统原生支持的语言和库来编写.</p>
</blockquote>
<ul>
<li>Tk是一个图形库，支持多个操作系统，使用Tcl语言开发；</li>
<li>Tk会调用操作系统提供的本地GUI接口，完成最终的GUI。</li>
<li>Tkinter封装了访问Tk的接口,我们的代码只需要调用Tkinter提供的接口就可以了；</li>
</ul>
<h5 id="GUI-API"><a href="#GUI-API" class="headerlink" title="GUI API"></a>GUI API</h5><h6 id="Frame"><a href="#Frame" class="headerlink" title="Frame"></a>Frame</h6><p>Frame是所有Widget的父容器,Frame则是可以容纳其他Widget的Widget，所有的Widget组合起来就是一棵树。</p>
<h5 id="GUI案例"><a href="#GUI案例" class="headerlink" title="GUI案例"></a>GUI案例</h5><h6 id="显示文本"><a href="#显示文本" class="headerlink" title="显示文本"></a>显示文本</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从Frame派生一个Application类，这是所有Widget的父容器：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span><span class="params">(Frame)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, master=None)</span>:</span></span><br><span class="line">        Frame.__init__(self, master)</span><br><span class="line">        <span class="comment"># pack()方法把Widget加入到父容器中</span></span><br><span class="line">        self.pack()</span><br><span class="line">        self.createWidgets()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createWidgets</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 创建一个Label</span></span><br><span class="line">        self.helloLabel = Label(self, text=<span class="string">'Hello, world!'</span>)</span><br><span class="line">        self.helloLabel.pack()</span><br><span class="line">        <span class="comment"># 创建一个Button</span></span><br><span class="line">        self.quitButton = Button(self, text=<span class="string">'Quit'</span>, command=self.quit)</span><br><span class="line">        self.quitButton.pack()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口在左上角和大小</span></span><br><span class="line">width, height, padx, pady = <span class="number">300</span>, <span class="number">300</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">Tk().geometry(<span class="string">'%dx%d9+%d+%d'</span> % (width, height, padx, pady))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化Application，并启动消息循环</span></span><br><span class="line">app = Application()</span><br><span class="line"><span class="comment"># 设置窗口标题:</span></span><br><span class="line">app.master.title(<span class="string">'Hello World'</span>)</span><br><span class="line"><span class="comment"># 主消息循环进入GUI界面</span></span><br><span class="line">app.mainloop()</span><br></pre></td></tr></table></figure>
<h6 id="输入和弹窗"><a href="#输入和弹窗" class="headerlink" title="输入和弹窗"></a>输入和弹窗</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter.messagebox <span class="keyword">as</span> messagebox</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span><span class="params">(Frame)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, master=None)</span>:</span></span><br><span class="line">        Frame.__init__(self, master)</span><br><span class="line">        self.pack()</span><br><span class="line">        self.createWidgets()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">createWidgets</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 创建一个输入框</span></span><br><span class="line">        self.nameInput = Entry(self)</span><br><span class="line">        self.nameInput.pack()</span><br><span class="line">        <span class="comment"># 创建一个按钮</span></span><br><span class="line">        self.alertButton = Button(self, text=<span class="string">'Hello'</span>, command=self.hello)</span><br><span class="line">        self.alertButton.pack()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(self)</span>:</span></span><br><span class="line">        name = self.nameInput.get() <span class="keyword">or</span> <span class="string">'world'</span></span><br><span class="line">        <span class="comment"># 显示一个弹窗</span></span><br><span class="line">        messagebox.showinfo(<span class="string">'Message'</span>, <span class="string">'Hello, %s'</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置窗口在左上角和大小</span></span><br><span class="line">width, height, padx, pady = <span class="number">300</span>, <span class="number">300</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">Tk().geometry(<span class="string">'%dx%d9+%d+%d'</span> % (width, height, padx, pady))</span><br><span class="line"></span><br><span class="line">app = Application()</span><br><span class="line"><span class="comment"># 设置窗口标题:</span></span><br><span class="line">app.master.title(<span class="string">'Hello World'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主消息循环:</span></span><br><span class="line">app.mainloop()</span><br></pre></td></tr></table></figure>
<h4 id="turtle"><a href="#turtle" class="headerlink" title="turtle"></a>turtle</h4><blockquote>
<p>Python内置了turtle库，基本上100%复制了原始的Turtle Graphics（海龟绘图）的所有功能。</p>
</blockquote>
<p>turtle可以执行一个绘制图形的过程，绘制出各种复杂的图形；</p>
<h5 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h5><h6 id="绘制一个长方形"><a href="#绘制一个长方形" class="headerlink" title="绘制一个长方形"></a>绘制一个长方形</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入turtle包的所有内容:</span></span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置笔刷宽度:</span></span><br><span class="line">width(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前进:</span></span><br><span class="line">forward(<span class="number">200</span>)</span><br><span class="line"><span class="comment"># 右转90度:</span></span><br><span class="line">right(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 笔刷颜色:</span></span><br><span class="line">pencolor(<span class="string">'red'</span>)</span><br><span class="line">forward(<span class="number">100</span>)</span><br><span class="line">right(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line">pencolor(<span class="string">'green'</span>)</span><br><span class="line">forward(<span class="number">200</span>)</span><br><span class="line">right(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line">pencolor(<span class="string">'blue'</span>)</span><br><span class="line">forward(<span class="number">100</span>)</span><br><span class="line">right(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用done()使得窗口等待被关闭，否则将立刻关闭窗口:</span></span><br><span class="line">done()</span><br></pre></td></tr></table></figure>
<h6 id="循环绘制5个五角星"><a href="#循环绘制5个五角星" class="headerlink" title="循环绘制5个五角星"></a>循环绘制5个五角星</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawStar</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    pu()</span><br><span class="line">    goto(x, y)</span><br><span class="line">    pd()</span><br><span class="line">    <span class="comment"># set heading: 0</span></span><br><span class="line">    seth(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        fd(<span class="number">40</span>)</span><br><span class="line">        rt(<span class="number">144</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">250</span>, <span class="number">50</span>):</span><br><span class="line">    drawStar(x, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">done()</span><br></pre></td></tr></table></figure>
<h6 id="绘制一棵分型树"><a href="#绘制一棵分型树" class="headerlink" title="绘制一棵分型树"></a>绘制一棵分型树</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置色彩模式是RGB:</span></span><br><span class="line">colormode(<span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">lt(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line">lv = <span class="number">14</span></span><br><span class="line">l = <span class="number">120</span></span><br><span class="line">s = <span class="number">45</span></span><br><span class="line"></span><br><span class="line">width(lv)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化RGB颜色:</span></span><br><span class="line">r = <span class="number">0</span></span><br><span class="line">g = <span class="number">0</span></span><br><span class="line">b = <span class="number">0</span></span><br><span class="line">pencolor(r, g, b)</span><br><span class="line"></span><br><span class="line">penup()</span><br><span class="line">bk(l)</span><br><span class="line">pendown()</span><br><span class="line">fd(l)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_tree</span><span class="params">(l, level)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> r, g, b</span><br><span class="line">    <span class="comment"># save the current pen width</span></span><br><span class="line">    w = width()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># narrow the pen width</span></span><br><span class="line">    width(w * <span class="number">3.0</span> / <span class="number">4.0</span>)</span><br><span class="line">    <span class="comment"># set color:</span></span><br><span class="line">    r = r + <span class="number">1</span></span><br><span class="line">    g = g + <span class="number">2</span></span><br><span class="line">    b = b + <span class="number">3</span></span><br><span class="line">    pencolor(r % <span class="number">200</span>, g % <span class="number">200</span>, b % <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">    l = <span class="number">3.0</span> / <span class="number">4.0</span> * l</span><br><span class="line"></span><br><span class="line">    lt(s)</span><br><span class="line">    fd(l)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> level &lt; lv:</span><br><span class="line">        draw_tree(l, level + <span class="number">1</span>)</span><br><span class="line">    bk(l)</span><br><span class="line">    rt(<span class="number">2</span> * s)</span><br><span class="line">    fd(l)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> level &lt; lv:</span><br><span class="line">        draw_tree(l, level + <span class="number">1</span>)</span><br><span class="line">    bk(l)</span><br><span class="line">    lt(s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># restore the previous pen width</span></span><br><span class="line">    width(w)</span><br><span class="line"></span><br><span class="line">speed(<span class="string">"fastest"</span>)</span><br><span class="line"></span><br><span class="line">draw_tree(l, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">done()</span><br></pre></td></tr></table></figure>
<h3 id="网络编程"><a href="#网络编程" class="headerlink" title="网络编程"></a>网络编程</h3><p>用Python进行网络编程，就是在Python程序本身这个进程内，连接别的服务器进程的通信端口进行通信。</p>
<h4 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h4><blockquote>
<p>互联网的协议简称TCP/IP协议.</p>
</blockquote>
<h5 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h5><p>IP协议负责把数据从一台计算机通过网络发送到另一台计算机。数据被分割成一小块一小块，然后通过IP包发送出去。由于互联网链路复杂，两台计算机之间经常有多条线路，因此，路由器就负责决定如何把一个IP包转发出去。IP包的特点是按块发送，途径多个路由，但不保证能到达，也不保证顺序到达。</p>
<h6 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h6><p>IP地址实际上是一个32位整数（称为IPv4），以字符串表示的IP地址如192.168.0.1实际上是把32位整数按8位分组后的数字表示，目的是便于阅读。</p>
<h6 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h6><p>IPv6地址实际上是一个128位整数，它是目前使用的IPv4的升级版，以字符串表示类似于2001:0db8:85a3:0042:1000:8a2e:0370:7334.</p>
<h5 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h5><p>TCP协议则是建立在IP协议之上的。TCP协议负责在两台计算机之间建立可靠连接，保证数据包按顺序到达。TCP协议会通过握手建立连接，然后，对每个IP包编号，确保对方按顺序收到，如果包丢掉了，就自动重发。</p>
<p>许多常用的更高级的协议都是建立在TCP协议基础上的，比如用于浏览器的HTTP协议、发送邮件的SMTP协议等。</p>
<blockquote>
<p>一个TCP报文除了包含要传输的数据外，还包含源IP地址和目标IP地址，源端口和目标端口。</p>
</blockquote>
<h6 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h6><ol>
<li>第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。</li>
<li>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态；</li>
<li>第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。</li>
</ol>
<h6 id="TCP协议栈的弱点"><a href="#TCP协议栈的弱点" class="headerlink" title="TCP协议栈的弱点"></a>TCP协议栈的弱点</h6><p>TCP连接的资源消耗，其中包括：数据包信息、条件状态、序列号等。通过故意不完成建立连接所需要的三次握手过程，造成连接一方的资源耗尽。</p>
<h5 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h5><p>80端口是Web服务的标准端口。其他服务都有对应的标准端口号，例如SMTP服务是25端口，FTP服务是21端口，等等。端口号小于1024的是Internet标准服务的端口，端口号大于1024的，可以任意使用。</p>
<h4 id="TCP编程"><a href="#TCP编程" class="headerlink" title="TCP编程"></a>TCP编程</h4><h5 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h5><ul>
<li>Socket是网络编程的一个抽象概念。通常我们用一个Socket表示“打开了一个网络链接”，而打开一个Socket需要知道目标计算机的IP地址和端口号，再指定协议类型即可。</li>
<li>大多数连接都是可靠的TCP连接。创建TCP连接时，主动发起连接的叫客户端，被动响应连接的叫服务器。</li>
<li>用TCP协议进行Socket编程在Python中十分简单，对于客户端，要主动连接服务器的IP和指定端口，对于服务器，要首先监听指定端口，然后，对每一个新的连接，创建一个线程或进程来处理。通常，服务器程序会无限运行下去。</li>
<li>同一个端口，被一个Socket绑定了以后，就不能被别的Socket绑定了。</li>
</ul>
<h6 id="socket使用步骤示例"><a href="#socket使用步骤示例" class="headerlink" title="socket使用步骤示例"></a>socket使用步骤示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入socket库:</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 创建一个socket:</span></span><br><span class="line"><span class="comment"># 创建Socket时，AF_INET指定使用IPv4协议，如果要用更先进的IPv6，就指定为AF_INET6。</span></span><br><span class="line"><span class="comment"># SOCK_STREAM指定使用面向流的TCP协议</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># 2. 建立连接:</span></span><br><span class="line">s.connect((<span class="string">'www.sina.com.cn'</span>, <span class="number">80</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 发送数据:</span></span><br><span class="line">s.send(<span class="string">b'GET / HTTP/1.1\r\nHost: www.sina.com.cn\r\nConnection: close\r\n\r\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 接收数据:</span></span><br><span class="line">buffer = []</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># 每次最多接收1k字节:</span></span><br><span class="line">    d = s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> d:</span><br><span class="line">        buffer.append(d)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 中断链接</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">data = <span class="string">b''</span>.join(buffer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 关闭连接:</span></span><br><span class="line">s.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 处理结果</span></span><br><span class="line"><span class="comment"># 把HTTP头打印出来，网页内容保存到文件</span></span><br><span class="line">header, html = data.split(<span class="string">b'\r\n\r\n'</span>, <span class="number">1</span>)</span><br><span class="line">print(header.decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># 把接收的数据写入文件:</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'sina.html'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(html)</span><br></pre></td></tr></table></figure>
<h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><p>客户端使用socket请求服务端并获得响应；</p>
<p>大多数连接都是可靠的TCP连接。创建TCP连接时，主动发起连接的叫客户端，被动响应连接的叫服务器。</p>
<h5 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h5><p>和客户端编程相比，服务器编程就要复杂一些。</p>
<h6 id="服务端处理思路"><a href="#服务端处理思路" class="headerlink" title="服务端处理思路"></a>服务端处理思路</h6><ol>
<li>服务器进程首先要绑定一个端口并监听来自其他客户端的连接。如果某个客户端连接过来了，服务器就与该客户端建立Socket连接，随后的通信就靠这个Socket连接了。</li>
<li>服务器会打开固定端口（比如80）监听，每来一个客户端连接，就创建该Socket连接。由于服务器会有大量来自客户端的连接，所以，服务器要能够区分一个Socket连接是和哪个客户端绑定的。一个Socket依赖4项：服务器地址、服务器端口、客户端地址、客户端端口来唯一确定一个Socket。</li>
<li>但是服务器还需要同时响应多个客户端的请求，所以，每个连接都需要一个新的进程或者新的线程来处理，否则，服务器一次就只能服务一个客户端了。</li>
</ol>
<blockquote>
<p>绑定监听的地址和端口。服务器可能有多块网卡，可以绑定到某一块网卡的IP地址上，也可以用0.0.0.0绑定到所有的网络地址，还可以用127.0.0.1绑定到本机地址。127.0.0.1是一个特殊的IP地址，表示本机地址，如果绑定到这个地址，客户端必须同时在本机运行才能连接，也就是说，外部的计算机无法连接进来。</p>
</blockquote>
<h5 id="CS通信示例"><a href="#CS通信示例" class="headerlink" title="CS通信示例"></a>CS通信示例</h5><p>创建一个服务端，用来接收到用户的链接，当接收到用户输入的信息时，都将接收的内容加上“我不明白”再发回去，用户输入exit时，客户端退出socket连接。</p>
<p><span style="color:blue">实现步骤如下：</span></p>
<ol>
<li>服务端代码：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定监听端口:</span></span><br><span class="line"><span class="comment"># 可以用0.0.0.0绑定到所有的网络地址</span></span><br><span class="line"><span class="comment"># s.bind(('0.0.0.0', 9999))</span></span><br><span class="line"><span class="comment"># 可以用127.0.0.1绑定到本机地址,此时客户端必须同时在本机运行才能连接</span></span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始监听端口（传入的参数指定等待连接的最大数量）</span></span><br><span class="line">s.listen(<span class="number">5</span>)</span><br><span class="line">print(<span class="string">'Waiting for connection...'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个连接都必须创建新线程（或进程）来处理</span></span><br><span class="line"><span class="comment"># 单线程在处理连接的过程中，无法接受其他客户端的连接；</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tcplink</span><span class="params">(sock, addr)</span>:</span></span><br><span class="line">    print(<span class="string">'Accept new connection from %s:%s...'</span> % addr)</span><br><span class="line">    sock.send(<span class="string">b'Welcome!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data.decode(<span class="string">'utf-8'</span>) == <span class="string">'exit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sock.send((<span class="string">'我不明白"%s"是什么!'</span> % data.decode(<span class="string">'utf-8'</span>)).encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    sock.close()</span><br><span class="line">    print(<span class="string">'Connection from %s:%s closed.'</span> % addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器程序通过一个永久循环来接受来自客户端的连接，accept()会等待并返回一个客户端的连接</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># 接受一个新连接:</span></span><br><span class="line">    sock, addr = s.accept()</span><br><span class="line">    <span class="comment"># 创建新线程来处理TCP连接:</span></span><br><span class="line">    t = threading.Thread(target=tcplink, args=(sock, addr))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
<ol>
<li>客户端代码：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment"># 建立连接:</span></span><br><span class="line">s.connect((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"><span class="comment"># 接收欢迎消息:</span></span><br><span class="line">print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通信：接收用户输入信息进行通信</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    inputStr = input(<span class="string">"请输入信息，按回车发送："</span>)</span><br><span class="line">    <span class="keyword">if</span> inputStr == <span class="string">'exit'</span>:</span><br><span class="line">        s.send(<span class="string">b'exit'</span>)</span><br><span class="line">        s.close()</span><br><span class="line">        print(<span class="string">'通信结束！'</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s.send(inputStr.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">        print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="UDP编程"><a href="#UDP编程" class="headerlink" title="UDP编程"></a>UDP编程</h4><blockquote>
<p>TCP是建立可靠连接，并且通信双方都可以以流的形式发送数据。相对TCP，UDP则是面向无连接的协议。</p>
</blockquote>
<ul>
<li>使用UDP协议时，不需要建立连接，只需要知道对方的IP地址和端口号，就可以直接发数据包。但是，能不能到达就不知道了。</li>
<li>虽然用UDP传输数据不可靠，但它的优点是和TCP比，速度快，对于不要求可靠到达的数据，就可以使用UDP协议。</li>
</ul>
<p><span style="color:orange">UDP的使用与TCP类似，但是不需要建立连接。此外，客户端不需要调用connect建立连接和服务端不需要调用listen，并且服务器绑定UDP端口和TCP端口互不冲突，也就是说，UDP的9999端口与TCP的9999端口可以各自绑定。</span></p>
<h5 id="示例-24"><a href="#示例-24" class="headerlink" title="示例"></a>示例</h5><p>服务端和客户端使用UDP通信，服务端接收客户端信息，加上hello后，再返回给客户端；</p>
<ol>
<li>服务端代码：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># SOCK_DGRAM指定了这个Socket的类型是UDP</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="comment"># 绑定端口</span></span><br><span class="line"><span class="comment"># UDP不需要调用listen()方法，而是直接接收来自任何客户端的数据</span></span><br><span class="line">s.bind((<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处省略多线程的写法</span></span><br><span class="line">print(<span class="string">'Bind UDP on 9999...'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="comment"># 接收数据(recvfrom()方法返回数据和客户端的地址与端口)</span></span><br><span class="line">    data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">'Received from %s:%s.'</span> % addr)</span><br><span class="line">    <span class="comment"># 直接调用sendto()就可以把数据用UDP发给客户端</span></span><br><span class="line">    s.sendto(<span class="string">b'Hello, %s!'</span> % data, addr)</span><br></pre></td></tr></table></figure>
<ol>
<li>客户端代码：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> [<span class="string">b'Michael'</span>, <span class="string">b'Tracy'</span>, <span class="string">b'Sarah'</span>]:</span><br><span class="line">    <span class="comment"># 发送数据:</span></span><br><span class="line">    s.sendto(data, (<span class="string">'127.0.0.1'</span>, <span class="number">9999</span>))</span><br><span class="line">    <span class="comment"># 接收数据:</span></span><br><span class="line">    print(s.recv(<span class="number">1024</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<h3 id="实现收发电子邮件"><a href="#实现收发电子邮件" class="headerlink" title="实现收发电子邮件"></a>实现收发电子邮件</h3><h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ul>
<li>MUA：Mail User Agent——邮件用户代理。</li>
<li>MTA：Mail Transfer Agent——邮件传输代理，就是那些Email服务提供商，比如网易、新浪等等。</li>
<li>MDA：Mail Delivery Agent——邮件投递代理。</li>
</ul>
<h4 id="收发邮件"><a href="#收发邮件" class="headerlink" title="收发邮件"></a>收发邮件</h4><h5 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发件人 -&gt; MUA -&gt; MTA -&gt; MTA -&gt; 若干个MTA -&gt; MDA &lt;- MUA &lt;- 收件人</span><br></pre></td></tr></table></figure>
<p>要编写程序来发送和接收邮件，本质上就是：</p>
<ol>
<li>编写MUA把邮件发到MTA；</li>
<li>编写MUA从MDA上收邮件;</li>
</ol>
<h5 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h5><p>发邮件时，MUA和MTA使用的协议就是SMTP：Simple Mail Transfer Protocol，后面的MTA到另一个MTA也是用SMTP协议。</p>
<p>收邮件时，MUA和MDA使用的协议有两种：POP：Post Office Protocol，目前版本是3，俗称POP3；IMAP：Internet Message Access Protocol，目前版本是4，优点是不但能取邮件，还可以直接操作MDA上存储的邮件，比如从收件箱移到垃圾箱，等等。</p>
<h5 id="SMTP服务器配置"><a href="#SMTP服务器配置" class="headerlink" title="SMTP服务器配置"></a>SMTP服务器配置</h5><p>邮件客户端软件在发邮件时，会让你先配置SMTP服务器，也就是你要发到哪个MTA上。假设你正在使用163的邮箱，你就不能直接发到新浪的MTA上，因为它只服务新浪的用户，所以，你得填163提供的SMTP服务器地址：smtp.163.com，为了证明你是163的用户，SMTP服务器还要求你填写邮箱地址和邮箱口令，这样，MUA才能正常地把Email通过SMTP协议发送到MTA。</p>
<p>类似的，从MDA收邮件时，MDA服务器也要求验证你的邮箱口令，确保不会有人冒充你收取你的邮件，所以，Outlook之类的邮件客户端会要求你填写POP3或IMAP服务器地址、邮箱地址和口令，这样，MUA才能顺利地通过POP或IMAP协议从MDA取到邮件。</p>
<blockquote>
<p><span style="color:red">特别注意：</span>代理客户端收发邮件，需要本地配置邮件的登录信息，并且，目前大多数邮件服务商都需要手动打开SMTP发信和POP收信的功能，否则只允许在网页登录;</p>
</blockquote>
<h4 id="SMTP发送邮件"><a href="#SMTP发送邮件" class="headerlink" title="SMTP发送邮件"></a>SMTP发送邮件</h4><blockquote>
<p>SMTP是发送邮件的协议，Python内置对SMTP的支持，可以发送纯文本邮件、HTML邮件以及带附件的邮件。</p>
</blockquote>
<p>Python对SMTP支持有smtplib和email两个模块，email负责构造邮件，smtplib负责发送邮件。</p>
<h5 id="发文本邮件"><a href="#发文本邮件" class="headerlink" title="发文本邮件"></a>发文本邮件</h5><ol>
<li>构造邮件内容：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="comment"># 构造MIMEText对象时传入的参数：</span></span><br><span class="line"><span class="comment"># 第一个参数就是邮件正文，</span></span><br><span class="line"><span class="comment"># 第二个参数是MIME的subtype，传入'plain'表示纯文本，最终的MIME就是'text/plain'，</span></span><br><span class="line"><span class="comment"># 第二个参数utf-8编码保证多语言兼容性。</span></span><br><span class="line">msg = MIMEText(<span class="string">'hello, send by Python...'</span>, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>
<ol>
<li>邮件主题、发件人、收件人信息并不是通过SMTP协议发给MTA，而是包含在发给MTA的文本中的，如果没有，可能无法发送；</li>
<li>主要代码如下：</li>
</ol>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> parseaddr, formataddr</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化一个邮件地址(真实姓名+邮件地址)</span></span><br><span class="line"><span class="comment"># (注意不能简单地传入name &lt;addr@example.com&gt;,如果包含中文，需要通过Header对象进行编码)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_format_addr</span><span class="params">(s)</span>:</span></span><br><span class="line">    name, addr = parseaddr(s)</span><br><span class="line">    <span class="keyword">return</span> formataddr((Header(name, <span class="string">'utf-8'</span>).encode(), addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 用户邮件服务信息配置 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 通过SMTP发出去</span></span><br><span class="line"><span class="comment"># 输入Email地址和口令:</span></span><br><span class="line"><span class="comment"># from_addr = input('From: ')</span></span><br><span class="line">from_addr = <span class="string">'xxx@163.com'</span></span><br><span class="line"><span class="comment"># password = input('Password: ')</span></span><br><span class="line">password = <span class="string">'xxx'</span></span><br><span class="line"><span class="comment"># 输入收件人地址:</span></span><br><span class="line"><span class="comment"># msg['To']接收的是字符串而不是list，如果有多个邮件地址，用,分隔即可。</span></span><br><span class="line"><span class="comment"># to_addr = input('To: ')</span></span><br><span class="line">to_addr = <span class="string">'xxx@qq.com'</span></span><br><span class="line"><span class="comment"># 输入SMTP服务器地址:</span></span><br><span class="line"><span class="comment"># smtp_server = input('SMTP server: ')</span></span><br><span class="line">smtp_server = <span class="string">'smtp.163.com'</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 构造邮件内容 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 发送内容为：纯文本</span></span><br><span class="line"><span class="comment"># 构造邮件文本对象</span></span><br><span class="line"><span class="comment"># msg = MIMEText('hello, send by Python...', 'plain', 'utf-8')</span></span><br><span class="line"><span class="comment"># 发送内容为：HTML</span></span><br><span class="line">msg = MIMEText(<span class="string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello&lt;/h1&gt;'</span> +</span><br><span class="line">               <span class="string">'&lt;p&gt;send by &lt;a href="http://www.python.org"&gt;Python&lt;/a&gt;'</span></span><br><span class="line">               <span class="string">'&lt;img height="92px" src="https://www.baidu.com/img/superlogo_c4d7df0a003d3db9b65e9ef0fe6da1ec.png" width="272px" alt="Google" /&gt;&lt;/p&gt;'</span> +</span><br><span class="line">               <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span>, <span class="string">'html'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发件人</span></span><br><span class="line">msg[<span class="string">'From'</span>] = _format_addr(<span class="string">'发件人姓名 &lt;%s&gt;'</span> % from_addr)</span><br><span class="line"><span class="comment"># 收件人姓名可能被邮件服务商替换成注册用户名</span></span><br><span class="line">msg[<span class="string">'To'</span>] = _format_addr(<span class="string">'收件人姓名 &lt;%s&gt;'</span> % to_addr)</span><br><span class="line">msg[<span class="string">'Subject'</span>] = Header(<span class="string">'邮件标题'</span>, <span class="string">'utf-8'</span>).encode()</span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 发邮件服务 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># SMTP协议默认端口是25</span></span><br><span class="line">server = smtplib.SMTP(smtp_server, <span class="number">25</span>)</span><br><span class="line"><span class="comment"># 打印出和SMTP服务器交互的所有信息</span></span><br><span class="line">server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># login()方法用来登录SMTP服务器</span></span><br><span class="line">server.login(from_addr, password)</span><br><span class="line"><span class="comment"># 发邮件</span></span><br><span class="line"><span class="comment"># 由于可以一次发给多个人，所以传入一个list</span></span><br><span class="line"><span class="comment"># 邮件正文是一个str，as_string()把MIMEText对象变成str</span></span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br><span class="line"><span class="comment">########################################################</span></span><br></pre></td></tr></table></figure>
<h5 id="发送附件"><a href="#发送附件" class="headerlink" title="发送附件"></a>发送附件</h5><p>带附件的邮件可以看做包含若干部分的邮件：文本和各个附件本身，所以，可以构造一个<span style="color:red">MIMEMultipart</span>对象代表邮件本身，然后往里面加上一个MIMEText作为邮件正文，再继续往里面加上表示附件的MIMEBase附件对象即可；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email <span class="keyword">import</span> encoders</span><br><span class="line"><span class="keyword">from</span> email.mime.base <span class="keyword">import</span> MIMEBase</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> parseaddr, formataddr</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化一个邮件地址(真实姓名+邮件地址)</span></span><br><span class="line"><span class="comment"># (注意不能简单地传入name &lt;addr@example.com&gt;,如果包含中文，需要通过Header对象进行编码)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_format_addr</span><span class="params">(s)</span>:</span></span><br><span class="line">    name, addr = parseaddr(s)</span><br><span class="line">    <span class="keyword">return</span> formataddr((Header(name, <span class="string">'utf-8'</span>).encode(), addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 用户邮件服务信息配置 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 通过SMTP发出去</span></span><br><span class="line"><span class="comment"># 输入Email地址和口令:</span></span><br><span class="line"><span class="comment"># from_addr = input('From: ')</span></span><br><span class="line">from_addr = <span class="string">'xxx@163.com'</span></span><br><span class="line"><span class="comment"># password = input('Password: ')</span></span><br><span class="line">password = <span class="string">'xxx'</span></span><br><span class="line"><span class="comment"># 输入收件人地址:</span></span><br><span class="line"><span class="comment"># msg['To']接收的是字符串而不是list，如果有多个邮件地址，用,分隔即可。</span></span><br><span class="line"><span class="comment"># to_addr = input('To: ')</span></span><br><span class="line">to_addr = <span class="string">'xxx@qq.com'</span></span><br><span class="line"><span class="comment"># 输入SMTP服务器地址:</span></span><br><span class="line"><span class="comment"># smtp_server = input('SMTP server: ')</span></span><br><span class="line">smtp_server = <span class="string">'smtp.163.com'</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 构造邮件内容 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 邮件对象:</span></span><br><span class="line">msg = MIMEMultipart()</span><br><span class="line"><span class="comment"># 添加发件人</span></span><br><span class="line">msg[<span class="string">'From'</span>] = _format_addr(<span class="string">'发件人姓名 &lt;%s&gt;'</span> % from_addr)</span><br><span class="line"><span class="comment"># 添加收件人姓名可能被邮件服务商替换成注册用户名</span></span><br><span class="line">msg[<span class="string">'To'</span>] = _format_addr(<span class="string">'收件人姓名 &lt;%s&gt;'</span> % to_addr)</span><br><span class="line"><span class="comment"># 添加邮件标题</span></span><br><span class="line">msg[<span class="string">'Subject'</span>] = Header(<span class="string">'邮件标题'</span>, <span class="string">'utf-8'</span>).encode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加邮件正文是MIMEText:</span></span><br><span class="line">msg.attach(MIMEText(<span class="string">'send with file...'</span>, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加附件就是加上一个MIMEBase，从本地读取一个图片:</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./taylor_swift.jpg'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="comment"># 设置附件的MIME和文件名，这里是png类型:</span></span><br><span class="line">    mime = MIMEBase(<span class="string">'image'</span>, <span class="string">'jpg'</span>, filename=<span class="string">'taylor_swift.png'</span>)</span><br><span class="line">    <span class="comment"># 加上必要的头信息:</span></span><br><span class="line">    mime.add_header(<span class="string">'Content-Disposition'</span>, <span class="string">'attachment'</span>, filename=<span class="string">'taylor_swift.png'</span>)</span><br><span class="line">    mime.add_header(<span class="string">'Content-ID'</span>, <span class="string">'&lt;0&gt;'</span>)</span><br><span class="line">    mime.add_header(<span class="string">'X-Attachment-Id'</span>, <span class="string">'0'</span>)</span><br><span class="line">    <span class="comment"># 把附件的内容读进来:</span></span><br><span class="line">    mime.set_payload(f.read())</span><br><span class="line">    <span class="comment"># 用Base64编码:</span></span><br><span class="line">    encoders.encode_base64(mime)</span><br><span class="line">    <span class="comment"># 添加到MIMEMultipart:</span></span><br><span class="line">    msg.attach(mime)</span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># 发邮件服务 #</span></span><br><span class="line"><span class="comment">########################################################</span></span><br><span class="line"><span class="comment"># SMTP协议默认端口是25</span></span><br><span class="line">server = smtplib.SMTP(smtp_server, <span class="number">25</span>)</span><br><span class="line"><span class="comment"># 打印出和SMTP服务器交互的所有信息</span></span><br><span class="line">server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># login()方法用来登录SMTP服务器</span></span><br><span class="line">server.login(from_addr, password)</span><br><span class="line"><span class="comment"># 发邮件</span></span><br><span class="line"><span class="comment"># 由于可以一次发给多个人，所以传入一个list</span></span><br><span class="line"><span class="comment"># 邮件正文是一个str，as_string()把MIMEText对象变成str</span></span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br><span class="line"><span class="comment">########################################################</span></span><br></pre></td></tr></table></figure>
<h5 id="发送图片"><a href="#发送图片" class="headerlink" title="发送图片"></a>发送图片</h5><p>邮件服务商一般自动屏蔽邮件正文的图片，如果将图片添加邮件html正文，需要先上传图片，然后按照顺序编号cid:x引用图片即可；</p>
<p>在上传附件的代码后添加如下代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msg.attach(MIMEText(<span class="string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello&lt;/h1&gt;'</span> +</span><br><span class="line">                    <span class="string">'&lt;p&gt;&lt;img src="cid:0"&gt;&lt;/p&gt;'</span> +</span><br><span class="line">                    <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span>, <span class="string">'html'</span>, <span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="同时支持HTML和Plain格式"><a href="#同时支持HTML和Plain格式" class="headerlink" title="同时支持HTML和Plain格式"></a>同时支持HTML和Plain格式</h5><p>如果我们发送HTML邮件，收件人通过浏览器或者Outlook之类的软件是可以正常浏览邮件内容的，但是，如果收件人使用的设备太古老，查看不了HTML邮件怎么办？</p>
<p>办法是在发送HTML的同时再附加一个纯文本，如果收件人无法查看HTML格式的邮件，就可以自动降级查看纯文本邮件。</p>
<p>利用MIMEMultipart就可以组合一个HTML和Plain，要注意指定subtype是alternative：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msg = MIMEMultipart(<span class="string">'alternative'</span>)</span><br><span class="line">msg[<span class="string">'From'</span>] = ...</span><br><span class="line">msg[<span class="string">'To'</span>] = ...</span><br><span class="line">msg[<span class="string">'Subject'</span>] = ...</span><br><span class="line"></span><br><span class="line">msg.attach(MIMEText(<span class="string">'hello'</span>, <span class="string">'plain'</span>, <span class="string">'utf-8'</span>))</span><br><span class="line">msg.attach(MIMEText(<span class="string">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span>, <span class="string">'html'</span>, <span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># 正常发送msg对象...</span></span><br></pre></td></tr></table></figure>
<h5 id="加密SMTP"><a href="#加密SMTP" class="headerlink" title="加密SMTP"></a>加密SMTP</h5><p>使用标准的25端口连接SMTP服务器时，使用的是明文传输，发送邮件的整个过程可能会被窃听。要更安全地发送邮件，可以加密SMTP会话，实际上就是先创建SSL安全连接，然后再使用SMTP协议发送邮件。</p>
<p><span style="color:red">只需要在创建SMTP对象后，立刻调用starttls()方法，就创建了安全连接。</span></p>
<h6 id="示例-25"><a href="#示例-25" class="headerlink" title="示例"></a>示例</h6><p>某些邮件服务商，例如Gmail，提供的SMTP服务必须要加密传输。我们来看看如何通过Gmail提供的安全SMTP发送邮件。<br>必须知道，Gmail的SMTP端口是587，因此，修改代码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">smtp_server = <span class="string">'smtp.gmail.com'</span></span><br><span class="line">smtp_port = <span class="number">587</span></span><br><span class="line">server = smtplib.SMTP(smtp_server, smtp_port)</span><br><span class="line">server.starttls()</span><br><span class="line"><span class="comment"># 剩下的代码和前面的一模一样:</span></span><br><span class="line">server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h5 id="SMTP发件总结"><a href="#SMTP发件总结" class="headerlink" title="SMTP发件总结"></a>SMTP发件总结</h5><p>使用Python的smtplib发送邮件十分简单，只要掌握了各种邮件类型的构造方法，正确设置好邮件头，就可以顺利发出。</p>
<p>构造一个邮件对象就是一个Messag对象，如果构造一个MIMEText对象，就表示一个文本邮件对象，如果构造一个MIMEImage对象，就表示一个作为附件的图片，要把多个对象组合起来，就用MIMEMultipart对象，而MIMEBase可以表示任何对象。它们的继承关系如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Message</span><br><span class="line">+- MIMEBase</span><br><span class="line">   +- MIMEMultipart</span><br><span class="line">   +- MIMENonMultipart</span><br><span class="line">      +- MIMEMessage</span><br><span class="line">      +- MIMEText</span><br><span class="line">      +- MIMEImage</span><br></pre></td></tr></table></figure>
<p>这种嵌套关系就可以构造出任意复杂的邮件。你可以通<a href="https://docs.python.org/3/library/email.mime.html" target="_blank" rel="noopener">过email.mime文档</a>查看它们所在的包以及详细的用法。</p>
<h4 id="POP3收取邮件"><a href="#POP3收取邮件" class="headerlink" title="POP3收取邮件"></a>POP3收取邮件</h4><p>收取邮件就是编写一个MUA作为客户端，从MDA把邮件获取到用户的电脑或者手机上。收取邮件最常用的协议是POP协议，目前版本号是3，俗称POP3。</p>
<p>Python内置一个poplib模块，实现了POP3协议，可以直接用来收邮件。</p>
<h5 id="收邮件"><a href="#收邮件" class="headerlink" title="收邮件"></a>收邮件</h5><blockquote>
<p>注意到POP3协议收取的不是一个已经可以阅读的邮件本身，而是邮件的原始文本，这和SMTP协议很像，SMTP发送的也是经过编码后的一大段文本。</p>
</blockquote>
<p>要把POP3收取的文本变成可以阅读的邮件，还需要用email模块提供的各种类来解析原始文本，变成可阅读的邮件对象。</p>
<p>收取邮件分两步：</p>
<ol>
<li>用poplib把邮件的原始文本下载到本地；</li>
<li>用email解析原始文本，还原为邮件对象。</li>
</ol>
<p>用Python的poplib模块收取邮件分两步：第一步是用POP3协议把邮件获取到本地，第二步是用email模块把原始邮件解析为Message对象，然后，用适当的形式把邮件内容展示给用户即可。</p>
<h5 id="通过POP3获取邮件"><a href="#通过POP3获取邮件" class="headerlink" title="通过POP3获取邮件"></a>通过POP3获取邮件</h5><p>POP3协议本身很简单，以下面的代码为例，我们来获取最新的一封邮件内容：</p>
<p>用POP3获取邮件其实很简单，要获取所有邮件，只需要循环使用retr()把每一封邮件内容拿到即可。真正麻烦的是把邮件的原始内容解析为可以阅读的邮件对象。</p>
<p>如下获取邮件的代码（包含删除邮件）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> poplib</span><br><span class="line"><span class="keyword">from</span> email.parser <span class="keyword">import</span> Parser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.输入邮件地址, 口令和POP3服务器地址:</span></span><br><span class="line">email = input(<span class="string">'Email: '</span>)</span><br><span class="line">password = input(<span class="string">'Password: '</span>)</span><br><span class="line">pop3_server = input(<span class="string">'POP3 server: '</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.连接到POP3服务器:</span></span><br><span class="line">server = poplib.POP3(pop3_server)</span><br><span class="line"><span class="comment"># 可以打开或关闭调试信息:</span></span><br><span class="line">server.set_debuglevel(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 可选:打印POP3服务器的欢迎文字:</span></span><br><span class="line">print(server.getwelcome().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 身份认证:</span></span><br><span class="line">server.user(email)</span><br><span class="line">server.pass_(password)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.stat()返回邮件数量和占用空间:</span></span><br><span class="line">print(<span class="string">'Messages: 邮件数量：%s 占用空间: %s'</span> % server.stat())</span><br><span class="line"><span class="comment"># list()返回所有邮件的编号，编号即索引从1开始:</span></span><br><span class="line">resp, mails, octets = server.list()</span><br><span class="line"><span class="comment"># 可以查看返回的列表类似[b'1 82923', b'2 2184', ...]，内容为邮件编号和占用空间；</span></span><br><span class="line">print(<span class="string">'邮件列表'</span>,mails)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取最新一封邮件, 注意索引号从1开始:</span></span><br><span class="line">index = len(mails)</span><br><span class="line">resp, lines, octets = server.retr(index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># lines存储了邮件的原始文本的每一行,</span></span><br><span class="line"><span class="comment"># 可以获得整个邮件的原始文本:</span></span><br><span class="line">msg_content = <span class="string">b'\r\n'</span>.join(lines).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># print('邮件原始内容为：', msg_content)</span></span><br><span class="line"><span class="comment"># 稍后解析出邮件:</span></span><br><span class="line">msg = Parser().parsestr(msg_content)</span><br><span class="line"><span class="comment"># print('邮件原始内容为：', msg)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以根据邮件索引号直接从服务器删除邮件:</span></span><br><span class="line"><span class="comment"># server.dele(index)</span></span><br><span class="line"><span class="comment"># 关闭连接:</span></span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure>
<h5 id="解析邮件"><a href="#解析邮件" class="headerlink" title="解析邮件"></a>解析邮件</h5><p>解析邮件的过程和上一节构造邮件正好相反，因此，先导入必要的模块，只需要一行代码就可以把邮件内容解析为Message对象：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.parser <span class="keyword">import</span> Parser</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> decode_header</span><br><span class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> parseaddr</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> poplib</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">msg = Parser().parsestr(msg_content)</span><br></pre></td></tr></table></figure>
<p>但是这个Message对象本身可能是一个MIMEMultipart对象，即包含嵌套的其他MIMEBase对象，嵌套可能还不止一层。<br>所以我们要递归地打印出邮件Message对象的层次结构：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解码邮件内容</span></span><br><span class="line"><span class="comment"># 邮件的Subject或者Email中包含的名字都是经过编码后的str，要正常显示，就必须decode：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_str</span><span class="params">(s)</span>:</span></span><br><span class="line">    value, charset = decode_header(s)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> charset:</span><br><span class="line">        value = value.decode(charset)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本邮件的内容也是str，还需要检测编码，否则，非UTF-8编码的邮件都无法正常显示：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guess_charset</span><span class="params">(msg)</span>:</span></span><br><span class="line">    charset = msg.get_charset()</span><br><span class="line">    <span class="keyword">if</span> charset <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        content_type = msg.get(<span class="string">'Content-Type'</span>, <span class="string">''</span>).lower()</span><br><span class="line">        pos = content_type.find(<span class="string">'charset='</span>)</span><br><span class="line">        <span class="keyword">if</span> pos &gt;= <span class="number">0</span>:</span><br><span class="line">            charset = content_type[pos + <span class="number">8</span>:].strip()</span><br><span class="line">    <span class="keyword">return</span> charset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印出邮件Message对象的层次结构</span></span><br><span class="line"><span class="comment"># indent用于缩进显示:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_info</span><span class="params">(msg, indent=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> indent == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">'------------打印邮件简介------------'</span>)</span><br><span class="line">        <span class="keyword">for</span> header <span class="keyword">in</span> [<span class="string">'From'</span>, <span class="string">'To'</span>, <span class="string">'Subject'</span>]:</span><br><span class="line">            value = msg.get(header, <span class="string">''</span>)</span><br><span class="line">            <span class="keyword">if</span> value:</span><br><span class="line">                <span class="keyword">if</span> header == <span class="string">'Subject'</span>:</span><br><span class="line">                    value = decode_str(value)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    hdr, addr = parseaddr(value)</span><br><span class="line">                    name = decode_str(hdr)</span><br><span class="line">                    value = <span class="string">u'%s &lt;%s&gt;'</span> % (name, addr)</span><br><span class="line">            print(<span class="string">'%s%s: %s'</span> % (<span class="string">'  '</span> * indent, header, value))</span><br><span class="line">        print(<span class="string">'------------打印邮件简介-end-----------'</span>)</span><br><span class="line">    <span class="keyword">if</span> msg.is_multipart():</span><br><span class="line">        parts = msg.get_payload()</span><br><span class="line">        <span class="keyword">for</span> n, part <span class="keyword">in</span> enumerate(parts):</span><br><span class="line">            print(<span class="string">'%spart %s'</span> % (<span class="string">'  '</span> * indent, n))</span><br><span class="line">            print(<span class="string">'%s--------------------'</span> % (<span class="string">'  '</span> * indent))</span><br><span class="line">            print_info(part, indent + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        content_type = msg.get_content_type()</span><br><span class="line">        <span class="keyword">if</span> content_type == <span class="string">'text/plain'</span> <span class="keyword">or</span> content_type == <span class="string">'text/html'</span>:</span><br><span class="line">            content = msg.get_payload(decode=<span class="keyword">True</span>)</span><br><span class="line">            charset = guess_charset(msg)</span><br><span class="line">            <span class="keyword">if</span> charset:</span><br><span class="line">                content = content.decode(charset)</span><br><span class="line">            print(<span class="string">'%sText: %s'</span> % (<span class="string">'  '</span> * indent, content + <span class="string">'...'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'%sAttachment: %s'</span> % (<span class="string">'  '</span> * indent, content_type))</span><br></pre></td></tr></table></figure>
<h3 id="数据的存储"><a href="#数据的存储" class="headerlink" title="数据的存储"></a>数据的存储</h3><p>定义数据的存储格式，主要有以下方式：</p>
<ul>
<li>文本文件存储：每条数据一行，字段用逗号隔开；</li>
<li>json文本文件存储：数据以json的格式保存本地；</li>
<li>SQLite</li>
<li>MySQL</li>
</ul>
<h4 id="SQLite"><a href="#SQLite" class="headerlink" title="SQLite"></a>SQLite</h4><p>SQLite是一种嵌入式数据库，它的数据库就是一个文件。由于SQLite本身是C写的，而且体积很小，所以，经常被集成到各种应用程序中，甚至在iOS和Android的App中都可以集成。</p>
<h5 id="使用SQLite"><a href="#使用SQLite" class="headerlink" title="使用SQLite"></a>使用SQLite</h5><blockquote>
<p>Python就内置了SQLite3，所以，在Python中使用SQLite，不需要安装任何东西，直接使用。</p>
</blockquote>
<ul>
<li>在Python中操作数据库时，要先导入数据库对应的驱动，然后，通过Connection对象和Cursor对象操作数据。</li>
<li>要确保打开的Connection对象和Cursor对象都正确地被关闭，否则，资源就会泄露。</li>
<li>使用try:…except:…finally:…确保关闭掉Connection对象和Cursor对象；</li>
<li>必须提交事务，修改的操作才会生效；</li>
<li>SQLite的sql中的参数占位符是问号?;</li>
<li>python操作数据库查询表的结果是list，list的每一个元素是tuple；</li>
</ul>
<p><span style="color:red">示例代码如下：</span></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入SQLite驱动:</span></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="comment"># 连接到SQLite数据库</span></span><br><span class="line"><span class="comment"># 数据库文件是test.db</span></span><br><span class="line"><span class="comment"># 如果文件不存在，会自动在当前目录创建:</span></span><br><span class="line">conn = sqlite3.connect(<span class="string">'test_sqlite.db'</span>)</span><br><span class="line"><span class="comment"># 创建一个Cursor:</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行一条SQL语句，创建user表:</span></span><br><span class="line">cursor.execute(<span class="string">'create table user (id varchar(20) primary key, name varchar(20))'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续执行一条SQL语句，插入一条记录:</span></span><br><span class="line">cursor.execute(<span class="string">"insert into user (id, name) values ('1', 'zhangsan')"</span>)</span><br><span class="line">cursor.execute(<span class="string">"insert into user (id, name) values ('2', 'lisi')"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过rowcount获得插入的行数:</span></span><br><span class="line">print(cursor.rowcount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行查询语句:</span></span><br><span class="line">cursor.execute(<span class="string">'select * from user where id=?'</span>, (<span class="string">'1'</span>,))</span><br><span class="line"><span class="comment"># 获得查询结果集:</span></span><br><span class="line">values = cursor.fetchall()</span><br><span class="line">print(values)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭Cursor:</span></span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交事务(必须提交事务，修改的操作才会生效)</span></span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭Connection:</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>如果SQL语句带有参数，那么需要把参数按照位置传递给execute()方法，有几个?占位符就必须对应几个参数，例如：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">'select * from user where name=? and pwd=?'</span>, (<span class="string">'abc'</span>, <span class="string">'password'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><h5 id="安装MySQL驱动"><a href="#安装MySQL驱动" class="headerlink" title="安装MySQL驱动"></a>安装MySQL驱动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//mysql官方驱动</span><br><span class="line">// --allow-external允许外部地址的标签，只有打上该标签pip方可下载外部地址模块</span><br><span class="line">pip install mysql-connector-python --allow-external mysql-connector-python</span><br><span class="line">//如果加--allow-external失败，就去掉</span><br><span class="line">pip install mysql-connector-python</span><br><span class="line"></span><br><span class="line">//如果上面的命令安装失败，可以试试另一个驱动：</span><br><span class="line">pip install mysql-connector</span><br></pre></td></tr></table></figure>
<h5 id="操作MySQL"><a href="#操作MySQL" class="headerlink" title="操作MySQL"></a>操作MySQL</h5><ul>
<li>执行INSERT等操作后要调用commit()提交事务；</li>
<li>操作MySQL同操作Sqlite相同，但是MySQL的SQL中的参数占位符是%s。</li>
</ul>
<p><span style="color:red">示例代码如下：</span></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 导入MySQL驱动:</span></span><br><span class="line"><span class="keyword">import</span> mysql.connector</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 连接数据库</span></span><br><span class="line">config = &#123;</span><br><span class="line">    <span class="string">'host'</span>: <span class="string">'localhost'</span>,</span><br><span class="line">    <span class="string">'user'</span>: <span class="string">'root'</span>,</span><br><span class="line">    <span class="string">'password'</span>: <span class="string">'123456'</span>,</span><br><span class="line">    <span class="string">'database'</span>: <span class="string">'test'</span>,</span><br><span class="line">    <span class="string">'port'</span>: <span class="number">3306</span>,</span><br><span class="line">    <span class="string">'charset'</span>: <span class="string">'utf8'</span></span><br><span class="line">&#125;</span><br><span class="line">conn = mysql.connector.connect(**config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 初见cursor对象操作数据库</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"><span class="comment"># 4. 创建user表:</span></span><br><span class="line">cursor.execute(<span class="string">'create table user (id varchar(20) primary key, name varchar(20))'</span>)</span><br><span class="line"><span class="comment"># 5. 插入一行记录，注意MySQL的占位符是%s:</span></span><br><span class="line">cursor.execute(<span class="string">'insert into user (id, name) values (%s, %s)'</span>, [<span class="string">'1'</span>, <span class="string">'Michael'</span>])</span><br><span class="line">print(cursor.rowcount)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 提交事务（必须提交事务才能修改数据）:</span></span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line"><span class="comment"># 运行查询:</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">'select * from user where id = %s'</span>, (<span class="string">'1'</span>,))</span><br><span class="line">values = cursor.fetchall()</span><br><span class="line">print(values)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭Cursor和Connection:</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<h4 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h4><p>ORM即Object-Relational Mapping，把关系数据库的表结构映射到对象上。ORM框架的作用就是把数据库表的一行记录与一个对象互相做自动转换。</p>
<h5 id="SQLAlchemy"><a href="#SQLAlchemy" class="headerlink" title="SQLAlchemy"></a>SQLAlchemy</h5><p>在Python中，最有名的ORM框架是SQLAlchemy。</p>
<h6 id="安装-4"><a href="#安装-4" class="headerlink" title="安装"></a>安装</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install sqlalchemy</span><br></pre></td></tr></table></figure>
<h6 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h6><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 导入:</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, String, create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建对象的基类:</span></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 定义User对象:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="comment"># 表的名字:</span></span><br><span class="line">    __tablename__ = <span class="string">'user'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 表的结构:</span></span><br><span class="line">    id = Column(String(<span class="number">20</span>), primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 初始化数据库连接: create_engine('数据库类型+数据库驱动名称://用户名:口令@机器地址:端口号/数据库名')</span></span><br><span class="line">engine = create_engine(<span class="string">'mysql+mysqlconnector://root:123456@localhost:3306/test'</span>)</span><br><span class="line"><span class="comment"># 5. 创建DBSession类型(DBSession对象可视为当前数据库连接):</span></span><br><span class="line">DBSession = sessionmaker(bind=engine)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. ORM对数据库进行操作</span></span><br><span class="line"><span class="comment"># 6.1 利用ORM:向数据库表中添加一行记录</span></span><br><span class="line"><span class="comment"># 创建session对象:</span></span><br><span class="line">session = DBSession()</span><br><span class="line"><span class="comment"># 创建新User对象:</span></span><br><span class="line">new_user = User(id=<span class="string">'5'</span>, name=<span class="string">'Bob'</span>)</span><br><span class="line"><span class="comment"># 添加到session:</span></span><br><span class="line">session.add(new_user)</span><br><span class="line"><span class="comment"># 提交即保存到数据库:</span></span><br><span class="line">session.commit()</span><br><span class="line"><span class="comment"># 关闭session:</span></span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.2 利用ORM:向数据库表查询一行记录</span></span><br><span class="line"><span class="comment"># 创建Session:</span></span><br><span class="line">session = DBSession()</span><br><span class="line"><span class="comment"># 创建Query查询，filter是where条件，最后调用one()返回唯一行，如果调用all()则返回所有行:</span></span><br><span class="line">user = session.query(User).filter(User.id == <span class="string">'5'</span>).one()</span><br><span class="line"><span class="comment"># 打印类型和对象的name属性:</span></span><br><span class="line">print(<span class="string">'type:'</span>, type(user))</span><br><span class="line">print(<span class="string">'name:'</span>, user.name)</span><br><span class="line"><span class="comment"># 关闭Session:</span></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>
<h3 id="web开发"><a href="#web开发" class="headerlink" title="web开发"></a>web开发</h3><h4 id="HTTP状态码"><a href="#HTTP状态码" class="headerlink" title="HTTP状态码"></a>HTTP状态码</h4><p>响应代码：</p>
<ul>
<li>200表示成功；</li>
<li>3xx表示重定向；</li>
<li>4xx表示客户端发送的请求有错误；</li>
<li>5xx表示服务器端处理时发生了错误；</li>
</ul>
<h4 id="HTTP格式"><a href="#HTTP格式" class="headerlink" title="HTTP格式"></a>HTTP格式</h4><p>每个HTTP请求和响应都遵循相同的格式，一个HTTP包含Header和Body两部分，其中Body是可选的。</p>
<p>Body：</p>
<ul>
<li>Body的数据类型由Content-Type头来确定，如果是网页，Body就是文本，如果是图片，Body就是图片的二进制数据。</li>
<li>当存在Content-Encoding时，Body数据是被压缩的，最常见的压缩方式是gzip，所以，看到Content-Encoding: gzip时，需要将Body数据先解压缩，才能得到真正的数据。压缩的目的在于减少Body的大小，加快网络传输。</li>
</ul>
<h4 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h4><p>WSGI(Web Server Gateway Interface),WSGI接口定义非常简单，它只要求Web开发者实现一个函数，WSGI的处理函数，针对每个HTTP请求进行响应；</p>
<p>Python内置了一个WSGI服务器，这个模块叫wsgiref，它是用纯Python编写的WSGI服务器的参考实现。所谓“参考实现”是指该实现完全符合WSGI标准，但是<span style="color:red">不考虑任何运行效率，仅供开发和测试使用</span>。</p>
<ul>
<li>无论多么复杂的Web应用程序，入口都是一个WSGI处理函数。HTTP请求的所有输入信息都可以通过environ获得，HTTP响应的输出都可以通过start_response()加上函数返回值作为Body。</li>
<li>复杂的Web应用程序，光靠一个WSGI函数来处理还是太底层了，我们需要在WSGI之上再抽象出<span style="color:red">Web框架</span>，进一步简化Web开发。</li>
</ul>
<h5 id="http请求信息"><a href="#http请求信息" class="headerlink" title="http请求信息"></a>http请求信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//请求方式：GET/POST/PUT/DELETE</span><br><span class="line">method = environ[&apos;REQUEST_METHOD&apos;]</span><br><span class="line">//请求的地址，返回一个list</span><br><span class="line">path = environ[&apos;PATH_INFO&apos;]</span><br></pre></td></tr></table></figure>
<h5 id="根据请求响应"><a href="#根据请求响应" class="headerlink" title="根据请求响应"></a>根据请求响应</h5><p>如果通过判断请求信息来响应结果，项目将难以维护，此时就需要web框架了；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def application(environ, start_response):</span><br><span class="line">    method = environ[&apos;REQUEST_METHOD&apos;]</span><br><span class="line">    path = environ[&apos;PATH_INFO&apos;]</span><br><span class="line">    if method==&apos;GET&apos; and path==&apos;/&apos;:</span><br><span class="line">        return handle_home(environ, start_response)</span><br><span class="line">    if method==&apos;POST&apos; and path=&apos;/signin&apos;:</span><br><span class="line">        return handle_signin(environ, start_response)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h5 id="示例-26"><a href="#示例-26" class="headerlink" title="示例"></a>示例</h5><p>如下，hello.py文件中定义用来响应客户端请求的函数，server.py利用wsgiref定义一个服务监听请求，响应application函数返回的结果；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    start_response(<span class="string">'200 OK'</span>, [(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>)])</span><br><span class="line">    body = <span class="string">'&lt;h1&gt;Hello, %s!&lt;/h1&gt;'</span> % (environ[<span class="string">'PATH_INFO'</span>][<span class="number">1</span>:] <span class="keyword">or</span> <span class="string">'web'</span>)</span><br><span class="line">    <span class="keyword">return</span> [body.encode(<span class="string">'utf-8'</span>)]</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从wsgiref模块导入:</span></span><br><span class="line"><span class="keyword">from</span> wsgiref.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"><span class="comment"># 导入我们自己编写的application函数:</span></span><br><span class="line"><span class="keyword">from</span> hello <span class="keyword">import</span> application</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个服务器，IP地址为空，端口是8000，处理函数是application:</span></span><br><span class="line">httpd = make_server(<span class="string">''</span>, <span class="number">8000</span>, application)</span><br><span class="line">print(<span class="string">'Serving HTTP on port 8000...'</span>)</span><br><span class="line"><span class="comment"># 开始监听HTTP请求:</span></span><br><span class="line">httpd.serve_forever()</span><br></pre></td></tr></table></figure>
<h4 id="web框架"><a href="#web框架" class="headerlink" title="web框架"></a>web框架</h4><ul>
<li>Flask: 轻量级 Web 应用框架(hot);</li>
<li>Django：全能型Web框架；</li>
<li>web.py：一个小巧的Web框架；</li>
<li>Bottle：和Flask类似的Web框架；</li>
<li>Tornado：Facebook的开源异步Web框架。</li>
</ul>
<h3 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h3><blockquote>
<p><a href="https://github.com/pallets/flask" target="_blank" rel="noopener">Flask</a> 是Python比较流行的Web框架;</p>
</blockquote>
<p>Flask是一个使用 Python 编写的轻量级 Web 应用框架。其 WSGI 工具箱采用 Werkzeug ，模板引擎则使用 Jinja2。Flask没有默认使用的数据库、窗体验证工具。用 extension增加其他功能。</p>
<p>然而，Flask保留了扩增的弹性，可以用Flask-extension加入这些功能：ORM、窗体验证工具、文件上传、各种开放式身份验证技术。此文章时的最新版本为1.0.2。</p>
<h4 id="安装Flask"><a href="#安装Flask" class="headerlink" title="安装Flask"></a>安装Flask</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U Flask</span><br></pre></td></tr></table></figure>
<h4 id="WebAPI"><a href="#WebAPI" class="headerlink" title="WebAPI"></a>WebAPI</h4><h5 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h5><ul>
<li>Flask通过Python的装饰器在内部自动地把URL和处理函数给关联起来;</li>
<li>Flask自带的Server在端口5000上监听;</li>
<li>Flask通过request.form[‘name’]来获取表单的内容。</li>
</ul>
<h5 id="示例-27"><a href="#示例-27" class="headerlink" title="示例"></a>示例</h5><p>Flask框架，编写接口来支持GET/POST请求返回html;</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;Home&lt;/h1&gt;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin_form</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'''&lt;form action="/signin" method="post"&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;input name="username"&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;input name="password" type="password"&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;p&gt;&lt;button type="submit"&gt;Sign In&lt;/button&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">              &lt;/form&gt;'''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 需要从request对象读取表单内容：</span></span><br><span class="line">    <span class="keyword">if</span> request.form[<span class="string">'username'</span>] == <span class="string">'admin'</span> <span class="keyword">and</span> request.form[<span class="string">'password'</span>] == <span class="string">'password'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;h3&gt;Hello, admin!&lt;/h3&gt;'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h3&gt;Bad username or password.&lt;/h3&gt;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h4 id="jinja2模板技术"><a href="#jinja2模板技术" class="headerlink" title="jinja2模板技术"></a>jinja2模板技术</h4><p>模板技术，我们以MVC模式进行开发：</p>
<ol>
<li>Controller层：Controller负责业务逻辑，即处理请求URL的函数；</li>
<li>View层：HTML文档作为view层的UI模板，嵌入了一些变量<span style="color:red"></span> 和指令，根据我们动态传入的数据，替换后，得到最终的HTML，发送给用户；</li>
<li>Model层：是用来传给View的数据，通常dict作为Model；</li>
</ol>
<p>通过MVC，我们在Python代码中处理M：Model和C：Controller，而V：View是通过模板处理的，这样，我们就成功地把Python代码和HTML代码最大限度地分离了。</p>
<h5 id="jinja2"><a href="#jinja2" class="headerlink" title="jinja2"></a>jinja2</h5><ul>
<li>Flask通过render_template()函数来实现模板的渲染，具体html中支持模板渲染需要是jinja2。</li>
<li>和Web框架类似，Python的模板也有很多种。Flask默认支持的模板是jinja2，所以我们先直接安装jinja2：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install jinja2</span><br></pre></td></tr></table></figure>
<h5 id="jinja2-API"><a href="#jinja2-API" class="headerlink" title="jinja2-API"></a>jinja2-API</h5><p>在Jinja2模板中:</p>
<ul>
<li>模板文件：一定要把html模板放到templates目录下，templates和server.py服务文件在同级目录下；</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">project</span><br><span class="line">|- server.py</span><br><span class="line">|- templates</span><br><span class="line">    |- home.html</span><br><span class="line">    |- signin.html</span><br></pre></td></tr></table></figure>
<ul>
<li>变量：用表示一个需要替换的变量。</li>
<li>语法指令：很多时候，还需要循环、条件判断等指令语句，在Jinja2中，用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ... %&#125;</span><br></pre></td></tr></table></figure>
<p>表示指令，逻辑判断的语法就写在指令中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--比如循环输出的代码--&gt;</span></span><br><span class="line">&#123;% for i in page_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/page/&#123;&#123; i &#125;&#125;"</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<h5 id="示例-28"><a href="#示例-28" class="headerlink" title="示例"></a>示例</h5><p>使用mvc模式简单的实现一个用户登录的功能！</p>
<p>1.编写模板(templates):</p>
<ul>
<li>首页模板home.html:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用来显示首页的模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">"font-style:italic"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>登录页面模板from.html:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--用来显示登录表单的模板--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Please Sign In<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% if message %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color:red"</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/signin"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Please sign in:<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; username &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">type</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Sign In<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>登录成功页面模板signin-ok.html:</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--登录成功的模板：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome, &#123;&#123; username &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome, &#123;&#123; username &#125;&#125;!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.编写Controller/Model层：server.py</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'home.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin_form</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'form.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/signin', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span><span class="params">()</span>:</span></span><br><span class="line">    username = request.form[<span class="string">'username'</span>]</span><br><span class="line">    password = request.form[<span class="string">'password'</span>]</span><br><span class="line">    <span class="keyword">if</span> username == <span class="string">'admin'</span> <span class="keyword">and</span> password == <span class="string">'password'</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'signin-ok.html'</span>, username=username)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'form.html'</span>, message=<span class="string">'Bad username or password'</span>, username=username)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h4 id="其它模板框架"><a href="#其它模板框架" class="headerlink" title="其它模板框架"></a>其它模板框架</h4><p>除了Jinja2，常见的模板还有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Mako：用&lt;% ... %&gt;和$&#123;xxx&#125;的一个模板；</span><br><span class="line">- Cheetah：也是用&lt;% ... %&gt;和$&#123;xxx&#125;的一个模板；</span><br><span class="line">- Django：Django是一站式框架，内置一个用&#123;% ... %&#125;和&#123;&#123; xxx &#125;&#125;的模板。</span><br></pre></td></tr></table></figure>
<h3 id="异步IO"><a href="#异步IO" class="headerlink" title="异步IO"></a>异步IO</h3><p>在IO操作的过程中，当前线程被挂起，而其他需要CPU执行的代码就无法被当前线程执行了。</p>
<p>解决IO阻塞的方法：</p>
<ol>
<li>多线程；</li>
<li>异步IO；</li>
</ol>
<h4 id="多线程解决IO阻塞"><a href="#多线程解决IO阻塞" class="headerlink" title="多线程解决IO阻塞"></a>多线程解决IO阻塞</h4><h5 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h5><p>因为一个IO操作就阻塞了当前线程，导致其他代码无法执行，使用多线程或者多进程来并发执行代码，为多个用户服务。每个用户都会分配一个线程，如果遇到IO导致线程被挂起，其他用户的线程不受影响。</p>
<h5 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h5><p>多线程和多进程的模型虽然解决了并发问题，但是系统不能无上限地增加线程。由于系统切换线程的开销也很大，所以，一旦线程数量过多，CPU的时间就花在线程切换上了，真正运行代码的时间就少了，结果导致性能严重下降。</p>
<p>由于我们要解决的问题是CPU高速执行能力和IO设备的龟速严重不匹配，多线程和多进程只是解决这一问题的一种方法。</p>
<h4 id="异步IO解决IO阻塞"><a href="#异步IO解决IO阻塞" class="headerlink" title="异步IO解决IO阻塞"></a>异步IO解决IO阻塞</h4><p>解决IO阻塞问题的另一种解决方法是异步IO。</p>
<p>在“发出IO请求”到收到“IO完成”的这段时间里，同步IO模型下，主线程只能挂起，但异步IO模型下，主线程并没有休息，而是在消息循环中继续处理其他消息。这样，在异步IO模型下，一个线程就可以同时处理多个IO请求，并且没有切换线程的操作。对于大多数IO密集型的应用程序，使用异步IO将大大提升系统的多任务处理能力。</p>
<h4 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h4><p>协程，又称微线程，纤程。英文名coroutine（协同程序）。即多个程序系统完成工作的过程；</p>
<h5 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h5><p><strong>子程序</strong></p>
<p>子程序，或者称为函数，在所有语言中都是层级调用，比如A调用B，B在执行过程中又调用了C，C执行完毕返回，B执行完毕返回，最后是A执行完毕。所以子程序调用是通过栈实现的，子程序调用总是一个入口，一次返回，调用顺序是明确的。一个线程就是执行一个子程序。</p>
<p><strong>协程和子程序</strong></p>
<p>而协程的调用和子程序不同。协程看上去也是子程序，但执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行。</p>
<h5 id="特点优势"><a href="#特点优势" class="headerlink" title="特点优势"></a>特点优势</h5><ol>
<li>协程可以看成子程序的切换，因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，因此协程有着极高的执行效率。和多线程比，线程数量越多，协程的性能优势就越明显。</li>
<li>第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</li>
<li>协程是一个线程执行，利用多核CPU最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。</li>
</ol>
<h5 id="协程的实现"><a href="#协程的实现" class="headerlink" title="协程的实现"></a>协程的实现</h5><p>Python对协程的支持是通过generator实现的。</p>
<p>在generator中，我们不但可以通过for循环来迭代，还可以不断调用next()函数获取由yield语句返回的下一个值。<span style="color:orange">Python的yield不但可以返回一个值，它还可以接收调用者发出的参数</span>。</p>
<h6 id="示例解释协程"><a href="#示例解释协程" class="headerlink" title="示例解释协程"></a>示例解释协程</h6><p>传统的生产者-消费者模型是一个线程写消息，一个线程取消息，通过锁机制控制队列和等待，但一不小心就可能死锁。<br>如果改用协程，生产者生产消息后，直接通过yield跳转到消费者开始执行，待消费者执行完毕后，切换回生产者继续生产，效率极高；</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">()</span>:</span></span><br><span class="line">    r = <span class="string">''</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        n = <span class="keyword">yield</span> r</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> n:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        print(<span class="string">'[CONSUMER] Consuming %s...'</span> % n)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        r = <span class="string">'200 OK'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">produce</span><span class="params">(c)</span>:</span></span><br><span class="line">    c.send(<span class="keyword">None</span>)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:</span><br><span class="line">        n = n + <span class="number">1</span></span><br><span class="line">        print(<span class="string">'[PRODUCER] Producing %s...'</span> % n)</span><br><span class="line">        r = c.send(n)</span><br><span class="line">        print(<span class="string">'[PRODUCER] Consumer return: %s'</span> % r)</span><br><span class="line">    c.close()</span><br><span class="line"></span><br><span class="line">c = consumer()</span><br><span class="line">produce(c)</span><br></pre></td></tr></table></figure>
<p>注意到consumer函数是一个generator，把一个consumer传入produce后：</p>
<ol>
<li>首先调用c.send(None)启动生成器；</li>
<li>然后，一旦生产了东西，通过c.send(n)切换到consumer执行；</li>
<li>consumer通过yield拿到消息，处理，又通过yield把结果传回；</li>
<li>produce拿到consumer处理的结果，继续生产下一条消息；</li>
<li>produce决定不生产了，通过c.close()关闭consumer，整个过程结束。</li>
</ol>
<p>整个流程无锁，由一个线程执行，produce和consumer协作完成任务，所以称为“协程”，而非线程的抢占式多任务。</p>
<h4 id="asyncio"><a href="#asyncio" class="headerlink" title="asyncio"></a>asyncio</h4><blockquote>
<p>asyncio是Python 3.4版本引入的标准库，直接内置了对异步IO的支持,asyncio提供了完善的异步IO支持；</p>
</blockquote>
<p><span style="color:red">asyncio可以实现单线程并发IO操作.</span></p>
<p>asyncio的编程模型就是一个消息循环。我们从asyncio模块中直接获取一个EventLoop的引用，然后把需要执行的协程扔到EventLoop中执行，就实现了异步IO。</p>
<h5 id="asyncio使用步骤"><a href="#asyncio使用步骤" class="headerlink" title="asyncio使用步骤"></a>asyncio使用步骤</h5><blockquote>
<p>用asyncio提供的@asyncio.coroutine可以把一个generator标记为coroutine类型，然后在coroutine内部用yield from异步调用另一个coroutine实现异步操作。</p>
</blockquote>
<ol>
<li>@asyncio.coroutine把一个generator函数逻辑标记为coroutine类型，处理函数的内部异步操作需要在coroutine中通过yield from完成；然后，我们就把这个coroutine扔到EventLoop中执行。</li>
<li>yield from语法可以方便地异步调用另一个耗时逻辑的coroutine；</li>
<li>coroutine类型函数的多次调用，可以封装成一组Task然后并发执行。</li>
<li>EventLoop等待asyncio.wait(tasks)并发执行多个任务；</li>
<li>关闭EventLoop；</li>
</ol>
<h5 id="asyncio并发示例"><a href="#asyncio并发示例" class="headerlink" title="asyncio并发示例"></a>asyncio并发示例</h5><p><span style="color:blue">示例1：实现并发执行两个耗时逻辑！</span></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Hello world! (%s)'</span> % threading.currentThread())</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">'Hello again! (%s)'</span> % threading.currentThread())</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">tasks = [hello(), hello()]</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<p>两个coroutine是由同一个线程并发执行的。asyncio.sleep()换成真正的IO操作，则多个coroutine就可以由一个线程并发执行。</p>
<p><span style="color:blue">示例2：用asyncio的异步网络连接来获取sina、sohu和163的网站首页!</span></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wget</span><span class="params">(host)</span>:</span></span><br><span class="line">    print(<span class="string">'wget %s...'</span> % host)</span><br><span class="line">    connect = asyncio.open_connection(host, <span class="number">80</span>)</span><br><span class="line">    reader, writer = <span class="keyword">yield</span> <span class="keyword">from</span> connect</span><br><span class="line">    header = <span class="string">'GET / HTTP/1.0\r\nHost: %s\r\n\r\n'</span> % host</span><br><span class="line">    writer.write(header.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="comment"># writer.drain()执行写操作</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> writer.drain()</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        line = <span class="keyword">yield</span> <span class="keyword">from</span> reader.readline()</span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">b'\r\n'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        print(<span class="string">'%s header &gt; %s'</span> % (host, line.decode(<span class="string">'utf-8'</span>).rstrip()))</span><br><span class="line">    <span class="comment"># Ignore the body, close the socket</span></span><br><span class="line">    writer.close()</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># 3个连接由一个线程通过coroutine并发完成。</span></span><br><span class="line">tasks = [wget(host) <span class="keyword">for</span> host <span class="keyword">in</span> [<span class="string">'www.sina.com.cn'</span>, <span class="string">'www.sohu.com'</span>, <span class="string">'www.163.com'</span>]]</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<h4 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h4><blockquote>
<p>新异步IO语法；</p>
</blockquote>
<p>为了简化并更好地标识异步IO，从Python 3.5开始引入了新的语法async和await，可以让异步执行coroutine的代码更简洁易读。</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>请注意，async和await是针对coroutine的新语法，要使用新的语法，只需要对asyncio做两步简单的替换：</p>
<ol>
<li>把@asyncio.coroutine替换为async；</li>
<li>把yield from替换为await。</li>
</ol>
<h5 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h5><p>并发执行异步任务打印hello！</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"Hello world!"</span>)</span><br><span class="line">    r = <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"Hello again!"</span>)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">tasks = [hello(), hello()]</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<h4 id="aiohttp"><a href="#aiohttp" class="headerlink" title="aiohttp"></a>aiohttp</h4><blockquote>
<p>服务器端实现单线程+coroutine并发IO操作;</p>
</blockquote>
<p>asyncio可以实现单线程并发IO操作。如果仅用在客户端，发挥的威力不大。如果把asyncio用在服务器端，例如Web服务器，由于HTTP连接就是IO操作，因此可以用单线程+coroutine实现多用户的高并发支持。</p>
<p>asyncio实现了TCP、UDP、SSL等协议，aiohttp则是基于asyncio实现的HTTP框架。</p>
<h5 id="安装aiohttp"><a href="#安装aiohttp" class="headerlink" title="安装aiohttp"></a>安装aiohttp</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install aiohttp</span><br></pre></td></tr></table></figure>
<h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p>创建aiohttp的初始化函数init()，init()也是一个coroutine，在函数中loop.create_server()则利用asyncio创建TCP服务。</p>
<h5 id="示例-29"><a href="#示例-29" class="headerlink" title="示例"></a>示例</h5><p>编写一个HTTP服务器，分别处理以下URL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/ - 首页返回b&apos;&lt;h1&gt;Index&lt;/h1&gt;&apos;；</span><br><span class="line">/hello/&#123;name&#125; - 根据URL参数返回文本hello, %s!。</span><br></pre></td></tr></table></figure>
<p>代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">from aiohttp import web</span><br><span class="line"></span><br><span class="line">async def index(request):</span><br><span class="line">    await asyncio.sleep(0.5)</span><br><span class="line">    return web.Response(body=b&apos;&lt;h1&gt;Index&lt;/h1&gt;&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def hello(request):</span><br><span class="line">    await asyncio.sleep(0.5)</span><br><span class="line">    text = &apos;&lt;h1&gt;hello, %s!&lt;/h1&gt;&apos; % request.match_info[&apos;name&apos;]</span><br><span class="line">    return web.Response(body=text.encode(&apos;utf-8&apos;))</span><br><span class="line"></span><br><span class="line">app = web.Application()</span><br><span class="line">app.router.add_routes([</span><br><span class="line">    web.get(&apos;/&apos;, index),</span><br><span class="line">    web.get(&apos;/hello/&#123;name&#125;&apos;, hello)</span><br><span class="line">])</span><br><span class="line">print(&apos;Server started at http://127.0.0.1:8080...&apos;)</span><br><span class="line">web.run_app(app)</span><br></pre></td></tr></table></figure>
<p>或者用loop:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> web</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">return</span> web.Response(body=<span class="string">b'&lt;h1&gt;Index&lt;/h1&gt;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">0.5</span>)</span><br><span class="line">    text = <span class="string">'&lt;h1&gt;hello, %s!&lt;/h1&gt;'</span> % request.match_info[<span class="string">'name'</span>]</span><br><span class="line">    <span class="keyword">return</span> web.Response(body=text.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(loop)</span>:</span></span><br><span class="line">    app = web.Application(loop=loop)</span><br><span class="line">    app.router.add_route(<span class="string">'GET'</span>, <span class="string">'/'</span>, index)</span><br><span class="line">    app.router.add_route(<span class="string">'GET'</span>, <span class="string">'/hello/&#123;name&#125;'</span>, hello)</span><br><span class="line">    srv = <span class="keyword">await</span> loop.create_server(app.make_handler(), <span class="string">'127.0.0.1'</span>, <span class="number">8000</span>)</span><br><span class="line">    print(<span class="string">'Server started at http://127.0.0.1:8000...'</span>)</span><br><span class="line">    <span class="keyword">return</span> srv</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(init(loop))</span><br><span class="line">loop.run_forever()</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/images/reward/wechat-reward-image.jpg" alt="ethancalc 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/images/reward/alipay-reward-image.jpg" alt="ethancalc 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/30/web/JavaScript/ES6转码工具babel7.x的配置/" rel="next" title="ES6转码工具babel7.x的配置">
                <i class="fa fa-chevron-left"></i> ES6转码工具babel7.x的配置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
<span class="jiathis_txt">分享到：</span>
<a class="jiathis_button_fav">收藏夹</a>
<a class="jiathis_button_copy">复制网址</a>
<a class="jiathis_button_email">邮件</a>
<a class="jiathis_button_weixin">微信</a>
<a class="jiathis_button_qzone">QQ空间</a>
<a class="jiathis_button_tqq">腾讯微博</a>
<a class="jiathis_button_douban">豆瓣</a>
<a class="jiathis_button_share">一键分享</a>

<a href="http://www.jiathis.com/share?uid=2140465" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config={
  data_track_clickback:true,
  summary:"",
  shortUrl:false,
  hideMore:false
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=" charset="utf-8"></script>
<!-- JiaThis Button END -->
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="SOHUCS"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image" src="/uploads/images/head/avatar.jpg" alt="ethancalc">
          
            <p class="site-author-name" itemprop="name">ethancalc</p>
            <p class="site-description motion-element" itemprop="description">乘清风,饮马江湖</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">35</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ethancalc" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.google.com/" title="google" target="_blank">google</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#文章概述"><span class="nav-number">1.</span> <span class="nav-text">文章概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考资料"><span class="nav-number">2.</span> <span class="nav-text">参考资料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#认识python"><span class="nav-number">3.</span> <span class="nav-text">认识python</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python代码"><span class="nav-number">3.1.</span> <span class="nav-text">python代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令行操作"><span class="nav-number">4.</span> <span class="nav-text">命令行操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#命令行信息"><span class="nav-number">4.1.</span> <span class="nav-text">命令行信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#退出控制台"><span class="nav-number">4.2.</span> <span class="nav-text">退出控制台</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#语句换行"><span class="nav-number">4.3.</span> <span class="nav-text">语句换行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#python版本信息"><span class="nav-number">4.4.</span> <span class="nav-text">python版本信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#输入输出"><span class="nav-number">4.5.</span> <span class="nav-text">输入输出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运行python文件"><span class="nav-number">4.6.</span> <span class="nav-text">运行python文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编程规范"><span class="nav-number">5.</span> <span class="nav-text">编程规范</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#语句写法注意"><span class="nav-number">5.1.</span> <span class="nav-text">语句写法注意</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量"><span class="nav-number">6.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#变量-1"><span class="nav-number">6.1.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#变量命名"><span class="nav-number">6.1.1.</span> <span class="nav-text">变量命名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量的类型"><span class="nav-number">6.1.2.</span> <span class="nav-text">变量的类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#变量内存地址"><span class="nav-number">6.1.3.</span> <span class="nav-text">变量内存地址</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#常量"><span class="nav-number">6.2.</span> <span class="nav-text">常量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运算符"><span class="nav-number">7.</span> <span class="nav-text">运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#算数运算符"><span class="nav-number">7.1.</span> <span class="nav-text">算数运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#赋值运算符"><span class="nav-number">7.2.</span> <span class="nav-text">赋值运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关系运算符"><span class="nav-number">7.3.</span> <span class="nav-text">关系运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#逻辑运算"><span class="nav-number">7.4.</span> <span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#成员运算符"><span class="nav-number">7.5.</span> <span class="nav-text">成员运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#身份运算符"><span class="nav-number">7.6.</span> <span class="nav-text">身份运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#位运算符"><span class="nav-number">7.7.</span> <span class="nav-text">位运算符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#运算符优先级"><span class="nav-number">7.8.</span> <span class="nav-text">运算符优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据类型"><span class="nav-number">8.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据类型概览"><span class="nav-number">8.1.</span> <span class="nav-text">数据类型概览</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据类型相关方法"><span class="nav-number">8.2.</span> <span class="nav-text">数据类型相关方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取数据的类型"><span class="nav-number">8.2.1.</span> <span class="nav-text">获取数据的类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#判断数据类型"><span class="nav-number">8.2.2.</span> <span class="nav-text">判断数据类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数据类型相互转换"><span class="nav-number">8.2.3.</span> <span class="nav-text">数据类型相互转换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数字"><span class="nav-number">8.3.</span> <span class="nav-text">数字</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#进制数"><span class="nav-number">8.3.1.</span> <span class="nav-text">进制数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#常见进制数"><span class="nav-number">8.3.1.1.</span> <span class="nav-text">常见进制数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#进制转换方法"><span class="nav-number">8.3.1.2.</span> <span class="nav-text">进制转换方法</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数学运算"><span class="nav-number">8.3.2.</span> <span class="nav-text">数学运算</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#保留小数"><span class="nav-number">8.3.2.1.</span> <span class="nav-text">保留小数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔类型"><span class="nav-number">8.4.</span> <span class="nav-text">布尔类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#空值"><span class="nav-number">8.5.</span> <span class="nav-text">空值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符串"><span class="nav-number">8.6.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#编码"><span class="nav-number">8.6.1.</span> <span class="nav-text">编码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#UTF-8"><span class="nav-number">8.6.1.1.</span> <span class="nav-text">UTF-8</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Python文件设置编码"><span class="nav-number">8.6.1.2.</span> <span class="nav-text">Python文件设置编码</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#转义字符"><span class="nav-number">8.6.2.</span> <span class="nav-text">转义字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#格式化字符串"><span class="nav-number">8.6.3.</span> <span class="nav-text">格式化字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#占位符-格式化字符串"><span class="nav-number">8.6.3.1.</span> <span class="nav-text">占位符%格式化字符串</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#format方法格式化字符串"><span class="nav-number">8.6.3.2.</span> <span class="nav-text">format方法格式化字符串</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字符串操作方法"><span class="nav-number">8.6.4.</span> <span class="nav-text">字符串操作方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#长度"><span class="nav-number">8.6.4.1.</span> <span class="nav-text">长度</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#乘法复制"><span class="nav-number">8.6.4.2.</span> <span class="nav-text">乘法复制</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#索引取值"><span class="nav-number">8.6.4.3.</span> <span class="nav-text">索引取值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#索引切片-截取"><span class="nav-number">8.6.4.4.</span> <span class="nav-text">索引切片(截取)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#字符索引"><span class="nav-number">8.6.4.5.</span> <span class="nav-text">字符索引</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#字符串替换"><span class="nav-number">8.6.4.6.</span> <span class="nav-text">字符串替换</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#去除左右空格"><span class="nav-number">8.6.4.7.</span> <span class="nav-text">去除左右空格</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#字符串转换"><span class="nav-number">8.6.4.8.</span> <span class="nav-text">字符串转换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#list"><span class="nav-number">8.7.</span> <span class="nav-text">list</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#列表的定义"><span class="nav-number">8.7.1.</span> <span class="nav-text">列表的定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列表的操作"><span class="nav-number">8.7.2.</span> <span class="nav-text">列表的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#CRUD操作"><span class="nav-number">8.7.2.1.</span> <span class="nav-text">CRUD操作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#列表长度"><span class="nav-number">8.7.2.2.</span> <span class="nav-text">列表长度</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#数学运算-1"><span class="nav-number">8.7.2.3.</span> <span class="nav-text">数学运算</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#截取"><span class="nav-number">8.7.2.4.</span> <span class="nav-text">截取</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#函数生成列表"><span class="nav-number">8.7.2.5.</span> <span class="nav-text">函数生成列表</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列表生成式"><span class="nav-number">8.7.3.</span> <span class="nav-text">列表生成式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#元组-tuple"><span class="nav-number">8.8.</span> <span class="nav-text">元组(tuple)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#元组定义"><span class="nav-number">8.8.1.</span> <span class="nav-text">元组定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#函数生成元组"><span class="nav-number">8.8.2.</span> <span class="nav-text">函数生成元组</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#序列"><span class="nav-number">8.9.</span> <span class="nav-text">序列</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#序列操作"><span class="nav-number">8.9.1.</span> <span class="nav-text">序列操作</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#切片-截取"><span class="nav-number">8.9.1.1.</span> <span class="nav-text">切片(截取)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#逻辑包含"><span class="nav-number">8.9.1.2.</span> <span class="nav-text">逻辑包含</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#序列内置函数"><span class="nav-number">8.9.2.</span> <span class="nav-text">序列内置函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#最大值"><span class="nav-number">8.9.2.1.</span> <span class="nav-text">最大值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#最小值"><span class="nav-number">8.9.2.2.</span> <span class="nav-text">最小值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#长度-1"><span class="nav-number">8.9.2.3.</span> <span class="nav-text">长度</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#join"><span class="nav-number">8.9.2.4.</span> <span class="nav-text">join</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#集合"><span class="nav-number">8.10.</span> <span class="nav-text">集合</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#集合的定义"><span class="nav-number">8.10.1.</span> <span class="nav-text">集合的定义</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#定义集合变量"><span class="nav-number">8.10.1.1.</span> <span class="nav-text">定义集合变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#空集合"><span class="nav-number">8.10.1.2.</span> <span class="nav-text">空集合</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集合的操作"><span class="nav-number">8.10.2.</span> <span class="nav-text">集合的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#添加"><span class="nav-number">8.10.2.1.</span> <span class="nav-text">添加</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#删除"><span class="nav-number">8.10.2.2.</span> <span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集合的运算"><span class="nav-number">8.10.3.</span> <span class="nav-text">集合的运算</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字典"><span class="nav-number">8.11.</span> <span class="nav-text">字典</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#特点"><span class="nav-number">8.11.1.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字典的定义"><span class="nav-number">8.11.2.</span> <span class="nav-text">字典的定义</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#空字典"><span class="nav-number">8.11.2.1.</span> <span class="nav-text">空字典</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例"><span class="nav-number">8.11.2.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#key的特点"><span class="nav-number">8.11.3.</span> <span class="nav-text">key的特点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#字典的操作"><span class="nav-number">8.11.4.</span> <span class="nav-text">字典的操作</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#添加-1"><span class="nav-number">8.11.4.1.</span> <span class="nav-text">添加</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#根据key获取值"><span class="nav-number">8.11.4.2.</span> <span class="nav-text">根据key获取值</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#删除key"><span class="nav-number">8.11.4.3.</span> <span class="nav-text">删除key</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#遍历字典"><span class="nav-number">8.11.5.</span> <span class="nav-text">遍历字典</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数据解构赋值"><span class="nav-number">8.12.</span> <span class="nav-text">数据解构赋值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#生成器"><span class="nav-number">8.13.</span> <span class="nav-text">生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#表达式生成器"><span class="nav-number">8.13.1.</span> <span class="nav-text">表达式生成器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#函数生成器"><span class="nav-number">8.13.2.</span> <span class="nav-text">函数生成器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#定义示例"><span class="nav-number">8.13.2.1.</span> <span class="nav-text">定义示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#函数返回值"><span class="nav-number">8.13.2.2.</span> <span class="nav-text">函数返回值</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#生成器迭代"><span class="nav-number">8.13.3.</span> <span class="nav-text">生成器迭代</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器"><span class="nav-number">8.14.</span> <span class="nav-text">迭代器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Iterable"><span class="nav-number">8.14.1.</span> <span class="nav-text">Iterable</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Iterable对象判断"><span class="nav-number">8.14.1.1.</span> <span class="nav-text">Iterable对象判断</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Iterator"><span class="nav-number">8.14.2.</span> <span class="nav-text">Iterator</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Iterator对象判断"><span class="nav-number">8.14.2.1.</span> <span class="nav-text">Iterator对象判断</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Iterable转Iterator"><span class="nav-number">8.14.2.2.</span> <span class="nav-text">Iterable转Iterator</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Iterator数据流对象"><span class="nav-number">8.14.3.</span> <span class="nav-text">Iterator数据流对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件控制语句"><span class="nav-number">9.</span> <span class="nav-text">条件控制语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#条件判断"><span class="nav-number">9.1.</span> <span class="nav-text">条件判断</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法"><span class="nav-number">9.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-1"><span class="nav-number">9.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#三元表达式"><span class="nav-number">9.2.</span> <span class="nav-text">三元表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环"><span class="nav-number">9.3.</span> <span class="nav-text">循环</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#while循环"><span class="nav-number">9.3.1.</span> <span class="nav-text">while循环</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-1"><span class="nav-number">9.3.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-2"><span class="nav-number">9.3.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#for循环"><span class="nav-number">9.3.2.</span> <span class="nav-text">for循环</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#for…in…循环"><span class="nav-number">9.3.2.1.</span> <span class="nav-text">for…in…循环</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#for…in…else循环"><span class="nav-number">9.3.2.2.</span> <span class="nav-text">for…in…else循环</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#for…in-range循环"><span class="nav-number">9.3.2.3.</span> <span class="nav-text">for…in range循环</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#for循环获取索引"><span class="nav-number">9.3.2.4.</span> <span class="nav-text">for循环获取索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环控制语句"><span class="nav-number">9.4.</span> <span class="nav-text">循环控制语句</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#break"><span class="nav-number">9.4.1.</span> <span class="nav-text">break</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#continue"><span class="nav-number">9.4.2.</span> <span class="nav-text">continue</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python实现java语言switch特性"><span class="nav-number">9.5.</span> <span class="nav-text">Python实现java语言switch特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#字典switch"><span class="nav-number">9.5.1.</span> <span class="nav-text">字典switch</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">10.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#内置函数"><span class="nav-number">10.1.</span> <span class="nav-text">内置函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数命名"><span class="nav-number">10.2.</span> <span class="nav-text">函数命名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#定义函数"><span class="nav-number">10.3.</span> <span class="nav-text">定义函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#py文件定义函数"><span class="nav-number">10.3.1.</span> <span class="nav-text">py文件定义函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#python交互环境定义函数"><span class="nav-number">10.3.2.</span> <span class="nav-text">python交互环境定义函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#函数返回多个值"><span class="nav-number">10.3.3.</span> <span class="nav-text">函数返回多个值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#函数的参数"><span class="nav-number">10.3.4.</span> <span class="nav-text">函数的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#默认参数"><span class="nav-number">10.3.4.1.</span> <span class="nav-text">默认参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#可变参数"><span class="nav-number">10.3.4.2.</span> <span class="nav-text">可变参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#关键字参数"><span class="nav-number">10.3.4.3.</span> <span class="nav-text">关键字参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#命名关键字参数"><span class="nav-number">10.3.4.4.</span> <span class="nav-text">命名关键字参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#参数组合"><span class="nav-number">10.3.4.5.</span> <span class="nav-text">参数组合</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数的要点"><span class="nav-number">10.4.</span> <span class="nav-text">函数的要点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#递归函数"><span class="nav-number">10.5.</span> <span class="nav-text">递归函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#递归栈溢出"><span class="nav-number">10.5.1.</span> <span class="nav-text">递归栈溢出</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#尾递归优化"><span class="nav-number">10.5.2.</span> <span class="nav-text">尾递归优化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数式编程"><span class="nav-number">11.</span> <span class="nav-text">函数式编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数式编程特点"><span class="nav-number">11.1.</span> <span class="nav-text">函数式编程特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#闭包"><span class="nav-number">11.2.</span> <span class="nav-text">闭包</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#闭包的特点"><span class="nav-number">11.2.1.</span> <span class="nav-text">闭包的特点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-3"><span class="nav-number">11.2.2.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#闭包函数的闭包信息"><span class="nav-number">11.2.3.</span> <span class="nav-text">闭包函数的闭包信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#闭包的缺点"><span class="nav-number">11.2.4.</span> <span class="nav-text">闭包的缺点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#匿名函数"><span class="nav-number">11.3.</span> <span class="nav-text">匿名函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-2"><span class="nav-number">11.3.1.</span> <span class="nav-text">语法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰器"><span class="nav-number">11.4.</span> <span class="nav-text">装饰器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#装饰器函数"><span class="nav-number">11.4.1.</span> <span class="nav-text">装饰器函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-4"><span class="nav-number">11.4.1.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#装饰器函数带参数"><span class="nav-number">11.4.2.</span> <span class="nav-text">装饰器函数带参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#装饰器通用优化"><span class="nav-number">11.4.3.</span> <span class="nav-text">装饰器通用优化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#偏函数"><span class="nav-number">11.5.</span> <span class="nav-text">偏函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建偏函数"><span class="nav-number">11.5.1.</span> <span class="nav-text">创建偏函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-5"><span class="nav-number">11.5.1.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#应用场景"><span class="nav-number">11.5.2.</span> <span class="nav-text">应用场景</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内建的高阶函数"><span class="nav-number">11.6.</span> <span class="nav-text">内建的高阶函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#map"><span class="nav-number">11.6.1.</span> <span class="nav-text">map</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-3"><span class="nav-number">11.6.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-6"><span class="nav-number">11.6.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#reduce"><span class="nav-number">11.6.2.</span> <span class="nav-text">reduce</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-4"><span class="nav-number">11.6.2.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-7"><span class="nav-number">11.6.2.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#filter"><span class="nav-number">11.6.3.</span> <span class="nav-text">filter</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-8"><span class="nav-number">11.6.3.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#sorted"><span class="nav-number">11.6.4.</span> <span class="nav-text">sorted</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-5"><span class="nav-number">11.6.4.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-9"><span class="nav-number">11.6.4.2.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#注意"><span class="nav-number">11.6.4.3.</span> <span class="nav-text">注意</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块"><span class="nav-number">12.</span> <span class="nav-text">模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模块的概念"><span class="nav-number">12.1.</span> <span class="nav-text">模块的概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#模块的命名"><span class="nav-number">12.1.1.</span> <span class="nav-text">模块的命名</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#包"><span class="nav-number">12.2.</span> <span class="nav-text">包</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#包的定义"><span class="nav-number">12.2.1.</span> <span class="nav-text">包的定义</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#要点"><span class="nav-number">12.2.2.</span> <span class="nav-text">要点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-10"><span class="nav-number">12.2.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#导入模块"><span class="nav-number">12.3.</span> <span class="nav-text">导入模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#导入模块注意点"><span class="nav-number">12.3.1.</span> <span class="nav-text">导入模块注意点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#语法-6"><span class="nav-number">12.3.2.</span> <span class="nav-text">语法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#import…"><span class="nav-number">12.3.2.1.</span> <span class="nav-text">import…</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#from…import…"><span class="nav-number">12.3.2.2.</span> <span class="nav-text">from…import…</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模块导入示例"><span class="nav-number">12.3.3.</span> <span class="nav-text">模块导入示例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#导入内建模块"><span class="nav-number">12.3.3.1.</span> <span class="nav-text">导入内建模块</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#导入自定义模块"><span class="nav-number">12.3.3.2.</span> <span class="nav-text">导入自定义模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#作用域"><span class="nav-number">12.4.</span> <span class="nav-text">作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#公开作用域"><span class="nav-number">12.4.1.</span> <span class="nav-text">公开作用域</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#私有作用域"><span class="nav-number">12.4.2.</span> <span class="nav-text">私有作用域</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装第三方模块"><span class="nav-number">12.5.</span> <span class="nav-text">安装第三方模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#pip包管理工具"><span class="nav-number">12.5.1.</span> <span class="nav-text">pip包管理工具</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#第三方库的获取"><span class="nav-number">12.5.2.</span> <span class="nav-text">第三方库的获取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装第三方库"><span class="nav-number">12.5.3.</span> <span class="nav-text">安装第三方库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#模块搜索路径Path"><span class="nav-number">12.5.4.</span> <span class="nav-text">模块搜索路径Path</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#默认搜索路径"><span class="nav-number">12.5.4.1.</span> <span class="nav-text">默认搜索路径</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#自定义模块搜索路径"><span class="nav-number">12.5.4.2.</span> <span class="nav-text">自定义模块搜索路径</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#面向对象编程"><span class="nav-number">13.</span> <span class="nav-text">面向对象编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类和实例"><span class="nav-number">13.1.</span> <span class="nav-text">类和实例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建类"><span class="nav-number">13.1.1.</span> <span class="nav-text">创建类</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法格式"><span class="nav-number">13.1.1.1.</span> <span class="nav-text">语法格式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-11"><span class="nav-number">13.1.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类实例"><span class="nav-number">13.1.2.</span> <span class="nav-text">类实例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-12"><span class="nav-number">13.1.2.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类的构造函数"><span class="nav-number">13.1.3.</span> <span class="nav-text">类的构造函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#构造函数语法"><span class="nav-number">13.1.3.1.</span> <span class="nav-text">构造函数语法</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类变量"><span class="nav-number">13.1.4.</span> <span class="nav-text">类变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实例变量"><span class="nav-number">13.1.5.</span> <span class="nav-text">实例变量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实例方法"><span class="nav-number">13.1.6.</span> <span class="nav-text">实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#定义类实例的方法"><span class="nav-number">13.1.6.1.</span> <span class="nav-text">定义类实例的方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#类名访问实例方法"><span class="nav-number">13.1.6.2.</span> <span class="nav-text">类名访问实例方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实例方法访问类变量"><span class="nav-number">13.1.6.3.</span> <span class="nav-text">实例方法访问类变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实例方法访问实例变量"><span class="nav-number">13.1.6.4.</span> <span class="nav-text">实例方法访问实例变量</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类方法"><span class="nav-number">13.1.7.</span> <span class="nav-text">类方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-1"><span class="nav-number">13.1.7.1.</span> <span class="nav-text">要点</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类的静态方法"><span class="nav-number">13.1.8.</span> <span class="nav-text">类的静态方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-2"><span class="nav-number">13.1.8.1.</span> <span class="nav-text">要点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类的访问限制"><span class="nav-number">13.2.</span> <span class="nav-text">类的访问限制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#私有变量"><span class="nav-number">13.2.1.</span> <span class="nav-text">私有变量</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#私有变量-1"><span class="nav-number">13.2.1.1.</span> <span class="nav-text">私有变量</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-3"><span class="nav-number">13.2.1.2.</span> <span class="nav-text">要点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#单下划线前缀属性"><span class="nav-number">13.2.1.3.</span> <span class="nav-text">单下划线前缀属性</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#私有方法"><span class="nav-number">13.2.2.</span> <span class="nav-text">私有方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#访问私有属性"><span class="nav-number">13.2.3.</span> <span class="nav-text">访问私有属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#继承"><span class="nav-number">13.3.</span> <span class="nav-text">继承</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#单继承示例"><span class="nav-number">13.3.1.</span> <span class="nav-text">单继承示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多继承示例"><span class="nav-number">13.3.2.</span> <span class="nav-text">多继承示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多态"><span class="nav-number">13.4.</span> <span class="nav-text">多态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#对象的类型判断"><span class="nav-number">13.5.</span> <span class="nav-text">对象的类型判断</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#type"><span class="nav-number">13.5.1.</span> <span class="nav-text">type()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#isinstance"><span class="nav-number">13.5.2.</span> <span class="nav-text">isinstance()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取对象的信息"><span class="nav-number">13.6.</span> <span class="nav-text">获取对象的信息</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取所有属性和方法"><span class="nav-number">13.6.1.</span> <span class="nav-text">获取所有属性和方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#属性变量的设置和获取"><span class="nav-number">13.6.2.</span> <span class="nav-text">属性变量的设置和获取</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#判断是否包含某属性"><span class="nav-number">13.6.3.</span> <span class="nav-text">判断是否包含某属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例绑定属性和类绑定属性"><span class="nav-number">13.7.</span> <span class="nav-text">实例绑定属性和类绑定属性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例绑定属性"><span class="nav-number">13.7.1.</span> <span class="nav-text">实例绑定属性</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#绑定方式"><span class="nav-number">13.7.1.1.</span> <span class="nav-text">绑定方式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#限制允许绑定的属性"><span class="nav-number">13.7.1.2.</span> <span class="nav-text">限制允许绑定的属性</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类绑定属性"><span class="nav-number">13.7.2.</span> <span class="nav-text">类绑定属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#实例绑定方法和类绑定方法"><span class="nav-number">13.8.</span> <span class="nav-text">实例绑定方法和类绑定方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#实例绑定方法"><span class="nav-number">13.8.1.</span> <span class="nav-text">实例绑定方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#类绑定方法"><span class="nav-number">13.8.2.</span> <span class="nav-text">类绑定方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类方法的装饰器"><span class="nav-number">13.9.</span> <span class="nav-text">类方法的装饰器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#property属性读写限制和检查"><span class="nav-number">13.9.1.</span> <span class="nav-text">@property属性读写限制和检查</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类可定制"><span class="nav-number">13.10.</span> <span class="nav-text">类可定制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#str"><span class="nav-number">13.10.1.</span> <span class="nav-text">__str__</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#iter"><span class="nav-number">13.10.2.</span> <span class="nav-text">__iter__</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#getitem"><span class="nav-number">13.10.3.</span> <span class="nav-text">__getitem__</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#拓展"><span class="nav-number">13.10.3.1.</span> <span class="nav-text">拓展</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#getattr"><span class="nav-number">13.10.4.</span> <span class="nav-text">__getattr__</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-4"><span class="nav-number">13.10.4.1.</span> <span class="nav-text">要点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-13"><span class="nav-number">13.10.4.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#call"><span class="nav-number">13.10.5.</span> <span class="nav-text">__call__</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-5"><span class="nav-number">13.10.5.1.</span> <span class="nav-text">要点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#可调用对象"><span class="nav-number">13.10.5.2.</span> <span class="nav-text">可调用对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#枚举类"><span class="nav-number">13.11.</span> <span class="nav-text">枚举类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#概念要点"><span class="nav-number">13.11.1.</span> <span class="nav-text">概念要点</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#概念"><span class="nav-number">13.11.1.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#枚举值类型"><span class="nav-number">13.11.1.2.</span> <span class="nav-text">枚举值类型</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用注意"><span class="nav-number">13.11.1.3.</span> <span class="nav-text">使用注意</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#简单的枚举类"><span class="nav-number">13.11.2.</span> <span class="nav-text">简单的枚举类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自定义枚举类"><span class="nav-number">13.11.3.</span> <span class="nav-text">自定义枚举类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#访问枚举类"><span class="nav-number">13.11.4.</span> <span class="nav-text">访问枚举类</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态创建类"><span class="nav-number">13.12.</span> <span class="nav-text">动态创建类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用type函数"><span class="nav-number">13.12.1.</span> <span class="nav-text">使用type函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-7"><span class="nav-number">13.12.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-14"><span class="nav-number">13.12.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用metaclass"><span class="nav-number">13.12.2.</span> <span class="nav-text">使用metaclass</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#new"><span class="nav-number">13.12.2.1.</span> <span class="nav-text">__new__()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-15"><span class="nav-number">13.12.2.2.</span> <span class="nav-text">示例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#元类实现ORM"><span class="nav-number">13.12.2.3.</span> <span class="nav-text">元类实现ORM</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象类"><span class="nav-number">13.13.</span> <span class="nav-text">抽象类</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#定义抽象类"><span class="nav-number">13.13.1.</span> <span class="nav-text">定义抽象类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-16"><span class="nav-number">13.13.2.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误处理"><span class="nav-number">14.</span> <span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#捕获和处理错误"><span class="nav-number">14.1.</span> <span class="nav-text">捕获和处理错误</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#错误调试"><span class="nav-number">14.2.</span> <span class="nav-text">错误调试</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#断言错误"><span class="nav-number">14.2.1.</span> <span class="nav-text">断言错误</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#关闭断言"><span class="nav-number">14.2.1.1.</span> <span class="nav-text">关闭断言</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#打印错误日志"><span class="nav-number">14.2.2.</span> <span class="nav-text">打印错误日志</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pdb命令调试"><span class="nav-number">14.2.3.</span> <span class="nav-text">pdb命令调试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IDE调试"><span class="nav-number">14.2.4.</span> <span class="nav-text">IDE调试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参考"><span class="nav-number">14.3.</span> <span class="nav-text">参考</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#正则表达式"><span class="nav-number">15.</span> <span class="nav-text">正则表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述"><span class="nav-number">15.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则元字符"><span class="nav-number">15.2.</span> <span class="nav-text">正则元字符</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#转义字符-1"><span class="nav-number">15.2.1.</span> <span class="nav-text">转义字符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#边界符"><span class="nav-number">15.2.2.</span> <span class="nav-text">边界符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#数量限制符"><span class="nav-number">15.2.3.</span> <span class="nav-text">数量限制符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#匹配表达式"><span class="nav-number">15.2.4.</span> <span class="nav-text">匹配表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取和非获取匹配"><span class="nav-number">15.2.5.</span> <span class="nav-text">获取和非获取匹配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#其它匹配字符"><span class="nav-number">15.2.6.</span> <span class="nav-text">其它匹配字符</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#转义字符问题"><span class="nav-number">15.3.</span> <span class="nav-text">转义字符问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#re模块"><span class="nav-number">15.4.</span> <span class="nav-text">re模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#正则匹配方法"><span class="nav-number">15.4.1.</span> <span class="nav-text">正则匹配方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#查找和匹配"><span class="nav-number">15.4.1.1.</span> <span class="nav-text">查找和匹配</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#分组匹配"><span class="nav-number">15.4.1.2.</span> <span class="nav-text">分组匹配</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#贪婪匹配"><span class="nav-number">15.4.1.3.</span> <span class="nav-text">贪婪匹配</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#非贪婪匹配"><span class="nav-number">15.4.1.4.</span> <span class="nav-text">非贪婪匹配</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#re模块其他操作函数"><span class="nav-number">15.4.2.</span> <span class="nav-text">re模块其他操作函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#查找替换"><span class="nav-number">15.4.2.1.</span> <span class="nav-text">查找替换</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#预编译该正则表达式"><span class="nav-number">15.4.2.2.</span> <span class="nav-text">预编译该正则表达式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则切分字符串"><span class="nav-number">15.5.</span> <span class="nav-text">正则切分字符串</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#正则表达式收集"><span class="nav-number">15.6.</span> <span class="nav-text">正则表达式收集</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#校验数字的表达式"><span class="nav-number">15.6.1.</span> <span class="nav-text">校验数字的表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#校验字符的表达式"><span class="nav-number">15.6.2.</span> <span class="nav-text">校验字符的表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Email地址"><span class="nav-number">15.6.3.</span> <span class="nav-text">Email地址</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#域名"><span class="nav-number">15.6.4.</span> <span class="nav-text">域名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#手机号码"><span class="nav-number">15.6.5.</span> <span class="nav-text">手机号码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#IP地址"><span class="nav-number">15.6.6.</span> <span class="nav-text">IP地址</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IO编程"><span class="nav-number">16.</span> <span class="nav-text">IO编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#文件读写"><span class="nav-number">16.1.</span> <span class="nav-text">文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#读文件示例"><span class="nav-number">16.1.1.</span> <span class="nav-text">读文件示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#读写文件的内置函数"><span class="nav-number">16.1.2.</span> <span class="nav-text">读写文件的内置函数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#open"><span class="nav-number">16.1.2.1.</span> <span class="nav-text">open()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#read"><span class="nav-number">16.1.2.2.</span> <span class="nav-text">read()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#readlines"><span class="nav-number">16.1.2.3.</span> <span class="nav-text">readlines()</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#write"><span class="nav-number">16.1.2.4.</span> <span class="nav-text">write()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内存读写"><span class="nav-number">16.2.</span> <span class="nav-text">内存读写</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#StringIO"><span class="nav-number">16.2.1.</span> <span class="nav-text">StringIO</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#内存读写操作"><span class="nav-number">16.2.1.1.</span> <span class="nav-text">内存读写操作</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ByteIO"><span class="nav-number">16.2.2.</span> <span class="nav-text">ByteIO</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#读写操作"><span class="nav-number">16.2.2.1.</span> <span class="nav-text">读写操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#操作系统和文件目录"><span class="nav-number">16.3.</span> <span class="nav-text">操作系统和文件目录</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#获取操作系统信息"><span class="nav-number">16.3.1.</span> <span class="nav-text">获取操作系统信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#操作文件和目录"><span class="nav-number">16.3.2.</span> <span class="nav-text">操作文件和目录</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#复制文件"><span class="nav-number">16.3.2.1.</span> <span class="nav-text">复制文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#序列化"><span class="nav-number">16.4.</span> <span class="nav-text">序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#pickling序列化"><span class="nav-number">16.4.1.</span> <span class="nav-text">pickling序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#概念-1"><span class="nav-number">16.4.1.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#序列化操作"><span class="nav-number">16.4.1.2.</span> <span class="nav-text">序列化操作</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON序列化"><span class="nav-number">17.</span> <span class="nav-text">JSON序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#json写法"><span class="nav-number">17.1.</span> <span class="nav-text">json写法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#json和python的数据类型"><span class="nav-number">17.2.</span> <span class="nav-text">json和python的数据类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理json"><span class="nav-number">17.3.</span> <span class="nav-text">处理json</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#json字符串转python对象"><span class="nav-number">17.3.1.</span> <span class="nav-text">json字符串转python对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#python对象转json字符串"><span class="nav-number">17.3.2.</span> <span class="nav-text">python对象转json字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#处理中文"><span class="nav-number">17.3.2.1.</span> <span class="nav-text">处理中文</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#读写json文件"><span class="nav-number">17.3.3.</span> <span class="nav-text">读写json文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#json序列化类对象"><span class="nav-number">17.3.4.</span> <span class="nav-text">json序列化类对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多任务"><span class="nav-number">18.</span> <span class="nav-text">多任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多进程"><span class="nav-number">19.</span> <span class="nav-text">多进程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#os模块进程方法"><span class="nav-number">19.1.</span> <span class="nav-text">os模块进程方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fork进程"><span class="nav-number">19.2.</span> <span class="nav-text">fork进程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#跨平台进程模块"><span class="nav-number">19.3.</span> <span class="nav-text">跨平台进程模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Process进程对象"><span class="nav-number">19.3.1.</span> <span class="nav-text">Process进程对象</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#构造方法"><span class="nav-number">19.3.1.1.</span> <span class="nav-text">构造方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实例方法-1"><span class="nav-number">19.3.1.2.</span> <span class="nav-text">实例方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#实例属性"><span class="nav-number">19.3.1.3.</span> <span class="nav-text">实例属性</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-17"><span class="nav-number">19.3.1.4.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pool进程池"><span class="nav-number">19.3.2.</span> <span class="nav-text">Pool进程池</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要点-6"><span class="nav-number">19.3.2.1.</span> <span class="nav-text">要点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Pool实例方法"><span class="nav-number">19.3.2.2.</span> <span class="nav-text">Pool实例方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-18"><span class="nav-number">19.3.2.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#subprocess子进程模块"><span class="nav-number">19.3.3.</span> <span class="nav-text">subprocess子进程模块</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#subprocess模块常用函数"><span class="nav-number">19.3.3.1.</span> <span class="nav-text">subprocess模块常用函数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#subproces-Popen"><span class="nav-number">19.3.3.2.</span> <span class="nav-text">subproces.Popen()</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#进程间通信"><span class="nav-number">19.3.4.</span> <span class="nav-text">进程间通信</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Queue"><span class="nav-number">19.3.4.1.</span> <span class="nav-text">Queue</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多进程的优缺点"><span class="nav-number">19.3.5.</span> <span class="nav-text">多进程的优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#优点"><span class="nav-number">19.3.5.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#缺点"><span class="nav-number">19.3.5.2.</span> <span class="nav-text">缺点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多线程"><span class="nav-number">20.</span> <span class="nav-text">多线程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#threading模块"><span class="nav-number">20.1.</span> <span class="nav-text">threading模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#线程概念"><span class="nav-number">20.1.1.</span> <span class="nav-text">线程概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#缺点-1"><span class="nav-number">20.1.2.</span> <span class="nav-text">缺点</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#创建线程实例"><span class="nav-number">20.1.3.</span> <span class="nav-text">创建线程实例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Lock-锁"><span class="nav-number">20.2.</span> <span class="nav-text">Lock(锁)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#数据共享问题"><span class="nav-number">20.2.1.</span> <span class="nav-text">数据共享问题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用锁"><span class="nav-number">20.2.2.</span> <span class="nav-text">使用锁</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-19"><span class="nav-number">20.2.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GIL全局锁"><span class="nav-number">20.3.</span> <span class="nav-text">GIL全局锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">20.4.</span> <span class="nav-text">ThreadLocal</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-20"><span class="nav-number">20.4.1.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分布式进程"><span class="nav-number">21.</span> <span class="nav-text">分布式进程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#例子"><span class="nav-number">21.1.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用内建模块"><span class="nav-number">22.</span> <span class="nav-text">常用内建模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#datetime"><span class="nav-number">22.1.</span> <span class="nav-text">datetime</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#本地时间"><span class="nav-number">22.1.1.</span> <span class="nav-text">本地时间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#时间加减法"><span class="nav-number">22.1.2.</span> <span class="nav-text">时间加减法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#时区时间"><span class="nav-number">22.1.3.</span> <span class="nav-text">时区时间</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#创建时区时间"><span class="nav-number">22.1.3.1.</span> <span class="nav-text">创建时区时间</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#时区转换"><span class="nav-number">22.1.3.2.</span> <span class="nav-text">时区转换</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#时间戳"><span class="nav-number">22.1.4.</span> <span class="nav-text">时间戳</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#时间格式化"><span class="nav-number">22.1.5.</span> <span class="nav-text">时间格式化</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-8"><span class="nav-number">22.1.5.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#时间日期格式化符号"><span class="nav-number">22.1.5.2.</span> <span class="nav-text">时间日期格式化符号</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-21"><span class="nav-number">22.1.5.3.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#collections"><span class="nav-number">22.2.</span> <span class="nav-text">collections</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#namedtuple"><span class="nav-number">22.2.1.</span> <span class="nav-text">namedtuple</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#语法-9"><span class="nav-number">22.2.1.1.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-22"><span class="nav-number">22.2.1.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#deque"><span class="nav-number">22.2.2.</span> <span class="nav-text">deque</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#defaultdict"><span class="nav-number">22.2.3.</span> <span class="nav-text">defaultdict</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#OrderedDict"><span class="nav-number">22.2.4.</span> <span class="nav-text">OrderedDict</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#实现FIFO的dict"><span class="nav-number">22.2.4.1.</span> <span class="nav-text">实现FIFO的dict</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ChainMap"><span class="nav-number">22.2.5.</span> <span class="nav-text">ChainMap</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#使用场景示例"><span class="nav-number">22.2.5.1.</span> <span class="nav-text">使用场景示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Counter"><span class="nav-number">22.2.6.</span> <span class="nav-text">Counter</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#base64"><span class="nav-number">22.3.</span> <span class="nav-text">base64</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#base64编解码"><span class="nav-number">22.3.1.</span> <span class="nav-text">base64编解码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#urlsafe-b64编解码"><span class="nav-number">22.3.2.</span> <span class="nav-text">urlsafe_b64编解码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#要点-7"><span class="nav-number">22.3.3.</span> <span class="nav-text">要点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#struct"><span class="nav-number">22.4.</span> <span class="nav-text">struct</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#主要函数"><span class="nav-number">22.4.1.</span> <span class="nav-text">主要函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-23"><span class="nav-number">22.4.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hashlib"><span class="nav-number">22.5.</span> <span class="nav-text">hashlib</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#摘要算法"><span class="nav-number">22.5.1.</span> <span class="nav-text">摘要算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#MD5"><span class="nav-number">22.5.2.</span> <span class="nav-text">MD5</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SHA1"><span class="nav-number">22.5.3.</span> <span class="nav-text">SHA1</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hmac"><span class="nav-number">22.6.</span> <span class="nav-text">hmac</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#解决问题场景"><span class="nav-number">22.6.1.</span> <span class="nav-text">解决问题场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#hmac算法"><span class="nav-number">22.6.2.</span> <span class="nav-text">hmac算法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#itertools"><span class="nav-number">22.7.</span> <span class="nav-text">itertools</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#无限迭代函数"><span class="nav-number">22.7.1.</span> <span class="nav-text">无限迭代函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多个迭代串联"><span class="nav-number">22.7.2.</span> <span class="nav-text">多个迭代串联</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#重复元素分组迭代"><span class="nav-number">22.7.3.</span> <span class="nav-text">重复元素分组迭代</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contextlib"><span class="nav-number">22.8.</span> <span class="nav-text">contextlib</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#with自动关闭资源"><span class="nav-number">22.8.1.</span> <span class="nav-text">with自动关闭资源</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#contextmanager"><span class="nav-number">22.8.2.</span> <span class="nav-text">@contextmanager</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#实现with"><span class="nav-number">22.8.2.1.</span> <span class="nav-text">实现with</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#closing"><span class="nav-number">22.8.3.</span> <span class="nav-text">@closing</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#closing的实现"><span class="nav-number">22.8.3.1.</span> <span class="nav-text">@closing的实现</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用案例"><span class="nav-number">22.8.3.2.</span> <span class="nav-text">使用案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#urllib"><span class="nav-number">22.9.</span> <span class="nav-text">urllib</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Get"><span class="nav-number">22.9.1.</span> <span class="nav-text">Get</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#抓取Get请求的信息"><span class="nav-number">22.9.1.1.</span> <span class="nav-text">抓取Get请求的信息</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#模拟浏览器发送GET请求"><span class="nav-number">22.9.1.2.</span> <span class="nav-text">模拟浏览器发送GET请求</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Post"><span class="nav-number">22.9.2.</span> <span class="nav-text">Post</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Handler"><span class="nav-number">22.9.3.</span> <span class="nav-text">Handler</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML"><span class="nav-number">22.10.</span> <span class="nav-text">XML</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SAX解析XML"><span class="nav-number">22.10.1.</span> <span class="nav-text">SAX解析XML</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#解析步骤"><span class="nav-number">22.10.1.1.</span> <span class="nav-text">解析步骤</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#案例"><span class="nav-number">22.10.1.2.</span> <span class="nav-text">案例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#生成XML"><span class="nav-number">22.10.2.</span> <span class="nav-text">生成XML</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTMLParser"><span class="nav-number">22.11.</span> <span class="nav-text">HTMLParser</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用第三方模块"><span class="nav-number">23.</span> <span class="nav-text">常用第三方模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Pillow-图像处理"><span class="nav-number">23.1.</span> <span class="nav-text">Pillow(图像处理)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装"><span class="nav-number">23.1.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#操作图像"><span class="nav-number">23.1.2.</span> <span class="nav-text">操作图像</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#缩放"><span class="nav-number">23.1.2.1.</span> <span class="nav-text">缩放</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#模糊"><span class="nav-number">23.1.2.2.</span> <span class="nav-text">模糊</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#绘图"><span class="nav-number">23.1.3.</span> <span class="nav-text">绘图</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#生成字母验证码图片"><span class="nav-number">23.1.3.1.</span> <span class="nav-text">生成字母验证码图片</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests-处理url"><span class="nav-number">23.2.</span> <span class="nav-text">requests(处理url)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装-1"><span class="nav-number">23.2.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GET请求"><span class="nav-number">23.2.2.</span> <span class="nav-text">GET请求</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#使用GET请求"><span class="nav-number">23.2.2.1.</span> <span class="nav-text">使用GET请求</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#GET请求带参数"><span class="nav-number">23.2.2.2.</span> <span class="nav-text">GET请求带参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#响应数据格式Json"><span class="nav-number">23.2.2.3.</span> <span class="nav-text">响应数据格式Json</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#请求头添加header"><span class="nav-number">23.2.2.4.</span> <span class="nav-text">请求头添加header</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#POST请求"><span class="nav-number">23.2.3.</span> <span class="nav-text">POST请求</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#请求参数"><span class="nav-number">23.2.3.1.</span> <span class="nav-text">请求参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chardet-编码检测"><span class="nav-number">23.3.</span> <span class="nav-text">chardet(编码检测)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装-2"><span class="nav-number">23.3.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常用编码检查"><span class="nav-number">23.3.2.</span> <span class="nav-text">常用编码检查</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#psutil-系统信息"><span class="nav-number">23.4.</span> <span class="nav-text">psutil(系统信息)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装-3"><span class="nav-number">23.4.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取CPU信息"><span class="nav-number">23.4.2.</span> <span class="nav-text">获取CPU信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取内存信息"><span class="nav-number">23.4.3.</span> <span class="nav-text">获取内存信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取磁盘信息"><span class="nav-number">23.4.4.</span> <span class="nav-text">获取磁盘信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取网络信息"><span class="nav-number">23.4.5.</span> <span class="nav-text">获取网络信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#获取进程信息"><span class="nav-number">23.4.6.</span> <span class="nav-text">获取进程信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#独立的python运行环境"><span class="nav-number">24.</span> <span class="nav-text">独立的python运行环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装virtualenv"><span class="nav-number">24.1.</span> <span class="nav-text">安装virtualenv</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#venv环境"><span class="nav-number">24.2.</span> <span class="nav-text">venv环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图形界面"><span class="nav-number">25.</span> <span class="nav-text">图形界面</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Tkinter"><span class="nav-number">25.1.</span> <span class="nav-text">Tkinter</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#GUI-API"><span class="nav-number">25.1.1.</span> <span class="nav-text">GUI API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Frame"><span class="nav-number">25.1.1.1.</span> <span class="nav-text">Frame</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#GUI案例"><span class="nav-number">25.1.2.</span> <span class="nav-text">GUI案例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#显示文本"><span class="nav-number">25.1.2.1.</span> <span class="nav-text">显示文本</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#输入和弹窗"><span class="nav-number">25.1.2.2.</span> <span class="nav-text">输入和弹窗</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#turtle"><span class="nav-number">25.2.</span> <span class="nav-text">turtle</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#案例-1"><span class="nav-number">25.2.1.</span> <span class="nav-text">案例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#绘制一个长方形"><span class="nav-number">25.2.1.1.</span> <span class="nav-text">绘制一个长方形</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#循环绘制5个五角星"><span class="nav-number">25.2.1.2.</span> <span class="nav-text">循环绘制5个五角星</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#绘制一棵分型树"><span class="nav-number">25.2.1.3.</span> <span class="nav-text">绘制一棵分型树</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络编程"><span class="nav-number">26.</span> <span class="nav-text">网络编程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP-IP"><span class="nav-number">26.1.</span> <span class="nav-text">TCP/IP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IP协议"><span class="nav-number">26.1.1.</span> <span class="nav-text">IP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#IPv4"><span class="nav-number">26.1.1.1.</span> <span class="nav-text">IPv4</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#IPv6"><span class="nav-number">26.1.1.2.</span> <span class="nav-text">IPv6</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TCP协议"><span class="nav-number">26.1.2.</span> <span class="nav-text">TCP协议</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#三次握手"><span class="nav-number">26.1.2.1.</span> <span class="nav-text">三次握手</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#TCP协议栈的弱点"><span class="nav-number">26.1.2.2.</span> <span class="nav-text">TCP协议栈的弱点</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#端口"><span class="nav-number">26.1.3.</span> <span class="nav-text">端口</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TCP编程"><span class="nav-number">26.2.</span> <span class="nav-text">TCP编程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#socket"><span class="nav-number">26.2.1.</span> <span class="nav-text">socket</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#socket使用步骤示例"><span class="nav-number">26.2.1.1.</span> <span class="nav-text">socket使用步骤示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端"><span class="nav-number">26.2.2.</span> <span class="nav-text">客户端</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#服务器"><span class="nav-number">26.2.3.</span> <span class="nav-text">服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#服务端处理思路"><span class="nav-number">26.2.3.1.</span> <span class="nav-text">服务端处理思路</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CS通信示例"><span class="nav-number">26.2.4.</span> <span class="nav-text">CS通信示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UDP编程"><span class="nav-number">26.3.</span> <span class="nav-text">UDP编程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-24"><span class="nav-number">26.3.1.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现收发电子邮件"><span class="nav-number">27.</span> <span class="nav-text">实现收发电子邮件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#名词解释"><span class="nav-number">27.1.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#收发邮件"><span class="nav-number">27.2.</span> <span class="nav-text">收发邮件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#流程"><span class="nav-number">27.2.1.</span> <span class="nav-text">流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#协议"><span class="nav-number">27.2.2.</span> <span class="nav-text">协议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SMTP服务器配置"><span class="nav-number">27.2.3.</span> <span class="nav-text">SMTP服务器配置</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SMTP发送邮件"><span class="nav-number">27.3.</span> <span class="nav-text">SMTP发送邮件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#发文本邮件"><span class="nav-number">27.3.1.</span> <span class="nav-text">发文本邮件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#发送附件"><span class="nav-number">27.3.2.</span> <span class="nav-text">发送附件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#发送图片"><span class="nav-number">27.3.3.</span> <span class="nav-text">发送图片</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#同时支持HTML和Plain格式"><span class="nav-number">27.3.4.</span> <span class="nav-text">同时支持HTML和Plain格式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#加密SMTP"><span class="nav-number">27.3.5.</span> <span class="nav-text">加密SMTP</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例-25"><span class="nav-number">27.3.5.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SMTP发件总结"><span class="nav-number">27.3.6.</span> <span class="nav-text">SMTP发件总结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POP3收取邮件"><span class="nav-number">27.4.</span> <span class="nav-text">POP3收取邮件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#收邮件"><span class="nav-number">27.4.1.</span> <span class="nav-text">收邮件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#通过POP3获取邮件"><span class="nav-number">27.4.2.</span> <span class="nav-text">通过POP3获取邮件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解析邮件"><span class="nav-number">27.4.3.</span> <span class="nav-text">解析邮件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据的存储"><span class="nav-number">28.</span> <span class="nav-text">数据的存储</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SQLite"><span class="nav-number">28.1.</span> <span class="nav-text">SQLite</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用SQLite"><span class="nav-number">28.1.1.</span> <span class="nav-text">使用SQLite</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL"><span class="nav-number">28.2.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装MySQL驱动"><span class="nav-number">28.2.1.</span> <span class="nav-text">安装MySQL驱动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#操作MySQL"><span class="nav-number">28.2.2.</span> <span class="nav-text">操作MySQL</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ORM"><span class="nav-number">28.3.</span> <span class="nav-text">ORM</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SQLAlchemy"><span class="nav-number">28.3.1.</span> <span class="nav-text">SQLAlchemy</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#安装-4"><span class="nav-number">28.3.1.1.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#使用示例"><span class="nav-number">28.3.1.2.</span> <span class="nav-text">使用示例</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web开发"><span class="nav-number">29.</span> <span class="nav-text">web开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP状态码"><span class="nav-number">29.1.</span> <span class="nav-text">HTTP状态码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP格式"><span class="nav-number">29.2.</span> <span class="nav-text">HTTP格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WSGI"><span class="nav-number">29.3.</span> <span class="nav-text">WSGI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#http请求信息"><span class="nav-number">29.3.1.</span> <span class="nav-text">http请求信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#根据请求响应"><span class="nav-number">29.3.2.</span> <span class="nav-text">根据请求响应</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-26"><span class="nav-number">29.3.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web框架"><span class="nav-number">29.4.</span> <span class="nav-text">web框架</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flask"><span class="nav-number">30.</span> <span class="nav-text">Flask</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#安装Flask"><span class="nav-number">30.1.</span> <span class="nav-text">安装Flask</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebAPI"><span class="nav-number">30.2.</span> <span class="nav-text">WebAPI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#核心概念"><span class="nav-number">30.2.1.</span> <span class="nav-text">核心概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-27"><span class="nav-number">30.2.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jinja2模板技术"><span class="nav-number">30.3.</span> <span class="nav-text">jinja2模板技术</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#jinja2"><span class="nav-number">30.3.1.</span> <span class="nav-text">jinja2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#jinja2-API"><span class="nav-number">30.3.2.</span> <span class="nav-text">jinja2-API</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-28"><span class="nav-number">30.3.3.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其它模板框架"><span class="nav-number">30.4.</span> <span class="nav-text">其它模板框架</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步IO"><span class="nav-number">31.</span> <span class="nav-text">异步IO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#多线程解决IO阻塞"><span class="nav-number">31.1.</span> <span class="nav-text">多线程解决IO阻塞</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#解决方式"><span class="nav-number">31.1.1.</span> <span class="nav-text">解决方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#性能问题"><span class="nav-number">31.1.2.</span> <span class="nav-text">性能问题</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#异步IO解决IO阻塞"><span class="nav-number">31.2.</span> <span class="nav-text">异步IO解决IO阻塞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#协程"><span class="nav-number">31.3.</span> <span class="nav-text">协程</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#概念-2"><span class="nav-number">31.3.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#特点优势"><span class="nav-number">31.3.2.</span> <span class="nav-text">特点优势</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#协程的实现"><span class="nav-number">31.3.3.</span> <span class="nav-text">协程的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#示例解释协程"><span class="nav-number">31.3.3.1.</span> <span class="nav-text">示例解释协程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#asyncio"><span class="nav-number">31.4.</span> <span class="nav-text">asyncio</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#asyncio使用步骤"><span class="nav-number">31.4.1.</span> <span class="nav-text">asyncio使用步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#asyncio并发示例"><span class="nav-number">31.4.2.</span> <span class="nav-text">asyncio并发示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#async-await"><span class="nav-number">31.5.</span> <span class="nav-text">async/await</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用"><span class="nav-number">31.5.1.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例代码"><span class="nav-number">31.5.2.</span> <span class="nav-text">示例代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aiohttp"><span class="nav-number">31.6.</span> <span class="nav-text">aiohttp</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装aiohttp"><span class="nav-number">31.6.1.</span> <span class="nav-text">安装aiohttp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用-1"><span class="nav-number">31.6.2.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#示例-29"><span class="nav-number">31.6.3.</span> <span class="nav-text">示例</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ethancalc</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cytFhNP7b';
      var conf = 'a8f0e5bccaabb0580489df2a08f8a24f';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  





  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  


<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
</body>
</html>

